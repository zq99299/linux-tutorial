<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>软件磁盘阵列（Software RAID） | Linux 系统教程（笔记）</title>
    <meta name="generator" content="VuePress 1.4.1">
    <link rel="icon" href="/linux-tutorial/favicon.ico">
    <link rel="manifest" href="/linux-tutorial/manifest.json">
    <meta name="description" content="linux 系统教程学习笔记">
    <link rel="preload" href="/linux-tutorial/assets/css/0.styles.7e75da3d.css" as="style"><link rel="preload" href="/linux-tutorial/assets/js/app.3ea62065.js" as="script"><link rel="preload" href="/linux-tutorial/assets/js/2.b00e63ff.js" as="script"><link rel="preload" href="/linux-tutorial/assets/js/9.fe184c91.js" as="script"><link rel="preload" href="/linux-tutorial/assets/js/16.b0a90d5f.js" as="script"><link rel="prefetch" href="/linux-tutorial/assets/js/10.2f6e83c2.js"><link rel="prefetch" href="/linux-tutorial/assets/js/100.b3722352.js"><link rel="prefetch" href="/linux-tutorial/assets/js/101.8c1ef482.js"><link rel="prefetch" href="/linux-tutorial/assets/js/102.2586eda7.js"><link rel="prefetch" href="/linux-tutorial/assets/js/103.e4ead933.js"><link rel="prefetch" href="/linux-tutorial/assets/js/104.85e3fd0d.js"><link rel="prefetch" href="/linux-tutorial/assets/js/105.cc2c5c94.js"><link rel="prefetch" href="/linux-tutorial/assets/js/106.927267ce.js"><link rel="prefetch" href="/linux-tutorial/assets/js/107.1dd2a942.js"><link rel="prefetch" href="/linux-tutorial/assets/js/108.6090320a.js"><link rel="prefetch" href="/linux-tutorial/assets/js/109.57884f50.js"><link rel="prefetch" href="/linux-tutorial/assets/js/11.48476434.js"><link rel="prefetch" href="/linux-tutorial/assets/js/110.33c6958e.js"><link rel="prefetch" href="/linux-tutorial/assets/js/111.fd8a0020.js"><link rel="prefetch" href="/linux-tutorial/assets/js/112.788498e1.js"><link rel="prefetch" href="/linux-tutorial/assets/js/113.8de94cf4.js"><link rel="prefetch" href="/linux-tutorial/assets/js/114.2f9a6bc8.js"><link rel="prefetch" href="/linux-tutorial/assets/js/115.26cb32f2.js"><link rel="prefetch" href="/linux-tutorial/assets/js/116.c7a39b2c.js"><link rel="prefetch" href="/linux-tutorial/assets/js/117.3a5a37f1.js"><link rel="prefetch" href="/linux-tutorial/assets/js/118.16961e8a.js"><link rel="prefetch" href="/linux-tutorial/assets/js/119.9512ae4e.js"><link rel="prefetch" href="/linux-tutorial/assets/js/12.d5e57772.js"><link rel="prefetch" href="/linux-tutorial/assets/js/120.23d99fc1.js"><link rel="prefetch" href="/linux-tutorial/assets/js/121.e3a9422b.js"><link rel="prefetch" href="/linux-tutorial/assets/js/122.fdbe08a8.js"><link rel="prefetch" href="/linux-tutorial/assets/js/123.5b64c6d2.js"><link rel="prefetch" href="/linux-tutorial/assets/js/124.35e2afbb.js"><link rel="prefetch" href="/linux-tutorial/assets/js/125.5c0c3620.js"><link rel="prefetch" href="/linux-tutorial/assets/js/126.c9ad2adc.js"><link rel="prefetch" href="/linux-tutorial/assets/js/127.2a7e4d5a.js"><link rel="prefetch" href="/linux-tutorial/assets/js/128.b260f3a3.js"><link rel="prefetch" href="/linux-tutorial/assets/js/129.17deb712.js"><link rel="prefetch" href="/linux-tutorial/assets/js/13.baaaf940.js"><link rel="prefetch" href="/linux-tutorial/assets/js/130.2c20de59.js"><link rel="prefetch" href="/linux-tutorial/assets/js/131.60b7d099.js"><link rel="prefetch" href="/linux-tutorial/assets/js/132.d9ef53df.js"><link rel="prefetch" href="/linux-tutorial/assets/js/133.edffc570.js"><link rel="prefetch" href="/linux-tutorial/assets/js/134.f15edd55.js"><link rel="prefetch" href="/linux-tutorial/assets/js/135.f64a41b5.js"><link rel="prefetch" href="/linux-tutorial/assets/js/136.29678524.js"><link rel="prefetch" href="/linux-tutorial/assets/js/137.9c43f91c.js"><link rel="prefetch" href="/linux-tutorial/assets/js/138.ffadb27b.js"><link rel="prefetch" href="/linux-tutorial/assets/js/139.2b708550.js"><link rel="prefetch" href="/linux-tutorial/assets/js/14.4342bdf7.js"><link rel="prefetch" href="/linux-tutorial/assets/js/140.862a81a9.js"><link rel="prefetch" href="/linux-tutorial/assets/js/141.b7c0871f.js"><link rel="prefetch" href="/linux-tutorial/assets/js/142.de57a7d2.js"><link rel="prefetch" href="/linux-tutorial/assets/js/143.d1286be6.js"><link rel="prefetch" href="/linux-tutorial/assets/js/144.78dea036.js"><link rel="prefetch" href="/linux-tutorial/assets/js/145.cd89bb50.js"><link rel="prefetch" href="/linux-tutorial/assets/js/146.c00ea063.js"><link rel="prefetch" href="/linux-tutorial/assets/js/147.6cf25c98.js"><link rel="prefetch" href="/linux-tutorial/assets/js/148.1041f769.js"><link rel="prefetch" href="/linux-tutorial/assets/js/149.b5566432.js"><link rel="prefetch" href="/linux-tutorial/assets/js/15.8796218f.js"><link rel="prefetch" href="/linux-tutorial/assets/js/150.e5c75119.js"><link rel="prefetch" href="/linux-tutorial/assets/js/151.5c388a5f.js"><link rel="prefetch" href="/linux-tutorial/assets/js/152.ee6213e5.js"><link rel="prefetch" href="/linux-tutorial/assets/js/153.1b602d8e.js"><link rel="prefetch" href="/linux-tutorial/assets/js/154.4ea59cb4.js"><link rel="prefetch" href="/linux-tutorial/assets/js/155.24b59ac3.js"><link rel="prefetch" href="/linux-tutorial/assets/js/156.9b15d371.js"><link rel="prefetch" href="/linux-tutorial/assets/js/157.8d1f9503.js"><link rel="prefetch" href="/linux-tutorial/assets/js/158.ccaead85.js"><link rel="prefetch" href="/linux-tutorial/assets/js/159.5b49ce1b.js"><link rel="prefetch" href="/linux-tutorial/assets/js/160.95a4fb36.js"><link rel="prefetch" href="/linux-tutorial/assets/js/161.cde930c9.js"><link rel="prefetch" href="/linux-tutorial/assets/js/162.7a754448.js"><link rel="prefetch" href="/linux-tutorial/assets/js/163.d55c6349.js"><link rel="prefetch" href="/linux-tutorial/assets/js/164.9ee339c2.js"><link rel="prefetch" href="/linux-tutorial/assets/js/165.30141050.js"><link rel="prefetch" href="/linux-tutorial/assets/js/166.464d423d.js"><link rel="prefetch" href="/linux-tutorial/assets/js/167.660c924d.js"><link rel="prefetch" href="/linux-tutorial/assets/js/168.2cae5c9c.js"><link rel="prefetch" href="/linux-tutorial/assets/js/169.1e24d7be.js"><link rel="prefetch" href="/linux-tutorial/assets/js/17.04ccb392.js"><link rel="prefetch" href="/linux-tutorial/assets/js/170.8572828e.js"><link rel="prefetch" href="/linux-tutorial/assets/js/171.cf33f986.js"><link rel="prefetch" href="/linux-tutorial/assets/js/172.36741bc1.js"><link rel="prefetch" href="/linux-tutorial/assets/js/173.65edcd81.js"><link rel="prefetch" href="/linux-tutorial/assets/js/174.08dd2802.js"><link rel="prefetch" href="/linux-tutorial/assets/js/175.0173e57f.js"><link rel="prefetch" href="/linux-tutorial/assets/js/176.b64d6d09.js"><link rel="prefetch" href="/linux-tutorial/assets/js/177.dcf9ae18.js"><link rel="prefetch" href="/linux-tutorial/assets/js/178.ae42ddc1.js"><link rel="prefetch" href="/linux-tutorial/assets/js/18.4e56fcb3.js"><link rel="prefetch" href="/linux-tutorial/assets/js/19.f21c7977.js"><link rel="prefetch" href="/linux-tutorial/assets/js/20.4c69b8ff.js"><link rel="prefetch" href="/linux-tutorial/assets/js/21.3aec2873.js"><link rel="prefetch" href="/linux-tutorial/assets/js/22.861e719b.js"><link rel="prefetch" href="/linux-tutorial/assets/js/23.578aedc7.js"><link rel="prefetch" href="/linux-tutorial/assets/js/24.57eb980d.js"><link rel="prefetch" href="/linux-tutorial/assets/js/25.cade1e03.js"><link rel="prefetch" href="/linux-tutorial/assets/js/26.d4c42c11.js"><link rel="prefetch" href="/linux-tutorial/assets/js/27.e67320de.js"><link rel="prefetch" href="/linux-tutorial/assets/js/28.5d42931b.js"><link rel="prefetch" href="/linux-tutorial/assets/js/29.78c32762.js"><link rel="prefetch" href="/linux-tutorial/assets/js/3.1986f040.js"><link rel="prefetch" href="/linux-tutorial/assets/js/30.4495d9ce.js"><link rel="prefetch" href="/linux-tutorial/assets/js/31.95d35ed3.js"><link rel="prefetch" href="/linux-tutorial/assets/js/32.dc04efd9.js"><link rel="prefetch" href="/linux-tutorial/assets/js/33.5f1f572a.js"><link rel="prefetch" href="/linux-tutorial/assets/js/34.93972f88.js"><link rel="prefetch" href="/linux-tutorial/assets/js/35.bc6d3388.js"><link rel="prefetch" href="/linux-tutorial/assets/js/36.209d75c8.js"><link rel="prefetch" href="/linux-tutorial/assets/js/37.d30c94d3.js"><link rel="prefetch" href="/linux-tutorial/assets/js/38.02682c6d.js"><link rel="prefetch" href="/linux-tutorial/assets/js/39.7d6ee8db.js"><link rel="prefetch" href="/linux-tutorial/assets/js/4.896de413.js"><link rel="prefetch" href="/linux-tutorial/assets/js/40.7925dcab.js"><link rel="prefetch" href="/linux-tutorial/assets/js/41.58fb9c6a.js"><link rel="prefetch" href="/linux-tutorial/assets/js/42.2a87c226.js"><link rel="prefetch" href="/linux-tutorial/assets/js/43.d181a9c7.js"><link rel="prefetch" href="/linux-tutorial/assets/js/44.0476bb9a.js"><link rel="prefetch" href="/linux-tutorial/assets/js/45.52a56f6c.js"><link rel="prefetch" href="/linux-tutorial/assets/js/46.8bbaa61c.js"><link rel="prefetch" href="/linux-tutorial/assets/js/47.a8d3f059.js"><link rel="prefetch" href="/linux-tutorial/assets/js/48.a36fbedb.js"><link rel="prefetch" href="/linux-tutorial/assets/js/49.1799d727.js"><link rel="prefetch" href="/linux-tutorial/assets/js/5.1e8af3f8.js"><link rel="prefetch" href="/linux-tutorial/assets/js/50.f12984d3.js"><link rel="prefetch" href="/linux-tutorial/assets/js/51.d4ddd236.js"><link rel="prefetch" href="/linux-tutorial/assets/js/52.87a15496.js"><link rel="prefetch" href="/linux-tutorial/assets/js/53.701965d2.js"><link rel="prefetch" href="/linux-tutorial/assets/js/54.cc68ce47.js"><link rel="prefetch" href="/linux-tutorial/assets/js/55.653237e5.js"><link rel="prefetch" href="/linux-tutorial/assets/js/56.1baa6aea.js"><link rel="prefetch" href="/linux-tutorial/assets/js/57.09785e4b.js"><link rel="prefetch" href="/linux-tutorial/assets/js/58.64f3994d.js"><link rel="prefetch" href="/linux-tutorial/assets/js/59.9df45c80.js"><link rel="prefetch" href="/linux-tutorial/assets/js/6.7e1ac443.js"><link rel="prefetch" href="/linux-tutorial/assets/js/60.f2ffc564.js"><link rel="prefetch" href="/linux-tutorial/assets/js/61.b4b7dde2.js"><link rel="prefetch" href="/linux-tutorial/assets/js/62.74ecad97.js"><link rel="prefetch" href="/linux-tutorial/assets/js/63.86c2c4b7.js"><link rel="prefetch" href="/linux-tutorial/assets/js/64.a8104d1e.js"><link rel="prefetch" href="/linux-tutorial/assets/js/65.f0e9a242.js"><link rel="prefetch" href="/linux-tutorial/assets/js/66.3e058e54.js"><link rel="prefetch" href="/linux-tutorial/assets/js/67.f35fdc92.js"><link rel="prefetch" href="/linux-tutorial/assets/js/68.49d0163a.js"><link rel="prefetch" href="/linux-tutorial/assets/js/69.9d26e579.js"><link rel="prefetch" href="/linux-tutorial/assets/js/7.44a8110c.js"><link rel="prefetch" href="/linux-tutorial/assets/js/70.595c942e.js"><link rel="prefetch" href="/linux-tutorial/assets/js/71.c08f3394.js"><link rel="prefetch" href="/linux-tutorial/assets/js/72.c0e7fd28.js"><link rel="prefetch" href="/linux-tutorial/assets/js/73.059936b7.js"><link rel="prefetch" href="/linux-tutorial/assets/js/74.c5bd8446.js"><link rel="prefetch" href="/linux-tutorial/assets/js/75.43cb35df.js"><link rel="prefetch" href="/linux-tutorial/assets/js/76.81eff8a5.js"><link rel="prefetch" href="/linux-tutorial/assets/js/77.13799166.js"><link rel="prefetch" href="/linux-tutorial/assets/js/78.bfd8b227.js"><link rel="prefetch" href="/linux-tutorial/assets/js/79.c643ae63.js"><link rel="prefetch" href="/linux-tutorial/assets/js/8.d908ccdf.js"><link rel="prefetch" href="/linux-tutorial/assets/js/80.6774c39d.js"><link rel="prefetch" href="/linux-tutorial/assets/js/81.1e0cf9b0.js"><link rel="prefetch" href="/linux-tutorial/assets/js/82.07ec7389.js"><link rel="prefetch" href="/linux-tutorial/assets/js/83.c5bf5183.js"><link rel="prefetch" href="/linux-tutorial/assets/js/84.41a9c9da.js"><link rel="prefetch" href="/linux-tutorial/assets/js/85.417359ad.js"><link rel="prefetch" href="/linux-tutorial/assets/js/86.4fab0b07.js"><link rel="prefetch" href="/linux-tutorial/assets/js/87.e89d0800.js"><link rel="prefetch" href="/linux-tutorial/assets/js/88.da8e748b.js"><link rel="prefetch" href="/linux-tutorial/assets/js/89.dc1f03ca.js"><link rel="prefetch" href="/linux-tutorial/assets/js/90.d9814c8e.js"><link rel="prefetch" href="/linux-tutorial/assets/js/91.d2b0823a.js"><link rel="prefetch" href="/linux-tutorial/assets/js/92.407929d3.js"><link rel="prefetch" href="/linux-tutorial/assets/js/93.7b975c37.js"><link rel="prefetch" href="/linux-tutorial/assets/js/94.e6aa7f65.js"><link rel="prefetch" href="/linux-tutorial/assets/js/95.0d268a19.js"><link rel="prefetch" href="/linux-tutorial/assets/js/96.d3ebc4e5.js"><link rel="prefetch" href="/linux-tutorial/assets/js/97.4cc827d1.js"><link rel="prefetch" href="/linux-tutorial/assets/js/98.87d8de27.js"><link rel="prefetch" href="/linux-tutorial/assets/js/99.a360003c.js">
    <link rel="stylesheet" href="/linux-tutorial/assets/css/0.styles.7e75da3d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/linux-tutorial/" class="home-link router-link-active"><img src="/linux-tutorial/mlogo.svg" alt="Linux 系统教程（笔记）" class="logo"> <span class="site-name can-hide">Linux 系统教程（笔记）</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/linux-tutorial/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/linux-tutorial/tutorial-basis/" class="nav-link router-link-active">
  鸟哥私房菜-基础篇
</a></div><div class="nav-item"><a href="/linux-tutorial/discuss.html" class="nav-link">
  参与讨论
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="笔记精选汇总" class="dropdown-title"><span class="title">笔记精选汇总</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/zq99299/repository-summary" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub 站
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://book.mrcode.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  国内镜像站
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <a href="https://github.com/zq99299/linux-tutorial" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/linux-tutorial/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/linux-tutorial/tutorial-basis/" class="nav-link router-link-active">
  鸟哥私房菜-基础篇
</a></div><div class="nav-item"><a href="/linux-tutorial/discuss.html" class="nav-link">
  参与讨论
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="笔记精选汇总" class="dropdown-title"><span class="title">笔记精选汇总</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/zq99299/repository-summary" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub 站
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://book.mrcode.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  国内镜像站
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <a href="https://github.com/zq99299/linux-tutorial" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/linux-tutorial/tutorial-basis/" class="sidebar-link">Linux 基础篇（鸟哥私房菜）- 第四版</a></li><li><a href="/linux-tutorial/tutorial-basis/00/" class="sidebar-link">00. 计算机概论</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>01. Linux 是什么/如何学习</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>02. 主机规划与磁盘分区</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>03. 安装 CentOS 7.x</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>04. 首次登陆与线上求助</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>05. Linux 的文件权限与目录配置</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>06. Linux 文件与目录管理</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>07. Linux 磁盘与文件系统管理</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>08. 文件与文件系统的压缩、打包与备份</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>09. vim 程序编辑器</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>10. 认识与学习 BASH</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>11. 正则表达式与文件格式化处理</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>12. 学习 Shell Scripts</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>13. Linux 账号管理与 ACL 权限设置</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>14. 磁盘配额（Quota）与进阶文件系统管理</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/linux-tutorial/tutorial-basis/14/" class="sidebar-link">磁盘配额（Quota）与进阶文件系统管理</a></li><li><a href="/linux-tutorial/tutorial-basis/14/01.html" class="sidebar-link">磁盘配额（Quota）的应用于实践</a></li><li><a href="/linux-tutorial/tutorial-basis/14/02.html" class="active sidebar-link">软件磁盘阵列（Software RAID）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/linux-tutorial/tutorial-basis/14/02.html#什么是-raid" class="sidebar-link">什么是 RAID</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/linux-tutorial/tutorial-basis/14/02.html#raid-0-等量模式-stripe：效能最佳" class="sidebar-link">RAID-0 等量模式 stripe：效能最佳</a></li><li class="sidebar-sub-header"><a href="/linux-tutorial/tutorial-basis/14/02.html#raid-1-映像模式-mirror：完整备份" class="sidebar-link">RAID-1 映像模式 mirror：完整备份</a></li><li class="sidebar-sub-header"><a href="/linux-tutorial/tutorial-basis/14/02.html#raid-1-0，raid-0-1" class="sidebar-link">RAID 1+0，RAID 0+1</a></li><li class="sidebar-sub-header"><a href="/linux-tutorial/tutorial-basis/14/02.html#raid-5：效能与数据备份的均衡考虑" class="sidebar-link">RAID 5：效能与数据备份的均衡考虑</a></li><li class="sidebar-sub-header"><a href="/linux-tutorial/tutorial-basis/14/02.html#spare-disk：预备磁盘的功能" class="sidebar-link">Spare Disk：预备磁盘的功能</a></li><li class="sidebar-sub-header"><a href="/linux-tutorial/tutorial-basis/14/02.html#磁盘阵列的优点" class="sidebar-link">磁盘阵列的优点</a></li></ul></li><li class="sidebar-sub-header"><a href="/linux-tutorial/tutorial-basis/14/02.html#software、hardware-raid" class="sidebar-link">software、hardware RAID</a></li><li class="sidebar-sub-header"><a href="/linux-tutorial/tutorial-basis/14/02.html#磁盘阵列的设置" class="sidebar-link">磁盘阵列的设置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/linux-tutorial/tutorial-basis/14/02.html#磁盘分区" class="sidebar-link">磁盘分区</a></li><li class="sidebar-sub-header"><a href="/linux-tutorial/tutorial-basis/14/02.html#配置-raid" class="sidebar-link">配置 RAID</a></li><li class="sidebar-sub-header"><a href="/linux-tutorial/tutorial-basis/14/02.html#格式化与挂载使用-raid" class="sidebar-link">格式化与挂载使用 RAID</a></li></ul></li><li class="sidebar-sub-header"><a href="/linux-tutorial/tutorial-basis/14/02.html#仿真-raid-错误的救援模式" class="sidebar-link">仿真 RAID 错误的救援模式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/linux-tutorial/tutorial-basis/14/02.html#语法" class="sidebar-link">语法</a></li><li class="sidebar-sub-header"><a href="/linux-tutorial/tutorial-basis/14/02.html#设置磁盘为错误" class="sidebar-link">设置磁盘为错误</a></li><li class="sidebar-sub-header"><a href="/linux-tutorial/tutorial-basis/14/02.html#将出错的磁盘移除并加入新磁盘" class="sidebar-link">将出错的磁盘移除并加入新磁盘</a></li></ul></li><li class="sidebar-sub-header"><a href="/linux-tutorial/tutorial-basis/14/02.html#开机自动启动-raid-并自动挂载" class="sidebar-link">开机自动启动 RAID 并自动挂载</a></li><li class="sidebar-sub-header"><a href="/linux-tutorial/tutorial-basis/14/02.html#关闭软件-raid（重要）" class="sidebar-link">关闭软件 RAID（重要）</a></li></ul></li><li><a href="/linux-tutorial/tutorial-basis/14/03.html" class="sidebar-link">逻辑滚动条管理员（Logical Volume Manager）</a></li><li><a href="/linux-tutorial/tutorial-basis/14/04.html" class="sidebar-link">重点回顾</a></li><li><a href="/linux-tutorial/tutorial-basis/14/05.html" class="sidebar-link">本章习题</a></li><li><a href="/linux-tutorial/tutorial-basis/14/06.html" class="sidebar-link">参考数据与延伸阅读</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>15. 例行性工作排程（crontab）</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>16. 进程管理与 SELinux 初探</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>17. 认识系统服务（daemons）</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>18. 认识与分析登录文件</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>19. 开机流程、模块管理与 Loader</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>20. 基础系统设置与备份策略</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>21. 软件安装：原始码与 Tarball</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>22. 软件安装 RPM、SRPM、YUM</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="软件磁盘阵列（software-raid）"><a href="#软件磁盘阵列（software-raid）" class="header-anchor">#</a> 软件磁盘阵列（Software RAID）</h1> <h2 id="什么是-raid"><a href="#什么是-raid" class="header-anchor">#</a> 什么是 RAID</h2> <p>Redundant Arrays of Inexpensive Disks 简称 RAID，翻译为：容错式链家磁盘阵列。</p> <p>RAID 通过一种技术（软件或硬件），将多个较小的磁盘整合成为一个较大的磁盘，而且还具有数据保护功能。根据等级不同，整合后的磁盘具有不同的功能，基本常见的 level 有如下几种：</p> <h3 id="raid-0-等量模式-stripe：效能最佳"><a href="#raid-0-等量模式-stripe：效能最佳" class="header-anchor">#</a> RAID-0 等量模式 stripe：效能最佳</h3> <p>该模式如果使用相同型号与容量的磁盘来组成时，效果较佳。RAID 将磁盘切出等量的区块（chunk），一般可设置为 4K~1M 之间，当一个文件要写入 RAID 时，该文件会依据 chunk 的大小切割好，再依序放到各个磁盘里。会优先等量存放到各个磁盘上去，比如：有两块磁盘都是 100G，你有一个文件 100M，那么每个磁盘会分到 50MB 的容量，但是如果一块磁盘是 50G，另外一块是 100G，由于是等量，但是由于磁盘小磁盘先被放满，那么其他数据就会落到另一块磁盘上，这种情况下效能就降低了，因为所有压力由一块磁盘承担了。</p> <p><img src="/linux-tutorial/assets/img/image-20200227143813650.a20095d6.png" alt="image-20200227143813650"></p> <p>这种模式下，越多的硬盘组成的 RAID-0 理论上效能会越好，因为每块磁盘负责的数据量更低了，但是 <strong>只要有任何一块磁盘顺坏，在 RAID 上面的所有数据都会丢失而无法读取</strong>。</p> <p>因为等量分散在每块硬盘上，坏掉一块硬盘，意味着有部分数据丢失了，那么一个文件的部分数据丢失了，不完整了，可能该文件也就损坏了</p> <h3 id="raid-1-映像模式-mirror：完整备份"><a href="#raid-1-映像模式-mirror：完整备份" class="header-anchor">#</a> RAID-1 映像模式 mirror：完整备份</h3> <p>建议使用相同磁盘容量，最好是一样的磁盘，如果是不同容量的磁盘组成，那么总容量将以最小的那一块为主。</p> <p>这种模式主要是：让同一份数据，完整的保存在两块磁盘上。比如：100MB 的文件，且目前只有 两块硬盘组成 RAID-1 时，那么每块硬盘上都会写入 100MB 的数据。由于两块磁盘内容一模一样，好像镜子映照出来一样，所以也称为 mirror 模式</p> <p><img src="/linux-tutorial/assets/img/image-20200227144535061.022d6273.png" alt="image-20200227144535061"></p> <p>如图，一份数据被写入到两块磁盘中，如果使用软件来做磁盘阵列，那么效能会大大降低，因为只有一个南桥，一份数据要写入两次。如果使用的是 RAID（磁盘阵列卡）时，阵列卡会主动复制一份儿不使用系统的 I/O 总线，效能就还可以。</p> <p>由于是映像数据，当其中一块硬盘损坏，数据还是完整的。</p> <p>RAID-1 最大的优点大概就在于数据的备份。用空间换安全。写入效能不佳，但是读取效能还不错，多个 processes 在读取同一份数据时，RAID 会自行取得最佳的读取平衡</p> <h3 id="raid-1-0，raid-0-1"><a href="#raid-1-0，raid-0-1" class="header-anchor">#</a> RAID 1+0，RAID 0+1</h3> <p>RAID-0 效能佳，数据不安全。RAID-1 数据安全，但效能不佳。将两者组合起来就形成了：</p> <ul><li>RAID 1 + 0：先让两块磁盘组成 RAID 1（共有两组），再让这两组 RAID 1 再组成一组 RAID 0</li> <li>RAID 0 + 1：则与上面相反</li></ul> <p><img src="/linux-tutorial/assets/img/image-20200227145429427.c0786c46.png" alt="image-20200227145429427"></p> <p>此种方式，最坏的可能性是同时坏掉 b 和 c，也就是 RAID 1 中的其中一块。那么数据都能保证完整。此种方式也是目前存储设备厂商推荐的方法</p> <p>假设你有 20 快磁盘组成的系统，每两块组成一个 RAID 1，总共有 10 组可以自己复原的系统，再让这 10 组组成一个新的 RAID 0，速度立刻拉升 10 倍了。同时注意：因为每组 RAID 1 是个别独立存在的，因此任何一块磁盘损坏，数据都是从另一块磁盘直接复制过来重建，并不像 RAID5/RAID6 必须要整组 RAID 的磁盘共同重建一块独立的磁盘系统，而且 RAID 1 与 RAID 0 不需要经过计算的（striping），读写效率也比其他的 RAID 等级好太多了，这也是为什么会推荐 RAID1 + 0 方式了</p> <h3 id="raid-5：效能与数据备份的均衡考虑"><a href="#raid-5：效能与数据备份的均衡考虑" class="header-anchor">#</a> RAID 5：效能与数据备份的均衡考虑</h3> <p>RAID 5 至少需要三块以上的磁盘才能够组成这种类型的磁盘阵列。数据写入类似 RAID 0，不过每个循环的写入过程中（striping），在每块磁盘还加入一个同位检查数据（Parity），该数据会记录其他磁盘的备份数据，用于当有磁盘损坏时的救援。</p> <p><img src="/linux-tutorial/assets/img/image-20200227150303026.45c62b4d.png" alt="image-20200227150303026"></p> <p>每个循环写入时，都会有部分的同为检查码 parity 被记录，并且记录的同位检查码每次都记录在不同的磁盘，当任何一个磁盘损坏时，可以由其他磁盘的检查码来重建原磁盘内的数据，由于有同位检查码，RAID 5 的总容量会是整体磁盘数量减 1 快磁盘。原本 3 块磁盘，只剩下 3-1 =2 快磁盘的容量。当磁盘损坏数量大于等于 2 块时，整组 RAID 5 的数据就损坏了。因此 RAID 5 预设只能支持一块磁盘损坏的情况</p> <p>读写效能上的比较：</p> <ul><li>读：由于多快磁盘，效率堪比 RAID-0</li> <li>写：有同位检查码 parity的计算，写入效能与系统的硬件关系较大，尤其当使用软件磁盘阵列时，parity 是通过 CPU 去计算而非专职的磁盘阵列卡，所以写效率需要评估</li></ul> <p>RAID 5 仅能支持一块磁盘的损坏，因此出现了 RAID 6，RAID 6 使用 2 块磁盘作为 parity 的存储。所以当两块磁盘损坏时，数据还完整</p> <h3 id="spare-disk：预备磁盘的功能"><a href="#spare-disk：预备磁盘的功能" class="header-anchor">#</a> Spare Disk：预备磁盘的功能</h3> <p>当磁盘阵列损坏时，需要更换新的硬盘，并重建原本的数据。</p> <p>更换上新的硬盘并顺利启动磁盘阵列后，磁盘阵列会主动重建（rebuild）原本损坏那块磁盘的数据到新的磁盘上，这是磁盘阵列的有点。必过，需要手动插拨硬盘（更换坏掉的硬盘），如果你的系统支持热插播，那么不需要关机就可以完成数据重建</p> <p>为了让系统可以实时的在坏掉硬盘时主动重建，就需要预备磁盘（spare disk）。就是一块或多块磁盘不包含在原本的磁盘阵列等级中的磁盘，当磁盘阵列中的磁盘顺坏时，则会被主动拉进磁盘阵列中，将坏的磁盘移除磁盘阵列，并重建数据。</p> <p>同样，如果你的磁盘阵列支持热插拨，拔掉旧硬盘，换上新硬盘，并设置为 spare disk。就更方便了</p> <p>举例来说“有一个磁盘阵列可允许 16 快磁盘的数量，只有 10 块硬盘（每块 250G），用了 9 快硬盘组成 RAID 5。 1 快硬盘作为 spare disk，那么该磁盘阵列总容量为  (9-1)*250G=2000G。两年后看信号灯才发现坏掉了一块磁盘，那么之前预备的那块 spare disk 被自动拉进磁盘阵列了。 对数据没有任何影响</p> <h3 id="磁盘阵列的优点"><a href="#磁盘阵列的优点" class="header-anchor">#</a> 磁盘阵列的优点</h3> <p>如果要磁盘阵列，应该考虑：</p> <ol><li>数据安全与可靠性：不是指网络信息安全，而是当硬件（磁盘）损坏时，数据是否能保证不丢失</li> <li>读写效率：例如 RAID 0 可以加强读写效率，让你的系统 I/O 部分得到改善</li> <li>容量：可以让多块磁盘组合起来，也就意味着单一文件系统可以有相当大的容量</li></ol> <p>尤其是数据的可靠性与完整性更是使用 RAID 的考虑重点。</p> <p>各个等级优缺点如下</p> <table><thead><tr><th style="text-align:center;">项目</th> <th style="text-align:center;">RAID 0</th> <th style="text-align:center;">RAID 1</th> <th style="text-align:center;">RAID 10</th> <th style="text-align:center;">RAID 5</th> <th style="text-align:center;">RAID 6</th></tr></thead> <tbody><tr><td style="text-align:center;">最少磁盘</td> <td style="text-align:center;">2</td> <td style="text-align:center;">2</td> <td style="text-align:center;">4</td> <td style="text-align:center;">3</td> <td style="text-align:center;">4</td></tr> <tr><td style="text-align:center;">最大容错磁盘（1）</td> <td style="text-align:center;">无</td> <td style="text-align:center;">n-1</td> <td style="text-align:center;">n/2</td> <td style="text-align:center;">1</td> <td style="text-align:center;">2</td></tr> <tr><td style="text-align:center;">数据安全性（1）</td> <td style="text-align:center;">完全没有</td> <td style="text-align:center;">最佳</td> <td style="text-align:center;">最佳</td> <td style="text-align:center;">好</td> <td style="text-align:center;">比 RAID5 好</td></tr> <tr><td style="text-align:center;">理论写入效率（2）</td> <td style="text-align:center;">n</td> <td style="text-align:center;">1</td> <td style="text-align:center;">n/2</td> <td style="text-align:center;">&lt; n-1</td> <td style="text-align:center;">&lt; n-2</td></tr> <tr><td style="text-align:center;">理论读取效率（2）</td> <td style="text-align:center;">n</td> <td style="text-align:center;">n</td> <td style="text-align:center;">n</td> <td style="text-align:center;">&lt; n-1</td> <td style="text-align:center;">&lt; n-2</td></tr> <tr><td style="text-align:center;">可用容量（3）</td> <td style="text-align:center;">n</td> <td style="text-align:center;">1</td> <td style="text-align:center;">n/2</td> <td style="text-align:center;">n-1</td> <td style="text-align:center;">n -2</td></tr> <tr><td style="text-align:center;">一般应用</td> <td style="text-align:center;">强调效率单数据不重要</td> <td style="text-align:center;">资料与备份</td> <td style="text-align:center;">服务器、云系统常用</td> <td style="text-align:center;">资料与备份</td> <td style="text-align:center;">资料与备份</td></tr></tbody></table> <p>注意：因为 RAID5/6 读写需要经过 parity 的计算器，因此读写效率不会刚好满足使用的磁盘数量</p> <p>另外，根据使用情况的不同，一般推荐的磁盘阵列的等级也不同；比如几百 GB 单一大文件数据，会选择在 RAID 6 ，能满足读写需求还有数据完整性保证。如果是在云程序环境中，因为需要确保每个虚拟机能够快速反应及提供数据完整性，因此 RAID5/6 效率较弱的等级是不考虑的，总结来说，大概就剩下  RAID 10 能满足云环境的效率需求了。在某些更特别的环境下，如果搭配 SSD 那么读写效率上会更好</p> <h2 id="software、hardware-raid"><a href="#software、hardware-raid" class="header-anchor">#</a> software、hardware RAID</h2> <p>磁盘阵列分为软件与硬件磁盘阵列</p> <p>硬件磁盘阵列 hardware RAID 是通过磁盘阵列卡来达成数组的目的。上面有一块专门的芯片处理 RAID 任务，那么很多任务（如 RAID 5 的同为检查码计算）就不会重复消耗原本系统的 I/O 总线。理论上效率更好。另外一般的中高阶磁盘阵列卡都支持热插拨</p> <p>磁盘阵列卡好的上万，低价的可能只能支持到 RAID 0 与 1，同时还需要磁盘阵列卡的驱动程序，才能使用</p> <p>由于磁盘阵列有很多优秀的功能，但是很贵，因此就出现了软件仿真磁盘阵列功能，</p> <p>软件磁盘阵列 software RAID 主要通过软件来仿真数组的任务，因此会耗费较多的系统资源，如 CPU 运算和 IO 总线等资源。由于个人计算机的发展快速，这些限制还不算严重，可以玩一玩软件磁盘阵列</p> <p>以 CentOS 提供的软件 mdadm 磁盘阵列来说，它会以 partition 或 disk 为磁盘单位，意味着你不需要两块以上的磁盘，只需要有两个以上的分区槽（partition）就能过设计你的磁盘阵列。它支持的等级有 RAID0/1/5 spare disk 等，而且提供的管理机制还能达到类似热插拨的功能，可以在线（文件系统正常使用）进行分区槽的抽换。</p> <p>硬件磁盘阵列在 Linux 下看起来就是一块实际的大磁盘，因此硬件磁盘阵列文件名为 `/dev/sd[a-p],因为使用到 SCSI 的模块的原因。</p> <p>软件磁盘阵列时系统仿真的，因此使用的文件名是系统的装置文件，文件名为 <code>/dev/md0 /dev/md1 ...</code></p> <p>Intel 的南桥附赠的磁盘阵列功能，在 windows 视乎是完整的磁盘阵列，但是在 Linux 下被视为是软件磁盘阵列的一种，因此如果你有设置过 Intel 的南桥芯片磁盘阵列，那么在 Linux 下会是 <code>/dev/md126、/dev/md127</code> 之类的装置文件名，而他的分区槽是 <code>/dev/md126p1、/dev/md126p2</code> 之类</p> <h2 id="磁盘阵列的设置"><a href="#磁盘阵列的设置" class="header-anchor">#</a> 磁盘阵列的设置</h2> <p>很简单，一个指令即可</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">mdadm</span> --detail /dev/md0
<span class="token function">mdadm</span> --create /dev/md<span class="token punctuation">[</span><span class="token number">0</span>-9<span class="token punctuation">]</span> --auto<span class="token operator">=</span>yes --level<span class="token operator">=</span><span class="token punctuation">[</span>015<span class="token punctuation">]</span> --chunk<span class="token operator">=</span>NK --raid-devices<span class="token operator">=</span>N --spare-devices<span class="token operator">=</span>N /dev/sdx /dev/hdx<span class="token punctuation">..</span>.

选项与参数：

	--create：创建 RAID 关键词
	--auto<span class="token operator">=</span>yes：决定建立后面接的软件磁盘阵列装置。也就是 <span class="token variable"><span class="token variable">`</span>/dev/md0 、/dev/md1 <span class="token punctuation">..</span>.<span class="token variable">`</span></span>
	--chunk<span class="token operator">=</span>NK：决定装置的 chunk 大小，也可以当成 stripe 大小，一般是 64K 或 512K
	--raid-devices<span class="token operator">=</span>N：使用几个磁盘（partition）作为磁盘阵列的装置
	--spare-devices<span class="token operator">=</span>N：使用几个磁盘作为备用（spare）装置
	--level<span class="token operator">=</span><span class="token punctuation">[</span>015<span class="token punctuation">]</span>：设置这组磁盘阵列的等级。支持很多，不过建议只要用 <span class="token number">0</span>、1、5
	--detail：后面接的那个磁盘阵列装置的详细信息
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>如上语法中，谈到后面接装置名，这些装置文件可以是整块磁盘（如 /dev/sdb），也可以是分区槽（如 <code>/dev/sdb1</code>） 之类，但是这些装置文件名的总数必须要等于 <code>--raid-devices</code>  与 <code>--spare-devices</code> 的个数综合才行。</p> <p>下面使用测试机创建一个 RAID5 的软件磁盘阵列，磁盘阵列规划如下：</p> <ul><li>利用 4 个 partition 组成 RAID5</li> <li>每个 partition 约 1GB，需确定每个 partition 一样大较佳</li> <li>利用 1 个 partition 设置为 spare disk</li> <li>chunk 设置为 256K</li> <li>spare disk 的大小与其他 RAID 所需 partition 一样大</li> <li>将此 RAID 5 装置挂载到 <code>/srv/raid</code> 目录下</li></ul> <h3 id="磁盘分区"><a href="#磁盘分区" class="header-anchor">#</a> 磁盘分区</h3> <p>下面进行分区，<a href="../07/03">分区手段参考之前的的章节</a></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 查看当前磁盘状态</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># lsblk</span>
NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda               <span class="token number">8</span>:0    <span class="token number">0</span> <span class="token number">40</span>.8G  <span class="token number">0</span> disk 
├─sda1            <span class="token number">8</span>:1    <span class="token number">0</span>    2M  <span class="token number">0</span> part 
├─sda2            <span class="token number">8</span>:2    <span class="token number">0</span>    1G  <span class="token number">0</span> part /boot
└─sda3            <span class="token number">8</span>:3    <span class="token number">0</span>   30G  <span class="token number">0</span> part 
  ├─centos-root <span class="token number">253</span>:0    <span class="token number">0</span>   10G  <span class="token number">0</span> lvm  /
  ├─centos-swap <span class="token number">253</span>:1    <span class="token number">0</span>    1G  <span class="token number">0</span> lvm  <span class="token punctuation">[</span>SWAP<span class="token punctuation">]</span>
  └─centos-home <span class="token number">253</span>:2    <span class="token number">0</span>    5G  <span class="token number">0</span> lvm  /home
sdb               <span class="token number">8</span>:16   <span class="token number">0</span>    2G  <span class="token number">0</span> disk 
sr0              <span class="token number">11</span>:0    <span class="token number">1</span> <span class="token number">73</span>.6M  <span class="token number">0</span> rom  
<span class="token comment"># 上面发现一快 sda 磁盘，有三个分区，分区大小是 33 G 左右，也就是说还有 7 G 左右可以使用</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># lsblk -ip /dev/sda</span>
NAME                        MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
/dev/sda                      <span class="token number">8</span>:0    <span class="token number">0</span> <span class="token number">40</span>.8G  <span class="token number">0</span> disk 
<span class="token operator">|</span>-/dev/sda1                   <span class="token number">8</span>:1    <span class="token number">0</span>    2M  <span class="token number">0</span> part 
<span class="token operator">|</span>-/dev/sda2                   <span class="token number">8</span>:2    <span class="token number">0</span>    1G  <span class="token number">0</span> part /boot
<span class="token variable"><span class="token variable">`</span>-/dev/sda3                   <span class="token number">8</span>:3    <span class="token number">0</span>   30G  <span class="token number">0</span> part 
  <span class="token operator">|</span>-/dev/mapper/centos-root <span class="token number">253</span>:0    <span class="token number">0</span>   10G  <span class="token number">0</span> lvm  /
  <span class="token operator">|</span>-/dev/mapper/centos-swap <span class="token number">253</span>:1    <span class="token number">0</span>    1G  <span class="token number">0</span> lvm  <span class="token punctuation">[</span>SWAP<span class="token punctuation">]</span>
  <span class="token variable">`</span></span>-/dev/mapper/centos-home <span class="token number">253</span>:2    <span class="token number">0</span>    5G  <span class="token number">0</span> lvm  /home

<span class="token comment"># 那么下面</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># lsblk -ip /dev/sda</span>
NAME                        MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
/dev/sda                      <span class="token number">8</span>:0    <span class="token number">0</span> <span class="token number">40</span>.8G  <span class="token number">0</span> disk 
<span class="token operator">|</span>-/dev/sda1                   <span class="token number">8</span>:1    <span class="token number">0</span>    2M  <span class="token number">0</span> part 
<span class="token operator">|</span>-/dev/sda2                   <span class="token number">8</span>:2    <span class="token number">0</span>    1G  <span class="token number">0</span> part /boot
<span class="token variable"><span class="token variable">`</span>-/dev/sda3                   <span class="token number">8</span>:3    <span class="token number">0</span>   30G  <span class="token number">0</span> part 
  <span class="token operator">|</span>-/dev/mapper/centos-root <span class="token number">253</span>:0    <span class="token number">0</span>   10G  <span class="token number">0</span> lvm  /
  <span class="token operator">|</span>-/dev/mapper/centos-swap <span class="token number">253</span>:1    <span class="token number">0</span>    1G  <span class="token number">0</span> lvm  <span class="token punctuation">[</span>SWAP<span class="token punctuation">]</span>
  <span class="token variable">`</span></span>-/dev/mapper/centos-home <span class="token number">253</span>:2    <span class="token number">0</span>    5G  <span class="token number">0</span> lvm  /home
  
<span class="token comment"># 开始分区，总共需要分出来 5 个 1 g 的分区</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># gdisk /dev/sda</span>
GPT <span class="token function">fdisk</span> <span class="token punctuation">(</span>gdisk<span class="token punctuation">)</span> version <span class="token number">0.8</span>.10

Partition table scan:
  MBR: protective
  BSD: not present
  APM: not present
  GPT: present

Found valid GPT with protective MBR<span class="token punctuation">;</span> using GPT.
<span class="token comment"># 查看当前 磁盘 的状态</span>
Command <span class="token punctuation">(</span>? <span class="token keyword">for</span> <span class="token builtin class-name">help</span><span class="token punctuation">)</span>: p
Disk /dev/sda: <span class="token number">85491712</span> sectors, <span class="token number">40.8</span> GiB
Logical sector size: <span class="token number">512</span> bytes
Disk identifier <span class="token punctuation">(</span>GUID<span class="token punctuation">)</span>: 67038DBF-B66A-4D0F-92B2-BFBF0744CD1D
Partition table holds up to <span class="token number">128</span> entries
First usable sector is <span class="token number">34</span>, last usable sector is <span class="token number">85491678</span>
Partitions will be aligned on <span class="token number">2048</span>-sector boundaries
Total <span class="token function">free</span> space is <span class="token number">20467645</span> sectors <span class="token punctuation">(</span><span class="token number">9.8</span> GiB<span class="token punctuation">)</span>		<span class="token comment"># 空闲扇区</span>

Number  Start <span class="token punctuation">(</span>sector<span class="token punctuation">)</span>    End <span class="token punctuation">(</span>sector<span class="token punctuation">)</span>  Size       Code  Name
   <span class="token number">1</span>            <span class="token number">2048</span>            <span class="token number">6143</span>   <span class="token number">2.0</span> MiB     EF02  
   <span class="token number">2</span>            <span class="token number">6144</span>         <span class="token number">2103295</span>   <span class="token number">1024.0</span> MiB  0700  
   <span class="token number">3</span>         <span class="token number">2103296</span>        <span class="token number">65026047</span>   <span class="token number">30.0</span> GiB    8E00  

<span class="token comment"># 有上面可以看出来，实际上还有 9 g 左右可以使用</span>
Command <span class="token punctuation">(</span>? <span class="token keyword">for</span> <span class="token builtin class-name">help</span><span class="token punctuation">)</span>: n
Partition number <span class="token punctuation">(</span><span class="token number">4</span>-128, default <span class="token number">4</span><span class="token punctuation">)</span>: 
First sector <span class="token punctuation">(</span><span class="token number">34</span>-85491678, default <span class="token operator">=</span> <span class="token number">65026048</span><span class="token punctuation">)</span> or <span class="token punctuation">{</span>+-<span class="token punctuation">}</span>size<span class="token punctuation">{</span>KMGTP<span class="token punctuation">}</span>: 
Last sector <span class="token punctuation">(</span><span class="token number">65026048</span>-85491678, default <span class="token operator">=</span> <span class="token number">85491678</span><span class="token punctuation">)</span> or <span class="token punctuation">{</span>+-<span class="token punctuation">}</span>size<span class="token punctuation">{</span>KMGTP<span class="token punctuation">}</span>: +1G
Current <span class="token builtin class-name">type</span> is <span class="token string">'Linux filesystem'</span>
Hex code or GUID <span class="token punctuation">(</span>L to show codes, Enter <span class="token operator">=</span> <span class="token number">8300</span><span class="token punctuation">)</span>: Fd00
Changed <span class="token builtin class-name">type</span> of partition to <span class="token string">'Linux RAID'</span>
<span class="token comment"># 上面分区了一个，后面 4 个分区，就不贴出来了</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span>
Command <span class="token punctuation">(</span>? <span class="token keyword">for</span> <span class="token builtin class-name">help</span><span class="token punctuation">)</span>: P
Disk /dev/sda: <span class="token number">85491712</span> sectors, <span class="token number">40.8</span> GiB
Logical sector size: <span class="token number">512</span> bytes
Disk identifier <span class="token punctuation">(</span>GUID<span class="token punctuation">)</span>: 67038DBF-B66A-4D0F-92B2-BFBF0744CD1D
Partition table holds up to <span class="token number">128</span> entries
First usable sector is <span class="token number">34</span>, last usable sector is <span class="token number">85491678</span>
Partitions will be aligned on <span class="token number">2048</span>-sector boundaries
Total <span class="token function">free</span> space is <span class="token number">9981885</span> sectors <span class="token punctuation">(</span><span class="token number">4.8</span> GiB<span class="token punctuation">)</span>

Number  Start <span class="token punctuation">(</span>sector<span class="token punctuation">)</span>    End <span class="token punctuation">(</span>sector<span class="token punctuation">)</span>  Size       Code  Name
   <span class="token number">1</span>            <span class="token number">2048</span>            <span class="token number">6143</span>   <span class="token number">2.0</span> MiB     EF02  
   <span class="token number">2</span>            <span class="token number">6144</span>         <span class="token number">2103295</span>   <span class="token number">1024.0</span> MiB  0700  
   <span class="token number">3</span>         <span class="token number">2103296</span>        <span class="token number">65026047</span>   <span class="token number">30.0</span> GiB    8E00  
   <span class="token number">4</span>        <span class="token number">65026048</span>        <span class="token number">67123199</span>   <span class="token number">1024.0</span> MiB  FD00  Linux RAID
   <span class="token number">5</span>        <span class="token number">67123200</span>        <span class="token number">69220351</span>   <span class="token number">1024.0</span> MiB  FD00  Linux RAID
   <span class="token number">6</span>        <span class="token number">69220352</span>        <span class="token number">71317503</span>   <span class="token number">1024.0</span> MiB  FD00  Linux RAID
   <span class="token number">7</span>        <span class="token number">71317504</span>        <span class="token number">73414655</span>   <span class="token number">1024.0</span> MiB  FD00  Linux RAID
   <span class="token number">8</span>        <span class="token number">73414656</span>        <span class="token number">75511807</span>   <span class="token number">1024.0</span> MiB  FD00  Linux RAID
<span class="token comment"># 最后分区好的 5 个分区如上。每个都占用 1G 空间</span>
<span class="token comment"># 最后保存分区</span>
Command <span class="token punctuation">(</span>? <span class="token keyword">for</span> <span class="token builtin class-name">help</span><span class="token punctuation">)</span>: w

Final checks complete. About to <span class="token function">write</span> GPT data. THIS WILL OVERWRITE EXISTING
PARTITIONS<span class="token operator">!</span><span class="token operator">!</span>

Do you want to proceed? <span class="token punctuation">(</span>Y/N<span class="token punctuation">)</span>: y
OK<span class="token punctuation">;</span> writing new GUID partition table <span class="token punctuation">(</span>GPT<span class="token punctuation">)</span> to /dev/sda.
Warning: The kernel is still using the old partition table.
The new table will be used at the next reboot.
The operation has completed successfully.


<span class="token comment"># 再次确认分区</span>
Command <span class="token punctuation">(</span>? <span class="token keyword">for</span> <span class="token builtin class-name">help</span><span class="token punctuation">)</span>: p
Disk /dev/sda: <span class="token number">85491712</span> sectors, <span class="token number">40.8</span> GiB
Logical sector size: <span class="token number">512</span> bytes
Disk identifier <span class="token punctuation">(</span>GUID<span class="token punctuation">)</span>: 67038DBF-B66A-4D0F-92B2-BFBF0744CD1D
Partition table holds up to <span class="token number">128</span> entries
First usable sector is <span class="token number">34</span>, last usable sector is <span class="token number">85491678</span>
Partitions will be aligned on <span class="token number">2048</span>-sector boundaries
Total <span class="token function">free</span> space is <span class="token number">9981885</span> sectors <span class="token punctuation">(</span><span class="token number">4.8</span> GiB<span class="token punctuation">)</span>		<span class="token comment"># 空闲扇区</span>

Number  Start <span class="token punctuation">(</span>sector<span class="token punctuation">)</span>    End <span class="token punctuation">(</span>sector<span class="token punctuation">)</span>  Size       Code  Name
   <span class="token number">1</span>            <span class="token number">2048</span>            <span class="token number">6143</span>   <span class="token number">2.0</span> MiB     EF02  
   <span class="token number">2</span>            <span class="token number">6144</span>         <span class="token number">2103295</span>   <span class="token number">1024.0</span> MiB  0700  
   <span class="token number">3</span>         <span class="token number">2103296</span>        <span class="token number">65026047</span>   <span class="token number">30.0</span> GiB    8E00  
   <span class="token number">4</span>        <span class="token number">65026048</span>        <span class="token number">67123199</span>   <span class="token number">1024.0</span> MiB  FD00  Linux RAID
   <span class="token number">5</span>        <span class="token number">67123200</span>        <span class="token number">69220351</span>   <span class="token number">1024.0</span> MiB  FD00  Linux RAID
   <span class="token number">6</span>        <span class="token number">69220352</span>        <span class="token number">71317503</span>   <span class="token number">1024.0</span> MiB  FD00  Linux RAID
   <span class="token number">7</span>        <span class="token number">71317504</span>        <span class="token number">73414655</span>   <span class="token number">1024.0</span> MiB  FD00  Linux RAID
   <span class="token number">8</span>        <span class="token number">73414656</span>        <span class="token number">75511807</span>   <span class="token number">1024.0</span> MiB  FD00  Linux RAID

<span class="token comment"># 之前空闲扇区是 9.8G，现在还有 4.8G,也有 5 个分区，证明是分区成功了的</span>
<span class="token comment"># 最后记得分区相关的更新指令，否则使用 lsblk 还是看不到分区出来的 part </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br></div></div><p>上面复习了一下分区操作，下面开始配置 RAID</p> <h3 id="配置-raid"><a href="#配置-raid" class="header-anchor">#</a> 配置 RAID</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 确认分区槽</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># lsblk</span>
NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda               <span class="token number">8</span>:0    <span class="token number">0</span> <span class="token number">40</span>.8G  <span class="token number">0</span> disk 
├─sda1            <span class="token number">8</span>:1    <span class="token number">0</span>    2M  <span class="token number">0</span> part 
├─sda2            <span class="token number">8</span>:2    <span class="token number">0</span>    1G  <span class="token number">0</span> part /boot
├─sda3            <span class="token number">8</span>:3    <span class="token number">0</span>   30G  <span class="token number">0</span> part 
│ ├─centos-root <span class="token number">253</span>:0    <span class="token number">0</span>   10G  <span class="token number">0</span> lvm  /
│ ├─centos-swap <span class="token number">253</span>:1    <span class="token number">0</span>    1G  <span class="token number">0</span> lvm  <span class="token punctuation">[</span>SWAP<span class="token punctuation">]</span>
│ └─centos-home <span class="token number">253</span>:2    <span class="token number">0</span>    5G  <span class="token number">0</span> lvm  /home
├─sda4            <span class="token number">8</span>:4    <span class="token number">0</span>    1G  <span class="token number">0</span> part 
├─sda5            <span class="token number">8</span>:5    <span class="token number">0</span>    1G  <span class="token number">0</span> part 
├─sda6            <span class="token number">8</span>:6    <span class="token number">0</span>    1G  <span class="token number">0</span> part 
├─sda7            <span class="token number">8</span>:7    <span class="token number">0</span>    1G  <span class="token number">0</span> part 
└─sda8            <span class="token number">8</span>:8    <span class="token number">0</span>    1G  <span class="token number">0</span> part 
sdb               <span class="token number">8</span>:16   <span class="token number">0</span>    2G  <span class="token number">0</span> disk 
sr0              <span class="token number">11</span>:0    <span class="token number">1</span> <span class="token number">73</span>.6M  <span class="token number">0</span> rom 

<span class="token comment"># 以 mdadm 建立 RAID</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># mdadm --create /dev/md0 --auto=yes --level=5 --chunk=256K --raid-devices=4 --spare-devices=1 /dev/sda{4,5,6,7,8}</span>
mdadm: /dev/sda5 appears to contain an ext2fs <span class="token function">file</span> system
       <span class="token assign-left variable">size</span><span class="token operator">=</span>1048576K  <span class="token assign-left variable">mtime</span><span class="token operator">=</span>Sun Oct <span class="token number">27</span> <span class="token number">18</span>:05:52 <span class="token number">2019</span>	<span class="token comment"># 有时候出现这个信息,不用管</span>
Continue creating array? y
mdadm: Defaulting to version <span class="token number">1.2</span> metadata
mdadm: array /dev/md0 started.
<span class="token comment"># 详细的参数说明，查看前面章节，这里使用 {} 将重复的项目简化</span>
<span class="token comment"># 此外 dsa 5 提示 ext2fs 问题，是抓到之前的 filesystem</span>
<span class="token comment"># 去人创建，就会删除之前的的旧系统</span>

<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># mdadm --detail /dev/md0</span>
/dev/md0:																								<span class="token comment"># 装置文件名</span>
           Version <span class="token builtin class-name">:</span> <span class="token number">1.2</span>
     Creation Time <span class="token builtin class-name">:</span> Sat Feb <span class="token number">29</span> 06:13:57 <span class="token number">2020</span>						<span class="token comment"># 创建 RAID 的时间</span>
        Raid Level <span class="token builtin class-name">:</span> raid5															<span class="token comment"># RAID 等级，这里是 RAID5</span>
        Array Size <span class="token builtin class-name">:</span> <span class="token number">3139584</span> <span class="token punctuation">(</span><span class="token number">2.99</span> GiB <span class="token number">3.21</span> GB<span class="token punctuation">)</span>					<span class="token comment"># 整组 RAID 整组可用容量</span>
     Used Dev Size <span class="token builtin class-name">:</span> <span class="token number">1046528</span> <span class="token punctuation">(</span><span class="token number">1022.00</span> MiB <span class="token number">1071.64</span> MB<span class="token punctuation">)</span>		<span class="token comment"># 每块磁盘的容量</span>
      Raid Devices <span class="token builtin class-name">:</span> <span class="token number">4</span>																	<span class="token comment"># 组成 RAID 的磁盘数量</span>
     Total Devices <span class="token builtin class-name">:</span> <span class="token number">5</span>																	<span class="token comment"># 包含 spare 的总磁盘数量</span>
       Persistence <span class="token builtin class-name">:</span> Superblock is persistent

       Update Time <span class="token builtin class-name">:</span> Sat Feb <span class="token number">29</span> 06:14:06 <span class="token number">2020</span>
             State <span class="token builtin class-name">:</span> clean 															<span class="token comment"># 目前这个磁盘整理的使用状态</span>
    Active Devices <span class="token builtin class-name">:</span> <span class="token number">4</span>																	<span class="token comment"># active 启动的装置数量</span>
   Working Devices <span class="token builtin class-name">:</span> <span class="token number">5</span>																	<span class="token comment"># 目前使用此数组的数量</span>
    Failed Devices <span class="token builtin class-name">:</span> <span class="token number">0</span>																	<span class="token comment"># 损坏的装置数量</span>
     Spare Devices <span class="token builtin class-name">:</span> <span class="token number">1</span>																	<span class="token comment"># 预备磁盘的数量</span>

            Layout <span class="token builtin class-name">:</span> left-symmetric
        Chunk Size <span class="token builtin class-name">:</span> 256K																<span class="token comment"># chunk 的区块容量</span>

Consistency Policy <span class="token builtin class-name">:</span> resync

              Name <span class="token builtin class-name">:</span> study.centos.mrcode:0  <span class="token punctuation">(</span>local to <span class="token function">host</span> study.centos.mrcode<span class="token punctuation">)</span>
              UUID <span class="token builtin class-name">:</span> ba4883f9:75e8224b:6961ac93:d16adbf7
            Events <span class="token builtin class-name">:</span> <span class="token number">18</span>

    Number   Major   Minor   RaidDevice State
       <span class="token number">0</span>       <span class="token number">8</span>        <span class="token number">4</span>        <span class="token number">0</span>      active <span class="token function">sync</span>   /dev/sda4
       <span class="token number">1</span>       <span class="token number">8</span>        <span class="token number">5</span>        <span class="token number">1</span>      active <span class="token function">sync</span>   /dev/sda5
       <span class="token number">2</span>       <span class="token number">8</span>        <span class="token number">6</span>        <span class="token number">2</span>      active <span class="token function">sync</span>   /dev/sda6
       <span class="token number">5</span>       <span class="token number">8</span>        <span class="token number">7</span>        <span class="token number">3</span>      active <span class="token function">sync</span>   /dev/sda7

       <span class="token number">4</span>       <span class="token number">8</span>        <span class="token number">8</span>        -      spare   /dev/sda8
<span class="token comment"># 最后的 5 行数据，是目前 5 快磁盘分区的情况，4 个 active sync，1 个 spare</span>
<span class="token comment"># RaidDevice 指的是此 RAID 内的磁盘顺序</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br></div></div><p>由于磁盘阵列创建需要一些时间，所以最好等待几分钟再使用该指令 <code>mdadm --detail /dev/md0</code>查看磁盘阵列情况，否则有可能看到某些磁盘正在 <code>spare rebuilding</code> 之类的提示</p> <p>通过以上操作，就创建了一个 RAID5 且含有一块 spare disk 的磁盘阵列。</p> <p>还可以通过如下的文件来查看系统软件磁盘阵列的情况</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># cat /proc/mdstat </span>
Personalities <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>raid6<span class="token punctuation">]</span> <span class="token punctuation">[</span>raid5<span class="token punctuation">]</span> <span class="token punctuation">[</span>raid4<span class="token punctuation">]</span> 
md0 <span class="token builtin class-name">:</span> active raid5 sda7<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> sda8<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">(</span>S<span class="token punctuation">)</span> sda6<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> sda5<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> sda4<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
      <span class="token number">3139584</span> blocks super <span class="token number">1.2</span> level <span class="token number">5</span>, 256k chunk, algorithm <span class="token number">2</span> <span class="token punctuation">[</span><span class="token number">4</span>/4<span class="token punctuation">]</span> <span class="token punctuation">[</span>UUUU<span class="token punctuation">]</span>
      
unused devices: <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>上述属性信息， md0 的两行信息：</p> <ul><li><p>第一行：指出 md0 为 raid5，且使用了 sda7、sda6、sda5、sda4 四块磁盘。每个装置后面的中括号中的数字是此磁盘在 RAID 中的顺序（RaidDevice），<code>sda8[4](s)</code> 中的 s 则代表它为 spare 磁盘</p></li> <li><p>第二行：此磁盘阵列有 3139584 blocks（每个 block 为 1k），所以总容量为 3GB，使用 readi 5 等级，写入磁盘的小区块 chunk 为 256K，使用 algorithm2 磁盘阵列算法。</p> <p><code>[m/n]</code> 表示此数组需要 m 个装置，且 n 个装置正常运行。因此这里 需要 4 个装置且 4 个装置正常运作。</p> <p><code>[UUUU]</code> 表示 4 个所需的装置的启动情况，U 表示运作，若为<code>_</code>则表示不正常</p></li></ul> <h3 id="格式化与挂载使用-raid"><a href="#格式化与挂载使用-raid" class="header-anchor">#</a> 格式化与挂载使用 RAID</h3> <p>因为涉及到 xfs 文件系统的优化（第 7 章中有讲解到），所以这里参数为：</p> <ul><li>srtipe（chunk）容量为 256k， su=256k</li> <li>共有 4 块组成 RAID5，因此容量少一块， sw=3</li> <li>由上面两项计算出数据宽度为  256K*3=768K</li></ul> <p>所以整体要优化这个 XFS 文件系统就是这样：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># mkfs.xfs -f -d su=256k,sw=3 -r extsize=768k /dev/md0</span>
meta-data<span class="token operator">=</span>/dev/md0               <span class="token assign-left variable">isize</span><span class="token operator">=</span><span class="token number">512</span>    <span class="token assign-left variable">agcount</span><span class="token operator">=</span><span class="token number">8</span>, <span class="token assign-left variable">agsize</span><span class="token operator">=</span><span class="token number">98048</span> blks
         <span class="token operator">=</span>                       <span class="token assign-left variable">sectsz</span><span class="token operator">=</span><span class="token number">512</span>   <span class="token assign-left variable">attr</span><span class="token operator">=</span><span class="token number">2</span>, <span class="token assign-left variable">projid32bit</span><span class="token operator">=</span><span class="token number">1</span>
         <span class="token operator">=</span>                       <span class="token assign-left variable">crc</span><span class="token operator">=</span><span class="token number">1</span>        <span class="token assign-left variable">finobt</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">sparse</span><span class="token operator">=</span><span class="token number">0</span>
data     <span class="token operator">=</span>                       <span class="token assign-left variable">bsize</span><span class="token operator">=</span><span class="token number">4096</span>   <span class="token assign-left variable">blocks</span><span class="token operator">=</span><span class="token number">784384</span>, <span class="token assign-left variable">imaxpct</span><span class="token operator">=</span><span class="token number">25</span>
         <span class="token operator">=</span>                       <span class="token assign-left variable">sunit</span><span class="token operator">=</span><span class="token number">64</span>     <span class="token assign-left variable">swidth</span><span class="token operator">=</span><span class="token number">192</span> blks
naming   <span class="token operator">=</span>version <span class="token number">2</span>              <span class="token assign-left variable">bsize</span><span class="token operator">=</span><span class="token number">4096</span>   ascii-ci<span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">ftype</span><span class="token operator">=</span><span class="token number">1</span>
log      <span class="token operator">=</span>internal log           <span class="token assign-left variable">bsize</span><span class="token operator">=</span><span class="token number">4096</span>   <span class="token assign-left variable">blocks</span><span class="token operator">=</span><span class="token number">2560</span>, <span class="token assign-left variable">version</span><span class="token operator">=</span><span class="token number">2</span>
         <span class="token operator">=</span>                       <span class="token assign-left variable">sectsz</span><span class="token operator">=</span><span class="token number">512</span>   <span class="token assign-left variable">sunit</span><span class="token operator">=</span><span class="token number">64</span> blks, lazy-count<span class="token operator">=</span><span class="token number">1</span>
realtime <span class="token operator">=</span>none                   <span class="token assign-left variable">extsz</span><span class="token operator">=</span><span class="token number">786432</span> <span class="token assign-left variable">blocks</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">rtextents</span><span class="token operator">=</span><span class="token number">0</span>

<span class="token comment"># 给该装置挂载到 /srv/raid 目录</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># mkdir /srv/raid</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># mount /dev/md0 /srv/raid/</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># df -Th /srv/raid/</span>
文件系统       类型  容量  已用  可用 已用% 挂载点
/dev/md0       xfs   <span class="token number">3</span>.0G   33M  <span class="token number">3</span>.0G    <span class="token number">2</span>% /srv/raid

<span class="token comment"># 就看到多了一个 /dev/md0 的挂载装置了</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h2 id="仿真-raid-错误的救援模式"><a href="#仿真-raid-错误的救援模式" class="header-anchor">#</a> 仿真 RAID 错误的救援模式</h2> <p>万一磁盘阵列内的装置异常了，要怎么进行救援，下面进行仿真实践</p> <h3 id="语法"><a href="#语法" class="header-anchor">#</a> 语法</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># mdadm 救援方面的语法</span>
<span class="token function">mdadm</span> --manage /dev/md<span class="token punctuation">[</span><span class="token number">0</span>-9<span class="token punctuation">]</span> <span class="token punctuation">[</span>--add 装置<span class="token punctuation">]</span> <span class="token punctuation">[</span>--remove 装置<span class="token punctuation">]</span> <span class="token punctuation">[</span>--fail 装置<span class="token punctuation">]</span>

选项与参数：
	--add：将装置加入到该 md 中
	--remove：将装置从该 md 中移除
	--fail：将某个装置设置为出错状态
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="设置磁盘为错误"><a href="#设置磁盘为错误" class="header-anchor">#</a> 设置磁盘为错误</h3> <p>让一块磁盘变成错误，然后让 spare disk 自动开始重建</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 先复制一点数据到磁盘阵列中</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># cp -a /etc /var/log/ /srv/raid/</span>

<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># df -Th /srv/raid/</span>
Filesystem     Type  Size  Used Avail Use% Mounted on
/dev/md0       xfs   <span class="token number">3</span>.0G  121M  <span class="token number">2</span>.9G   <span class="token number">4</span>% /srv/raid
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># du -sm /srv/raid/*</span>
<span class="token number">42</span>      /srv/raid/etc
<span class="token number">45</span>      /srv/raid/log
<span class="token comment"># 已经复制过来文件了，并且依据看到使用量了</span>

<span class="token comment"># 1. 假设 /dev/sda6 这个磁盘出问题了，模拟方式如下</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># mdadm --manage /dev/md0  --fail /dev/sda6</span>
mdadm: <span class="token builtin class-name">set</span> /dev/sda6 faulty <span class="token keyword">in</span> /dev/md0
<span class="token comment"># 查看状态</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># mdadm --detail /dev/md0</span>
/dev/md0:
           Version <span class="token builtin class-name">:</span> <span class="token number">1.2</span>
     Creation Time <span class="token builtin class-name">:</span> Sat Feb <span class="token number">29</span> 06:13:57 <span class="token number">2020</span>
        Raid Level <span class="token builtin class-name">:</span> raid5
        Array Size <span class="token builtin class-name">:</span> <span class="token number">3139584</span> <span class="token punctuation">(</span><span class="token number">2.99</span> GiB <span class="token number">3.21</span> GB<span class="token punctuation">)</span>
     Used Dev Size <span class="token builtin class-name">:</span> <span class="token number">1046528</span> <span class="token punctuation">(</span><span class="token number">1022.00</span> MiB <span class="token number">1071.64</span> MB<span class="token punctuation">)</span>
      Raid Devices <span class="token builtin class-name">:</span> <span class="token number">4</span>
     Total Devices <span class="token builtin class-name">:</span> <span class="token number">5</span>
       Persistence <span class="token builtin class-name">:</span> Superblock is persistent

       Update Time <span class="token builtin class-name">:</span> Sat Feb <span class="token number">29</span> 07:57:44 <span class="token number">2020</span>
             State <span class="token builtin class-name">:</span> clean 
    Active Devices <span class="token builtin class-name">:</span> <span class="token number">4</span>
   Working Devices <span class="token builtin class-name">:</span> <span class="token number">4</span>
    Failed Devices <span class="token builtin class-name">:</span> <span class="token number">1</span>			<span class="token comment">#出错的有一个</span>
     Spare Devices <span class="token builtin class-name">:</span> <span class="token number">0</span>

            Layout <span class="token builtin class-name">:</span> left-symmetric
        Chunk Size <span class="token builtin class-name">:</span> 256K

Consistency Policy <span class="token builtin class-name">:</span> resync

              Name <span class="token builtin class-name">:</span> study.centos.mrcode:0  <span class="token punctuation">(</span>local to <span class="token function">host</span> study.centos.mrcode<span class="token punctuation">)</span>
              UUID <span class="token builtin class-name">:</span> ba4883f9:75e8224b:6961ac93:d16adbf7
            Events <span class="token builtin class-name">:</span> <span class="token number">37</span>

    Number   Major   Minor   RaidDevice State
       <span class="token number">0</span>       <span class="token number">8</span>        <span class="token number">4</span>        <span class="token number">0</span>      active <span class="token function">sync</span>   /dev/sda4
       <span class="token number">1</span>       <span class="token number">8</span>        <span class="token number">5</span>        <span class="token number">1</span>      active <span class="token function">sync</span>   /dev/sda5
       <span class="token number">4</span>       <span class="token number">8</span>        <span class="token number">8</span>        <span class="token number">2</span>      active <span class="token function">sync</span>   /dev/sda8
       <span class="token number">5</span>       <span class="token number">8</span>        <span class="token number">7</span>        <span class="token number">3</span>      active <span class="token function">sync</span>   /dev/sda7

       <span class="token number">2</span>       <span class="token number">8</span>        <span class="token number">6</span>        -      faulty   /dev/sda6
<span class="token comment"># 这里 sda6 死掉了，我这里查看信息慢了点，没有看到 state 为 spare rebuilding 状态的信息</span>
<span class="token comment"># 前面通过  cat /proc/mdstat  看到的是 sda8 是 spare 磁盘，这里已经变成 磁盘整理里面的磁盘了</span>

Personalities <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>raid6<span class="token punctuation">]</span> <span class="token punctuation">[</span>raid5<span class="token punctuation">]</span> <span class="token punctuation">[</span>raid4<span class="token punctuation">]</span> 
md0 <span class="token builtin class-name">:</span> active raid5 sda7<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> sda8<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> sda6<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">(</span>F<span class="token punctuation">)</span> sda5<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> sda4<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
      <span class="token number">3139584</span> blocks super <span class="token number">1.2</span> level <span class="token number">5</span>, 256k chunk, algorithm <span class="token number">2</span> <span class="token punctuation">[</span><span class="token number">4</span>/4<span class="token punctuation">]</span> <span class="token punctuation">[</span>UUUU<span class="token punctuation">]</span>
      
unused devices: <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
<span class="token comment"># 可以看到 sda6 死掉了。变成了 F</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br></div></div><h3 id="将出错的磁盘移除并加入新磁盘"><a href="#将出错的磁盘移除并加入新磁盘" class="header-anchor">#</a> 将出错的磁盘移除并加入新磁盘</h3> <p>这里由于是让 sda6 模拟出错，如果是真实的盘要替换，也是如下的流程：</p> <ol><li><p>从 <code>/dev/md0</code> 数组中移除  <code>/dev/sda6</code> 磁盘</p></li> <li><p>整个 Linux 系统关机，拔出 sda6 这块磁盘，并安装上新的 <code>/dev/sda6</code> 磁盘，之后开机</p></li> <li><p>将新的 <code>/dev/sda6</code> 放入 <code>/dev/md0</code> 数组中</p></li> <li><p>拔出旧的  sda6 磁盘</p></li></ol> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 这里我手误写成了 sda7 ,会提示在使用中的不能移除</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># mdadm --manage /dev/md0 --remove /dev/sda7</span>
mdadm: hot remove failed <span class="token keyword">for</span> /dev/sda7: Device or resource busy
<span class="token comment"># 这里就正常了</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># mdadm --manage /dev/md0 --remove /dev/sda6</span>
mdadm: hot removed /dev/sda6 from /dev/md0

<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># mdadm --detail /dev/md0</span>
    Number   Major   Minor   RaidDevice State
       <span class="token number">0</span>       <span class="token number">8</span>        <span class="token number">4</span>        <span class="token number">0</span>      active <span class="token function">sync</span>   /dev/sda4
       <span class="token number">1</span>       <span class="token number">8</span>        <span class="token number">5</span>        <span class="token number">1</span>      active <span class="token function">sync</span>   /dev/sda5
       <span class="token number">4</span>       <span class="token number">8</span>        <span class="token number">8</span>        <span class="token number">2</span>      active <span class="token function">sync</span>   /dev/sda8
       <span class="token number">5</span>       <span class="token number">8</span>        <span class="token number">7</span>        <span class="token number">3</span>      active <span class="token function">sync</span>   /dev/sda7
<span class="token comment"># sda6 被移除了</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ol start="5"><li>安装新的 <code>/dev/sda6</code> 磁盘</li></ol> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># mdadm --manage /dev/md0 --add /dev/sda6</span>
mdadm: added /dev/sda6
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># mdadm --detail /dev/md0</span>

   Number   Major   Minor   RaidDevice State
       <span class="token number">0</span>       <span class="token number">8</span>        <span class="token number">4</span>        <span class="token number">0</span>      active <span class="token function">sync</span>   /dev/sda4
       <span class="token number">1</span>       <span class="token number">8</span>        <span class="token number">5</span>        <span class="token number">1</span>      active <span class="token function">sync</span>   /dev/sda5
       <span class="token number">4</span>       <span class="token number">8</span>        <span class="token number">8</span>        <span class="token number">2</span>      active <span class="token function">sync</span>   /dev/sda8
       <span class="token number">5</span>       <span class="token number">8</span>        <span class="token number">7</span>        <span class="token number">3</span>      active <span class="token function">sync</span>   /dev/sda7

       <span class="token number">6</span>       <span class="token number">8</span>        <span class="token number">6</span>        -      spare   /dev/sda6

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>如果你的系统支持磁盘热插拨，还不需要关机，就能完成这里的操作，可以说是不停机完成维护，很强</p> <h2 id="开机自动启动-raid-并自动挂载"><a href="#开机自动启动-raid-并自动挂载" class="header-anchor">#</a> 开机自动启动 RAID 并自动挂载</h2> <p>新版 distribution 可能会自动搜索 <code>/dev/md[0-9]</code> 开机时设置好所需要的功能建议还是通过配置文件配置。</p> <p><code>/etc/mdadm.conf</code> 是 RAID 的配置文件。只要知道 <code>/dev/md0</code> 的 UUID 就可以完成配置</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># mdadm --detail /dev/md0 | grep -i uuid</span>
              UUID <span class="token builtin class-name">:</span> ba4883f9:75e8224b:6961ac93:d16adbf7
<span class="token comment"># UUID 是想系统注册的 UUID 标识</span>

<span class="token comment"># 配置 mdadm.conf</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/mdadm.conf</span>
ARRAY /dev/md0 <span class="token assign-left variable">UUID</span><span class="token operator">=</span>ba4883f9:75e8224b:6961ac93:d16adbf7
<span class="token comment"># 		RAID 装置	UUID</span>

<span class="token comment"># 设置开机自动挂载并测试</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># blkid /dev/md0</span>
/dev/md0: <span class="token assign-left variable">UUID</span><span class="token operator">=</span><span class="token string">&quot;319f3d68-a144-4d9a-9a83-c83b4a26b98f&quot;</span> <span class="token assign-left variable">TYPE</span><span class="token operator">=</span><span class="token string">&quot;xfs&quot;</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/fstab</span>
<span class="token comment"># UUID=319f3d68-a144-4d9a-9a83-c83b4a26b98f       /srv/raid       xfs     0 0 </span>
<span class="token assign-left variable">UUID</span><span class="token operator">=</span>319f3d68-a144-4d9a-9a83-c83b4a26b98f /srv/raid     xfs     defaults        <span class="token number">0</span> <span class="token number">0</span>
<span class="token comment"># 记得上述一定要仔细，这里卸载后，再挂载就提示有问题，检查后发现，少了一个 defaults 项</span>
<span class="token comment"># 否则直接重启的话，有可能就启动不了了</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># umount /dev/md0; mount -a</span>
mount: wrong fs type, bad option, bad superblock on /dev/md0,
       missing codepage or helper program, or other error

       In some cases useful info is found <span class="token keyword">in</span> syslog - try
       <span class="token function">dmesg</span> <span class="token operator">|</span> <span class="token function">tail</span> or so.

<span class="token comment"># 修改后就正常了</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># umount /dev/md0</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># mount -a</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># df -Th /srv/raid/</span>
Filesystem     Type  Size  Used Avail Use% Mounted on
/dev/md0       xfs   <span class="token number">3</span>.0G  121M  <span class="token number">2</span>.9G   <span class="token number">4</span>% /srv/raid
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># reboot 	# 重启后，再查看是否自动挂载了</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h2 id="关闭软件-raid（重要）"><a href="#关闭软件-raid（重要）" class="header-anchor">#</a> 关闭软件 RAID（重要）</h2> <p>除非你未来要使用这块  software RAID 的 /dev/md0；否则请关闭它</p> <p>因为：因为这是练习机，后续不会用，另外，它使用了 <code>/dev/sda{4,5,6,7,8}</code> 分区，如果只是将 <code>/dev/md0</code> 卸载，然后忘记关闭 RAID，结果就是在重新分区 <code>/dev/sdaX</code> 时可能会出现一些莫名其妙的错误</p> <p>关闭步骤如下</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 1. 卸载且删除配置文件与这个 /dev/md0 有关的设置</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># umount /srv/raid/</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/fstab </span>

<span class="token comment"># 2. 覆盖掉 RAID 的 metadata 以及 XFS 的 superblock，再关闭 /dev/md0</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># dd if=/dev/zero of=/dev/md0 bs=1M count=50</span>
<span class="token comment"># 这一步很危险；笔者刚刚发现执行 stop,提示找不到 /dev/md0</span>
<span class="token comment"># 找到问题是在 vim /etc/mdadm.conf 中 ARRAY 写错了，导致开机没有加载</span>
<span class="token comment"># 然后修改之后，把 fstab 中增加上，再重启，就开不了机了，本想是重试这里的正常卸载</span>
<span class="token comment"># 谁知道，上面吧  /dev/md0 数据擦除了，导致启动不了系统</span>
<span class="token comment"># 后来想到前面讲解过怎么进入救援模式，再编辑 fstab 文件，去掉对 /dev/md0 的挂载配置，就好了</span>

<span class="token comment"># 重启后，在执行下面的指令就正常了</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># mdadm --stop /dev/md0</span>
mdadm:stopped /dev/md0
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># cat /proc/mdstat </span>
Personalities <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>raid6<span class="token punctuation">]</span> <span class="token punctuation">[</span>raid5<span class="token punctuation">]</span> <span class="token punctuation">[</span>raid4<span class="token punctuation">]</span> 
unused devices: <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>	<span class="token comment"># 不存在任何数组装置</span>

<span class="token comment"># 在去掉这里的配置就可以了</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/mdadm.conf </span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>上面使用 dd 是因为 RAID 的相关数据会存一份在磁盘中，如果只是把配置文件去掉了，但是分区槽没有重新规划过，那么重启后，系统还是会将这块磁盘阵列建立起来，只是名称可能会改变成 <code>/dev/md127</code></p> <p>所以，记得上述的步骤，但是不要错误的 dd 到了其他磁盘，这个很严重的</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/zq99299/linux-tutorial/edit/master/docs/tutorial-basis/14/02.md" target="_blank" rel="noopener noreferrer">帮助我们改善此页面！</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">上次更新: :</span> <span class="time">a minute ago</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/linux-tutorial/tutorial-basis/14/01.html" class="prev">
        磁盘配额（Quota）的应用于实践
      </a></span> <span class="next"><a href="/linux-tutorial/tutorial-basis/14/03.html">
        逻辑滚动条管理员（Logical Volume Manager）
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/linux-tutorial/assets/js/app.3ea62065.js" defer></script><script src="/linux-tutorial/assets/js/2.b00e63ff.js" defer></script><script src="/linux-tutorial/assets/js/9.fe184c91.js" defer></script><script src="/linux-tutorial/assets/js/16.b0a90d5f.js" defer></script>
  </body>
</html>
