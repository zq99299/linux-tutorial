<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Tarball 的管理与建议 | Linux 系统教程（笔记）</title>
    <meta name="generator" content="VuePress 1.4.1">
    <link rel="icon" href="/linux-tutorial/favicon.ico">
    <link rel="manifest" href="/linux-tutorial/manifest.json">
    <meta name="description" content="linux 系统教程学习笔记">
    <link rel="preload" href="/linux-tutorial/assets/css/0.styles.7e75da3d.css" as="style"><link rel="preload" href="/linux-tutorial/assets/js/app.3ea62065.js" as="script"><link rel="preload" href="/linux-tutorial/assets/js/2.b00e63ff.js" as="script"><link rel="preload" href="/linux-tutorial/assets/js/164.9ee339c2.js" as="script"><link rel="preload" href="/linux-tutorial/assets/js/16.b0a90d5f.js" as="script"><link rel="prefetch" href="/linux-tutorial/assets/js/10.2f6e83c2.js"><link rel="prefetch" href="/linux-tutorial/assets/js/100.b3722352.js"><link rel="prefetch" href="/linux-tutorial/assets/js/101.8c1ef482.js"><link rel="prefetch" href="/linux-tutorial/assets/js/102.2586eda7.js"><link rel="prefetch" href="/linux-tutorial/assets/js/103.e4ead933.js"><link rel="prefetch" href="/linux-tutorial/assets/js/104.85e3fd0d.js"><link rel="prefetch" href="/linux-tutorial/assets/js/105.cc2c5c94.js"><link rel="prefetch" href="/linux-tutorial/assets/js/106.927267ce.js"><link rel="prefetch" href="/linux-tutorial/assets/js/107.1dd2a942.js"><link rel="prefetch" href="/linux-tutorial/assets/js/108.6090320a.js"><link rel="prefetch" href="/linux-tutorial/assets/js/109.57884f50.js"><link rel="prefetch" href="/linux-tutorial/assets/js/11.48476434.js"><link rel="prefetch" href="/linux-tutorial/assets/js/110.33c6958e.js"><link rel="prefetch" href="/linux-tutorial/assets/js/111.fd8a0020.js"><link rel="prefetch" href="/linux-tutorial/assets/js/112.788498e1.js"><link rel="prefetch" href="/linux-tutorial/assets/js/113.8de94cf4.js"><link rel="prefetch" href="/linux-tutorial/assets/js/114.2f9a6bc8.js"><link rel="prefetch" href="/linux-tutorial/assets/js/115.26cb32f2.js"><link rel="prefetch" href="/linux-tutorial/assets/js/116.c7a39b2c.js"><link rel="prefetch" href="/linux-tutorial/assets/js/117.3a5a37f1.js"><link rel="prefetch" href="/linux-tutorial/assets/js/118.16961e8a.js"><link rel="prefetch" href="/linux-tutorial/assets/js/119.9512ae4e.js"><link rel="prefetch" href="/linux-tutorial/assets/js/12.d5e57772.js"><link rel="prefetch" href="/linux-tutorial/assets/js/120.23d99fc1.js"><link rel="prefetch" href="/linux-tutorial/assets/js/121.e3a9422b.js"><link rel="prefetch" href="/linux-tutorial/assets/js/122.fdbe08a8.js"><link rel="prefetch" href="/linux-tutorial/assets/js/123.5b64c6d2.js"><link rel="prefetch" href="/linux-tutorial/assets/js/124.35e2afbb.js"><link rel="prefetch" href="/linux-tutorial/assets/js/125.5c0c3620.js"><link rel="prefetch" href="/linux-tutorial/assets/js/126.c9ad2adc.js"><link rel="prefetch" href="/linux-tutorial/assets/js/127.2a7e4d5a.js"><link rel="prefetch" href="/linux-tutorial/assets/js/128.b260f3a3.js"><link rel="prefetch" href="/linux-tutorial/assets/js/129.17deb712.js"><link rel="prefetch" href="/linux-tutorial/assets/js/13.baaaf940.js"><link rel="prefetch" href="/linux-tutorial/assets/js/130.2c20de59.js"><link rel="prefetch" href="/linux-tutorial/assets/js/131.60b7d099.js"><link rel="prefetch" href="/linux-tutorial/assets/js/132.d9ef53df.js"><link rel="prefetch" href="/linux-tutorial/assets/js/133.edffc570.js"><link rel="prefetch" href="/linux-tutorial/assets/js/134.f15edd55.js"><link rel="prefetch" href="/linux-tutorial/assets/js/135.f64a41b5.js"><link rel="prefetch" href="/linux-tutorial/assets/js/136.29678524.js"><link rel="prefetch" href="/linux-tutorial/assets/js/137.9c43f91c.js"><link rel="prefetch" href="/linux-tutorial/assets/js/138.ffadb27b.js"><link rel="prefetch" href="/linux-tutorial/assets/js/139.2b708550.js"><link rel="prefetch" href="/linux-tutorial/assets/js/14.4342bdf7.js"><link rel="prefetch" href="/linux-tutorial/assets/js/140.862a81a9.js"><link rel="prefetch" href="/linux-tutorial/assets/js/141.b7c0871f.js"><link rel="prefetch" href="/linux-tutorial/assets/js/142.de57a7d2.js"><link rel="prefetch" href="/linux-tutorial/assets/js/143.d1286be6.js"><link rel="prefetch" href="/linux-tutorial/assets/js/144.78dea036.js"><link rel="prefetch" href="/linux-tutorial/assets/js/145.cd89bb50.js"><link rel="prefetch" href="/linux-tutorial/assets/js/146.c00ea063.js"><link rel="prefetch" href="/linux-tutorial/assets/js/147.6cf25c98.js"><link rel="prefetch" href="/linux-tutorial/assets/js/148.1041f769.js"><link rel="prefetch" href="/linux-tutorial/assets/js/149.b5566432.js"><link rel="prefetch" href="/linux-tutorial/assets/js/15.8796218f.js"><link rel="prefetch" href="/linux-tutorial/assets/js/150.e5c75119.js"><link rel="prefetch" href="/linux-tutorial/assets/js/151.5c388a5f.js"><link rel="prefetch" href="/linux-tutorial/assets/js/152.ee6213e5.js"><link rel="prefetch" href="/linux-tutorial/assets/js/153.1b602d8e.js"><link rel="prefetch" href="/linux-tutorial/assets/js/154.4ea59cb4.js"><link rel="prefetch" href="/linux-tutorial/assets/js/155.24b59ac3.js"><link rel="prefetch" href="/linux-tutorial/assets/js/156.9b15d371.js"><link rel="prefetch" href="/linux-tutorial/assets/js/157.8d1f9503.js"><link rel="prefetch" href="/linux-tutorial/assets/js/158.ccaead85.js"><link rel="prefetch" href="/linux-tutorial/assets/js/159.5b49ce1b.js"><link rel="prefetch" href="/linux-tutorial/assets/js/160.95a4fb36.js"><link rel="prefetch" href="/linux-tutorial/assets/js/161.cde930c9.js"><link rel="prefetch" href="/linux-tutorial/assets/js/162.7a754448.js"><link rel="prefetch" href="/linux-tutorial/assets/js/163.d55c6349.js"><link rel="prefetch" href="/linux-tutorial/assets/js/165.30141050.js"><link rel="prefetch" href="/linux-tutorial/assets/js/166.464d423d.js"><link rel="prefetch" href="/linux-tutorial/assets/js/167.660c924d.js"><link rel="prefetch" href="/linux-tutorial/assets/js/168.2cae5c9c.js"><link rel="prefetch" href="/linux-tutorial/assets/js/169.1e24d7be.js"><link rel="prefetch" href="/linux-tutorial/assets/js/17.04ccb392.js"><link rel="prefetch" href="/linux-tutorial/assets/js/170.8572828e.js"><link rel="prefetch" href="/linux-tutorial/assets/js/171.cf33f986.js"><link rel="prefetch" href="/linux-tutorial/assets/js/172.36741bc1.js"><link rel="prefetch" href="/linux-tutorial/assets/js/173.65edcd81.js"><link rel="prefetch" href="/linux-tutorial/assets/js/174.08dd2802.js"><link rel="prefetch" href="/linux-tutorial/assets/js/175.0173e57f.js"><link rel="prefetch" href="/linux-tutorial/assets/js/176.b64d6d09.js"><link rel="prefetch" href="/linux-tutorial/assets/js/177.dcf9ae18.js"><link rel="prefetch" href="/linux-tutorial/assets/js/178.ae42ddc1.js"><link rel="prefetch" href="/linux-tutorial/assets/js/18.4e56fcb3.js"><link rel="prefetch" href="/linux-tutorial/assets/js/19.f21c7977.js"><link rel="prefetch" href="/linux-tutorial/assets/js/20.4c69b8ff.js"><link rel="prefetch" href="/linux-tutorial/assets/js/21.3aec2873.js"><link rel="prefetch" href="/linux-tutorial/assets/js/22.861e719b.js"><link rel="prefetch" href="/linux-tutorial/assets/js/23.578aedc7.js"><link rel="prefetch" href="/linux-tutorial/assets/js/24.57eb980d.js"><link rel="prefetch" href="/linux-tutorial/assets/js/25.cade1e03.js"><link rel="prefetch" href="/linux-tutorial/assets/js/26.d4c42c11.js"><link rel="prefetch" href="/linux-tutorial/assets/js/27.e67320de.js"><link rel="prefetch" href="/linux-tutorial/assets/js/28.5d42931b.js"><link rel="prefetch" href="/linux-tutorial/assets/js/29.78c32762.js"><link rel="prefetch" href="/linux-tutorial/assets/js/3.1986f040.js"><link rel="prefetch" href="/linux-tutorial/assets/js/30.4495d9ce.js"><link rel="prefetch" href="/linux-tutorial/assets/js/31.95d35ed3.js"><link rel="prefetch" href="/linux-tutorial/assets/js/32.dc04efd9.js"><link rel="prefetch" href="/linux-tutorial/assets/js/33.5f1f572a.js"><link rel="prefetch" href="/linux-tutorial/assets/js/34.93972f88.js"><link rel="prefetch" href="/linux-tutorial/assets/js/35.bc6d3388.js"><link rel="prefetch" href="/linux-tutorial/assets/js/36.209d75c8.js"><link rel="prefetch" href="/linux-tutorial/assets/js/37.d30c94d3.js"><link rel="prefetch" href="/linux-tutorial/assets/js/38.02682c6d.js"><link rel="prefetch" href="/linux-tutorial/assets/js/39.7d6ee8db.js"><link rel="prefetch" href="/linux-tutorial/assets/js/4.896de413.js"><link rel="prefetch" href="/linux-tutorial/assets/js/40.7925dcab.js"><link rel="prefetch" href="/linux-tutorial/assets/js/41.58fb9c6a.js"><link rel="prefetch" href="/linux-tutorial/assets/js/42.2a87c226.js"><link rel="prefetch" href="/linux-tutorial/assets/js/43.d181a9c7.js"><link rel="prefetch" href="/linux-tutorial/assets/js/44.0476bb9a.js"><link rel="prefetch" href="/linux-tutorial/assets/js/45.52a56f6c.js"><link rel="prefetch" href="/linux-tutorial/assets/js/46.8bbaa61c.js"><link rel="prefetch" href="/linux-tutorial/assets/js/47.a8d3f059.js"><link rel="prefetch" href="/linux-tutorial/assets/js/48.a36fbedb.js"><link rel="prefetch" href="/linux-tutorial/assets/js/49.1799d727.js"><link rel="prefetch" href="/linux-tutorial/assets/js/5.1e8af3f8.js"><link rel="prefetch" href="/linux-tutorial/assets/js/50.f12984d3.js"><link rel="prefetch" href="/linux-tutorial/assets/js/51.d4ddd236.js"><link rel="prefetch" href="/linux-tutorial/assets/js/52.87a15496.js"><link rel="prefetch" href="/linux-tutorial/assets/js/53.701965d2.js"><link rel="prefetch" href="/linux-tutorial/assets/js/54.cc68ce47.js"><link rel="prefetch" href="/linux-tutorial/assets/js/55.653237e5.js"><link rel="prefetch" href="/linux-tutorial/assets/js/56.1baa6aea.js"><link rel="prefetch" href="/linux-tutorial/assets/js/57.09785e4b.js"><link rel="prefetch" href="/linux-tutorial/assets/js/58.64f3994d.js"><link rel="prefetch" href="/linux-tutorial/assets/js/59.9df45c80.js"><link rel="prefetch" href="/linux-tutorial/assets/js/6.7e1ac443.js"><link rel="prefetch" href="/linux-tutorial/assets/js/60.f2ffc564.js"><link rel="prefetch" href="/linux-tutorial/assets/js/61.b4b7dde2.js"><link rel="prefetch" href="/linux-tutorial/assets/js/62.74ecad97.js"><link rel="prefetch" href="/linux-tutorial/assets/js/63.86c2c4b7.js"><link rel="prefetch" href="/linux-tutorial/assets/js/64.a8104d1e.js"><link rel="prefetch" href="/linux-tutorial/assets/js/65.f0e9a242.js"><link rel="prefetch" href="/linux-tutorial/assets/js/66.3e058e54.js"><link rel="prefetch" href="/linux-tutorial/assets/js/67.f35fdc92.js"><link rel="prefetch" href="/linux-tutorial/assets/js/68.49d0163a.js"><link rel="prefetch" href="/linux-tutorial/assets/js/69.9d26e579.js"><link rel="prefetch" href="/linux-tutorial/assets/js/7.44a8110c.js"><link rel="prefetch" href="/linux-tutorial/assets/js/70.595c942e.js"><link rel="prefetch" href="/linux-tutorial/assets/js/71.c08f3394.js"><link rel="prefetch" href="/linux-tutorial/assets/js/72.c0e7fd28.js"><link rel="prefetch" href="/linux-tutorial/assets/js/73.059936b7.js"><link rel="prefetch" href="/linux-tutorial/assets/js/74.c5bd8446.js"><link rel="prefetch" href="/linux-tutorial/assets/js/75.43cb35df.js"><link rel="prefetch" href="/linux-tutorial/assets/js/76.81eff8a5.js"><link rel="prefetch" href="/linux-tutorial/assets/js/77.13799166.js"><link rel="prefetch" href="/linux-tutorial/assets/js/78.bfd8b227.js"><link rel="prefetch" href="/linux-tutorial/assets/js/79.c643ae63.js"><link rel="prefetch" href="/linux-tutorial/assets/js/8.d908ccdf.js"><link rel="prefetch" href="/linux-tutorial/assets/js/80.6774c39d.js"><link rel="prefetch" href="/linux-tutorial/assets/js/81.1e0cf9b0.js"><link rel="prefetch" href="/linux-tutorial/assets/js/82.07ec7389.js"><link rel="prefetch" href="/linux-tutorial/assets/js/83.c5bf5183.js"><link rel="prefetch" href="/linux-tutorial/assets/js/84.41a9c9da.js"><link rel="prefetch" href="/linux-tutorial/assets/js/85.417359ad.js"><link rel="prefetch" href="/linux-tutorial/assets/js/86.4fab0b07.js"><link rel="prefetch" href="/linux-tutorial/assets/js/87.e89d0800.js"><link rel="prefetch" href="/linux-tutorial/assets/js/88.da8e748b.js"><link rel="prefetch" href="/linux-tutorial/assets/js/89.dc1f03ca.js"><link rel="prefetch" href="/linux-tutorial/assets/js/9.fe184c91.js"><link rel="prefetch" href="/linux-tutorial/assets/js/90.d9814c8e.js"><link rel="prefetch" href="/linux-tutorial/assets/js/91.d2b0823a.js"><link rel="prefetch" href="/linux-tutorial/assets/js/92.407929d3.js"><link rel="prefetch" href="/linux-tutorial/assets/js/93.7b975c37.js"><link rel="prefetch" href="/linux-tutorial/assets/js/94.e6aa7f65.js"><link rel="prefetch" href="/linux-tutorial/assets/js/95.0d268a19.js"><link rel="prefetch" href="/linux-tutorial/assets/js/96.d3ebc4e5.js"><link rel="prefetch" href="/linux-tutorial/assets/js/97.4cc827d1.js"><link rel="prefetch" href="/linux-tutorial/assets/js/98.87d8de27.js"><link rel="prefetch" href="/linux-tutorial/assets/js/99.a360003c.js">
    <link rel="stylesheet" href="/linux-tutorial/assets/css/0.styles.7e75da3d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/linux-tutorial/" class="home-link router-link-active"><img src="/linux-tutorial/mlogo.svg" alt="Linux 系统教程（笔记）" class="logo"> <span class="site-name can-hide">Linux 系统教程（笔记）</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/linux-tutorial/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/linux-tutorial/tutorial-basis/" class="nav-link router-link-active">
  鸟哥私房菜-基础篇
</a></div><div class="nav-item"><a href="/linux-tutorial/discuss.html" class="nav-link">
  参与讨论
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="笔记精选汇总" class="dropdown-title"><span class="title">笔记精选汇总</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/zq99299/repository-summary" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub 站
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://book.mrcode.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  国内镜像站
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <a href="https://github.com/zq99299/linux-tutorial" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/linux-tutorial/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/linux-tutorial/tutorial-basis/" class="nav-link router-link-active">
  鸟哥私房菜-基础篇
</a></div><div class="nav-item"><a href="/linux-tutorial/discuss.html" class="nav-link">
  参与讨论
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="笔记精选汇总" class="dropdown-title"><span class="title">笔记精选汇总</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/zq99299/repository-summary" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub 站
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://book.mrcode.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  国内镜像站
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <a href="https://github.com/zq99299/linux-tutorial" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/linux-tutorial/tutorial-basis/" class="sidebar-link">Linux 基础篇（鸟哥私房菜）- 第四版</a></li><li><a href="/linux-tutorial/tutorial-basis/00/" class="sidebar-link">00. 计算机概论</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>01. Linux 是什么/如何学习</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>02. 主机规划与磁盘分区</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>03. 安装 CentOS 7.x</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>04. 首次登陆与线上求助</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>05. Linux 的文件权限与目录配置</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>06. Linux 文件与目录管理</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>07. Linux 磁盘与文件系统管理</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>08. 文件与文件系统的压缩、打包与备份</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>09. vim 程序编辑器</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>10. 认识与学习 BASH</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>11. 正则表达式与文件格式化处理</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>12. 学习 Shell Scripts</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>13. Linux 账号管理与 ACL 权限设置</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>14. 磁盘配额（Quota）与进阶文件系统管理</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>15. 例行性工作排程（crontab）</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>16. 进程管理与 SELinux 初探</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>17. 认识系统服务（daemons）</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>18. 认识与分析登录文件</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>19. 开机流程、模块管理与 Loader</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>20. 基础系统设置与备份策略</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>21. 软件安装：原始码与 Tarball</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/linux-tutorial/tutorial-basis/21/" class="sidebar-link">软件安装：原始码与 Tarball</a></li><li><a href="/linux-tutorial/tutorial-basis/21/01.html" class="sidebar-link">开放源码的软件安装与升级简介</a></li><li><a href="/linux-tutorial/tutorial-basis/21/02.html" class="sidebar-link">使用传统程序语言进行编译的简单范例</a></li><li><a href="/linux-tutorial/tutorial-basis/21/03.html" class="sidebar-link">用 make 进行宏编译</a></li><li><a href="/linux-tutorial/tutorial-basis/21/04.html" class="active sidebar-link">Tarball 的管理与建议</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/linux-tutorial/tutorial-basis/21/04.html#使用源码管理软件所需要的基础软件" class="sidebar-link">使用源码管理软件所需要的基础软件</a></li><li class="sidebar-sub-header"><a href="/linux-tutorial/tutorial-basis/21/04.html#tarball-安装的基本步骤" class="sidebar-link">Tarball 安装的基本步骤</a></li><li class="sidebar-sub-header"><a href="/linux-tutorial/tutorial-basis/21/04.html#一般-tarball-软件安装的建议事项（如何移除？升级？）" class="sidebar-link">一般 Tarball 软件安装的建议事项（如何移除？升级？）</a></li><li class="sidebar-sub-header"><a href="/linux-tutorial/tutorial-basis/21/04.html#一个简单的范例，利用-ntp-来示范" class="sidebar-link">一个简单的范例，利用 ntp 来示范</a></li><li class="sidebar-sub-header"><a href="/linux-tutorial/tutorial-basis/21/04.html#利用-patch-更新源码" class="sidebar-link">利用 patch 更新源码</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/linux-tutorial/tutorial-basis/21/04.html#main-0-1-版本" class="sidebar-link">main-0.1 版本</a></li><li class="sidebar-sub-header"><a href="/linux-tutorial/tutorial-basis/21/04.html#由-0-1-升级到-0-2-的-patch-file" class="sidebar-link">由 0.1 升级到 0.2 的 patch file</a></li><li class="sidebar-sub-header"><a href="/linux-tutorial/tutorial-basis/21/04.html#测试旧版程序的功能" class="sidebar-link">测试旧版程序的功能</a></li><li class="sidebar-sub-header"><a href="/linux-tutorial/tutorial-basis/21/04.html#查阅-patch-file-内容" class="sidebar-link">查阅 patch file 内容</a></li><li class="sidebar-sub-header"><a href="/linux-tutorial/tutorial-basis/21/04.html#更新源码，并重新编译程序" class="sidebar-link">更新源码，并重新编译程序</a></li></ul></li></ul></li><li><a href="/linux-tutorial/tutorial-basis/21/05.html" class="sidebar-link">函数库的管理</a></li><li><a href="/linux-tutorial/tutorial-basis/21/06.html" class="sidebar-link">检验软件的正确性</a></li><li><a href="/linux-tutorial/tutorial-basis/21/07.html" class="sidebar-link">重点回顾</a></li><li><a href="/linux-tutorial/tutorial-basis/21/08.html" class="sidebar-link">本章习题</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>22. 软件安装 RPM、SRPM、YUM</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="tarball-的管理与建议"><a href="#tarball-的管理与建议" class="header-anchor">#</a> Tarball 的管理与建议</h1> <p>那么接下来我们要知道如何使用具有源码的 Tarball 来建立一个属于自己的软件</p> <p>Tarball 的安装是可以跨平台的，只是需要的编译程序可能并不相同，例如 Linux 上用 gcc，而 windows 上也有相关的 c 编译程序。</p> <p>如果万一没有编译成功，可以通过修改小部分的程序代码（通常是因为很小部分的不同）就可以跨平台的移植了</p> <h2 id="使用源码管理软件所需要的基础软件"><a href="#使用源码管理软件所需要的基础软件" class="header-anchor">#</a> 使用源码管理软件所需要的基础软件</h2> <p>从源码制作一个 binary program 需要很多软件的支持，包括以下基础的软件：</p> <ul><li><p>gcc 或 cc 等 c 语言编译程序（compiler）</p> <p>编译程序也有很多，其中以 GNU 的 gcc 是首选的自由软件编译程序，在 Linux 平台上面发展的软件的源码，原本就是以 gcc 为底来设计的</p></li> <li><p>需要 Kernel 提供的 Library 以及相关的 Include 文件</p> <p>从前面的源码编译过程，我们知道函数库 library 的重要性，和 include 文件的存在。</p> <p>很多软件在发展的时候都是直接取用系统核心提供的函数库与 include 文件，尤其是在驱动程序方面的模块，例如网卡、声卡、USB 等驱动程序在安装的时候，常常需要核心提供相关的信息。</p> <p>在 Red Hat 系统中（包含 Fedora、CentOS 等系列），这个核心相关的功能通常都是被包含在 kernel-source 或 kernel-header 这些软件名称中，所以记得安装这些软件</p></li></ul> <p>一般来说 Tarball 的安装比较简单，只要顺着开发商提供的 README 与 INSTALL 文件的说明步骤来安装，基本上是很容易的，但是在论坛上还会发现很多人问提示 「没有 gcc 程序」、「无法使用 make」等问题，这些基本上都是以上基础软件没有安装的原因</p> <p>目前的 Linux distribution 大多已经偏向与桌面计算机的使用（非服务器），所以默认不会安装这些偏向开发的软件，如果你希望未来可以安装一些以 Tarball 方式的软件时，请自行挑选想要安装的软件名称。例如在 CentOS 或死 Red Hat 中，需要选中 Development Tools 以及 Kernel Source Development 等相关字眼的软件群</p> <p>如果你在安装 Linux 时，没有选择这些软件随机安装，也就是没有 make、gcc 等这些东西，那么可以使用 RPM （下章节讲解）的方式来安装软件，所以只要拿出当初安装 Linux 时的原本光盘，然后以 RPM 来一个一个安装到你的 Linux 主机里面，尤其是现在有 yum ，在线安装更方便了</p> <p>在 CentOS 中，如果你已经联网的话，那么可以使用下一章会介绍到的 yum，通过 yum 的软件群组安装工功能，可以如下做：</p> <ul><li>安装 gcc 等软件开放工具：<code>yum groupinstall &quot;Development Tools&quot;</code></li> <li>若待安装的软件需要图形接口支持，一般还需要：<code>yum groupinstall &quot;X Software Development&quot;</code></li> <li>若安装的软件较旧，可能需要：<code>yum groupinstall &quot;Legacy Software Development&quot;</code></li></ul> <p>详细信息请参考后续章节</p> <h2 id="tarball-安装的基本步骤"><a href="#tarball-安装的基本步骤" class="header-anchor">#</a> Tarball 安装的基本步骤</h2> <p>步骤如下：</p> <ol><li>取得源码文件：将 tarball 文件在 <code>/usr/local/src</code> 目录下解压</li> <li>取得步骤流程：进入新建立的目录下，查阅 INSTALL 或 README 等相关文件内容（很重要）</li> <li>相依属性软件安装：根据 INSTALL/README 的内容查看并安装好一些相依的软件（非必要）</li> <li>建立 makefile：用自动检测程序（configure 或 config）检测作业环境，并建立 Makefile 文件</li> <li>编译：以 make 程序并使用该目录下的 Makefile 作为参考配置文件，进行 make 编译或其他的动作</li> <li>安装：以 make 程序，并以 Makefile 作为参数配置文件，根据 install 这个目标（target）的指定来安装到正确的路径</li></ol> <p>下面简约介绍下大部分的 tarball 软件安装的指令下达方式：</p> <ol><li><p><code>./configure</code></p> <p>程序开发者提供的一个 scripts 检查程序，并生成 Makefile 文件</p></li> <li><p>make clean</p> <p>会读取 Makefile 中关于 clean 的工作，该步骤不一定会有，但是希望之星下，因为他可以删除目标文件。至少能保证后续编译出来的 *.o 文件使我们自己机器编译出来的</p></li> <li><p>make</p> <p>会根据 Makefile 中预设的工作进行编译行为，主要工作是进行 gcc 来将源码编译为可以被执行的 object files。但是这些 object files 通常还需要一些函数库之类的 link 后，才能产生一个完整的执行文件。使用 make 就是将源码便以为可被执行的文件，该执行文件会放到目前所在的目录下，尚未被安装到预定安装的目录中</p></li> <li><p>make install</p> <p>通常这就是最后的安装步骤了，make 会根据 Makefile 文件里关于 install 的项目，将上一个步骤所编译完成的数据安装到预定的目录中，就安装完成了</p></li></ol> <p>以上步骤，只要前一个步骤没有成功，那么后续步骤就无法执行成功的。</p> <p>如果安装成功，并且是安装在独立的一个目录中，例如 <code>/usr/local/packages</code> 目录中，那么你必须手动的将整个软件的 man page 给它写入到 <code>/etc/man_db.conf</code></p> <h2 id="一般-tarball-软件安装的建议事项（如何移除？升级？）"><a href="#一般-tarball-软件安装的建议事项（如何移除？升级？）" class="header-anchor">#</a> 一般 Tarball 软件安装的建议事项（如何移除？升级？）</h2> <p>为什么前一个章节，Tarball 要在 <code>/usr/local/src</code> 下解压呢？基本上，在预设的情况下，原本的 Linux distribution 释出安装的软件大多是在 <code>/usr</code> 中，而用户自行安装的软件则建议放置 <code>/usr/local</code> 中。这是考虑到管理用户所安装软件的便利性</p> <p>几乎所有的软件都提供联机帮助服务，就是 info 与 man 功能。在默认情况下，man 会搜索 <code>/usr/local/man</code> 中的说明文件，因此如果将软件安装在 <code>/usr/local</code> 下，那么安装完成后，该软件的说明文件就可以被找到了（笔者疑问：可没有说说明文件说明时候被安装到指定目录的？）</p> <p>所以，通常建议将自己安装的软件放在 <code>/usr/local/</code> 下，至于源码（Tarball）则建议放到 <code>/usr/local/src</code> 下</p> <p>再来看看 Linux distribution 默认的安装软件的路径会用到哪些？这里以 apache 软件来说明：</p> <ul><li><code>/etc/httpd</code>：配置文件</li> <li><code>/usr/lib</code>：函数库</li> <li><code>/usr/bin</code>：执行文件</li> <li><code>/usr/share/man</code>：联机帮助文件</li></ul> <p>会发现软件的内容大致上是放在 etc、lib、bin、man 目录中的。那么通过 tarbal 来安装时，如果是放在预设的 <code>/usr/local</code> 中，由于 <code>/usr/local</code> 原本默认这几个目录，所以你的数据就会被放在：</p> <ul><li><code>/usr/local/etc</code></li> <li><code>/usr/local/bin</code></li> <li><code>/usr/local/lib</code></li> <li><code>/usr/local/man</code></li></ul> <p>如果你每个软件都选择在这个默认的路径下安装的话，那么所有的软件文件都将放在这 4 个目录中，那么未来再想要升级或移除的时候，就会比较难以追查文件的来源，而如果在安装的时候选择的是单独目录，例如我将 apache 安装在 <code>/usr/local/apache</code> 中，那么你的文件目录就会变成</p> <ul><li><code>/usr/local/apache/etc</code></li> <li><code>/usr/local/apache/bin</code></li> <li><code>/usr/local/apache/lib</code></li> <li><code>/usr/local/apache/man</code></li></ul> <p>这样一来，移除软件就简单多了，只要将该目录移除就可以了。</p> <p>当然，实际安装的时候，还需要看该软件的 Makefile 里 install 信息才能知道它的安装情况。因为例如 sendmail 的安装就很麻烦</p> <p>此种方式虽然有利于软件的移除，但是在执行指令的时候，该指令是否在 PATH 环境变量所记录的路径有关。以上面的 Apache 软件安装为例，<code>/usr/local/apache/bin</code> 肯定不在 PATH 里面的，所以执行 apache 的指令，要么使用绝对路径，要么加入到 PATH 中，另外还需要将 <code>/usr/local/apache/man</code> 也加入到 man page 搜索的路径中</p> <p>另外，Tarball 在升级的时候也挺困扰，以 apache 来说明，WWW 服务器为了考虑互动性，所以通常会将 <code>PHP+MySql+Apache</code> 一起安装，那么每个软件在安装的时候都有一定的顺序与程序，因为他们之间具有相关性，所以安装时必须要三者同时考虑到他们的函数库与相关的编译参数</p> <p>假设今天只要升级 PHP呢？有时候因为只涉及动态函数库的升级，那么只要升级 PHP 即可，其他的部分或许影响不大。但是今天如果 PHP 需要重新编译的模块比较多，那么可能会连带的，连 Apahce 这个程序也需要重新编译过才行。所以使用 tarball 确实有它的优点，但是在这方面也确实麻烦</p> <p>由于 Tarball 在升级与安装上面具有这些特色，即 Tarball 在反安装上面具有比较高的难度（如果你没有好好规划的话），所以为了方便 Tarball 的管理，通常作者会这样建议使用者：</p> <ol><li><p>最好将 tarball 的源码数据解压到 <code>/usr/local/src</code> 中</p></li> <li><p>安装时，最好安装到 <code>/usr/local</code> 这个默认路径下</p></li> <li><p>考虑未来的反安装步骤，最好可以将每个软件单独的安装在 <code>/usr/local</code> 下</p></li> <li><p>为安装到单独目录的软件的 man page 加入 man path 搜索</p> <p>如果你安装的软件在 <code>/usr/local/software/</code> 那么 man page 搜索设置中，可能需要在 <code>/etc/man_db.conf</code> 内的 40~50 行左右处，写入如下的一行</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>MANPATH_MAP /usr/local/software/bin /usr/local/software/man
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这样才可以使用 man 来查询该软件的在下文件</p></li></ol> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>时至今日，不太需要有 tarball 的安装了。 CentOS/Fedora 有个 RPM 补遗计划，就是俗称的 EPEL 计划，相关说明请参考 <a href="https://fedoraproject.org/wiki/EPEL" target="_blank" rel="noopener noreferrer">EPEL<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ，一般学界用到的软件都在里面，除非你要用的软件是专属收费软件，或则是比较冷门的软件，否则都有好心的网友帮我妈打包好了</p></div> <h2 id="一个简单的范例，利用-ntp-来示范"><a href="#一个简单的范例，利用-ntp-来示范" class="header-anchor">#</a> 一个简单的范例，利用 ntp 来示范</h2> <p>这里用时间服务器 ntp（network time protocol）软件来测试安装。下载网址请在此 <a href="http://www.ntp.org/downloads.html" target="_blank" rel="noopener noreferrer">网页中找到下载包链接<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ，本次使用 <code>http://www.eecis.udel.edu/~ntp/ntp_spool/ntp4/ntp-4.2/ntp-4.2.8p14.tar.gz</code> 这个版本。</p> <p>假设我对这个软件的要求如下：</p> <ul><li>假设 <code>ntp4.*.*.tar.gz</code> 文件放到 <code>/root</code> 目录下</li> <li>源码解压在 <code>/usr/local/src</code> 下</li> <li>安装到 <code>/usr/local/ntp</code> 目录中</li></ul> <p>​</p> <p>解压文件，并阅读 README/INSTALL 文件</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># cd /usr/local/</span>
<span class="token punctuation">[</span>root@study local<span class="token punctuation">]</span><span class="token comment"># tar -zxv -f /root/ntp-4.2.8p14.tar.gz</span>
<span class="token punctuation">[</span>root@study local<span class="token punctuation">]</span><span class="token comment"># cd ntp-4.2.8p14/</span>
<span class="token punctuation">[</span>root@study ntp-4.2.8p14<span class="token punctuation">]</span><span class="token comment"># vi INSTALL</span>
<span class="token comment"># 查看安装说明，使用 set nu 显示行号</span>
<span class="token comment"># 然后阅读 28 ~ 54 行的安装步骤，大约就是如下的内容</span>
   <span class="token number">28</span> The simplest way to compile this package is:
   <span class="token number">29</span> 
   <span class="token number">30</span>   <span class="token number">1</span>. <span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">cd</span><span class="token string">' to the directory containing the package'</span>s <span class="token builtin class-name">source</span> code and <span class="token builtin class-name">type</span>
   <span class="token number">31</span>      <span class="token variable">`</span></span>./configure<span class="token string">' to configure the package for your system.  If you'</span>re
   <span class="token number">32</span>      using <span class="token variable"><span class="token variable">`</span>csh' on an old version of System V, you might need to <span class="token builtin class-name">type</span>
   <span class="token number">33</span>      <span class="token variable">`</span></span><span class="token function">sh</span> ./configure<span class="token string">' instead to prevent <span class="token variable"><span class="token variable">`</span>csh' from trying to execute
   <span class="token number">34</span>      <span class="token variable">`</span></span>configure'</span> itself.
   <span class="token number">35</span> 
   <span class="token number">36</span>      Running <span class="token variable"><span class="token variable">`</span>configure' takes a while.  While running, it prints some
   <span class="token number">37</span>      messages telling <span class="token function">which</span> features it is checking for.
   <span class="token number">38</span> 
   <span class="token number">39</span>   <span class="token number">2</span>. Type <span class="token variable">`</span></span><span class="token function">make</span><span class="token string">' to compile the package.
   40 
   41   3. Optionally, type <span class="token variable"><span class="token variable">`</span><span class="token function">make</span> check' to run any self-tests that come with
   <span class="token number">42</span>      the package.
   <span class="token number">43</span> 
   <span class="token number">44</span>   <span class="token number">4</span>. Type <span class="token variable">`</span></span>make install'</span> to <span class="token function">install</span> the programs and any data files and
   <span class="token number">45</span>      documentation.
   <span class="token number">46</span> 
   <span class="token number">47</span>   <span class="token number">5</span>. You can remove the program binaries and object files from the
   <span class="token number">48</span>      <span class="token builtin class-name">source</span> code directory by typing <span class="token variable"><span class="token variable">`</span><span class="token function">make</span> clean'.  To also remove the
   <span class="token number">49</span>      files that <span class="token variable">`</span></span>configure<span class="token string">' created (so you can compile the package for
   50      a different kind of computer), type <span class="token variable"><span class="token variable">`</span><span class="token function">make</span> distclean'.  There is
   <span class="token number">51</span>      also a <span class="token variable">`</span></span>make maintainer-clean'</span> target, but that is intended mainly
   <span class="token number">52</span>      <span class="token keyword">for</span> the package's developers.  If you use it, you may have to get
   <span class="token number">53</span>      all sorts of other programs <span class="token keyword">in</span> order to regenerate files that came
   <span class="token number">54</span>      with the distribution.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p>检查 configure 支持的参数，并实际建立 makefile 规则文件</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@study ntp-4.2.8p14<span class="token punctuation">]</span><span class="token comment"># ./configure --help | more</span>
`configure' configures ntp <span class="token number">4.2</span>.8p14 to adapt to many kinds of systems.

Usage: ./configure <span class="token punctuation">[</span>OPTION<span class="token punctuation">]</span><span class="token punctuation">..</span>. <span class="token punctuation">[</span>VAR<span class="token operator">=</span>VALUE<span class="token punctuation">]</span><span class="token punctuation">..</span>.

To assign environment variables <span class="token punctuation">(</span>e.g., CC, CFLAGS<span class="token punctuation">..</span>.<span class="token punctuation">)</span>, specify them as
<span class="token assign-left variable">VAR</span><span class="token operator">=</span>VALUE.  See below <span class="token keyword">for</span> descriptions of some of the useful variables.
有很多参数，下面列出来比较重要的选项
--prefix<span class="token operator">=</span>PREFIX         <span class="token function">install</span> architecture-independent files <span class="token keyword">in</span> PREFIX
                          <span class="token punctuation">[</span>/usr/local<span class="token punctuation">]</span>
--enable-all-clocks     + include all suitable non-PARSE clocks:
--enable-parse-clocks   - include all suitable PARSE clocks:

<span class="token punctuation">[</span>root@study ntp-4.2.8p14<span class="token punctuation">]</span><span class="token comment"># ./configure --prefix=/usr/local/ntp --enable-all-clocks --enable-parse-clocks</span>
<span class="token punctuation">..</span>.
checking <span class="token keyword">for</span> gcc<span class="token punctuation">..</span>gcc				<span class="token comment"># 找到了 gcc 编译程序</span>
<span class="token punctuation">..</span>.
configure: creating ./config.status
config.status: creating libevent.pc
config.status: creating libevent_openssl.pc
config.status: creating libevent_pthreads.pc
config.status: creating Makefile		<span class="token comment"># 创建了一个 Makefile</span>
config.status: creating config.h
config.status: creating evconfig-private.h
config.status: evconfig-private.h is unchanged
config.status: executing depfiles commands
config.status: executing libtool commands
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>一般来说 configure 设置参数比较重要的就是 <code>--prefix=PREFIX</code>了，后面指定了该软件未来要安装到的目录</p> <p>最后开始编译与安装</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@study ntp-4.2.8p14<span class="token punctuation">]</span><span class="token comment"># make clean; make</span>
<span class="token punctuation">[</span>root@study ntp-4.2.8p14<span class="token punctuation">]</span><span class="token comment"># make check</span>
<span class="token punctuation">..</span>.
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
Testsuite summary <span class="token keyword">for</span> ntp <span class="token number">4.2</span>.8p14
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
<span class="token comment"># TOTAL: 1</span>
<span class="token comment"># PASS:  1</span>
<span class="token comment"># SKIP:  0</span>
<span class="token comment"># XFAIL: 0</span>
<span class="token comment"># FAIL:  0</span>
<span class="token comment"># XPASS: 0</span>
<span class="token comment"># ERROR: 0</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
<span class="token comment"># 通过 check 后，会列出一个清单结果，这里是表示都成功了</span>
<span class="token punctuation">[</span>root@study ntp-4.2.8p14<span class="token punctuation">]</span><span class="token comment"># make install</span>
<span class="token comment"># 安装成功后，就可以看到 ntp 目录下安装好的文件了</span>
<span class="token punctuation">[</span>root@study ntp<span class="token punctuation">]</span><span class="token comment"># cd /usr/local/ntp</span>
<span class="token punctuation">[</span>root@study ntp<span class="token punctuation">]</span><span class="token comment"># ll</span>
total <span class="token number">0</span>
drwxr-xr-x. <span class="token number">2</span> root root <span class="token number">189</span> Apr  <span class="token number">6</span> 03:49 bin
drwxr-xr-x. <span class="token number">2</span> root root   <span class="token number">6</span> Apr  <span class="token number">6</span> 03:49 libexec
drwxr-xr-x. <span class="token number">2</span> root root   <span class="token number">6</span> Apr  <span class="token number">6</span> 03:49 sbin
drwxr-xr-x. <span class="token number">5</span> root root  <span class="token number">39</span> Apr  <span class="token number">6</span> 03:49 share
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h2 id="利用-patch-更新源码"><a href="#利用-patch-更新源码" class="header-anchor">#</a> 利用 patch 更新源码</h2> <p>所谓更新源码，通常是某一段代码有问题，因此通常只是更新部分文件的小部分内容。</p> <p>好处则是：没有变动的文件的目标文件（object file）不需要重新编译，变动过的文件可以利用 make 来自动 update，如此一来，原先的设置（makefile 文件里面的规则）将不需要重新改写或检测，可以节省很多的宝贵时间</p> <p>可以用 diff 指令将两个文件的差异性列出来，再以相关的指令来将旧版的文件更新，这是可以的，通常很多软件开发商在更新了源码之后，几乎都会放出所谓的 patch file，也就是直接将源码 update 的一个方式，使用 patch 指令来完成。</p> <p>关于 diff 与 patch 的基本用法在第 11 章已经讲过了。下面通过一个简单的例子来讲解；之前章节的计算函数的例子，相关文件如下</p> <h3 id="main-0-1-版本"><a href="#main-0-1-版本" class="header-anchor">#</a> main-0.1 版本</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@study main-0.1<span class="token punctuation">]</span><span class="token comment"># ll</span>
total <span class="token number">20</span>
-rw-r--r--. <span class="token number">1</span> root root <span class="token number">184</span> Apr  <span class="token number">6</span> 04:01 cos_value.c
-rw-r--r--. <span class="token number">1</span> root root <span class="token number">101</span> Apr  <span class="token number">6</span> 04:01 haha.c
-rw-r--r--. <span class="token number">1</span> root root <span class="token number">291</span> Apr  <span class="token number">6</span> 04:01 main.c
-rw-r--r--. <span class="token number">1</span> root root <span class="token number">142</span> Apr  <span class="token number">6</span> 04:02 Makefile
-rw-r--r--. <span class="token number">1</span> root root <span class="token number">186</span> Apr  <span class="token number">6</span> 04:02 sin_value.c
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>注意：以下文件，可能是由于复制过程中的编码问题，会导致部分与 patch 中的文件内容不一致，从而导致 patch 过程失败，请直接下载以下链接中的包，并解压到 <code>/root/</code> 下</p> <ul><li><p>wget http://linux.vbird.org/linux_basic/0520source/main-0.1.tgz</p></li> <li><p>wget http://linux.vbird.org/linux_basic/0520source/main_0.1_to_0.2.patch</p> <p>下载后，修改文件名为 <code>main-0.1-to-0.2.patch</code></p></li></ul> <p><code>main.c</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment">#include &lt;stdio.h&gt;</span>
<span class="token comment">#define pi 3.14159</span>
char name<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
float angle<span class="token punctuation">;</span>

int main<span class="token punctuation">(</span>void<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token builtin class-name">printf</span> <span class="token punctuation">(</span><span class="token string">&quot;<span class="token entity" title="\n">\n</span>version 0.1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token builtin class-name">printf</span> <span class="token punctuation">(</span><span class="token string">&quot;<span class="token entity" title="\n">\n</span><span class="token entity" title="\n">\n</span>Please input your name: &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	scanf  <span class="token punctuation">(</span><span class="token string">&quot;%s&quot;</span>, <span class="token operator">&amp;</span>name <span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token builtin class-name">printf</span> <span class="token punctuation">(</span><span class="token string">&quot;<span class="token entity" title="\n">\n</span>Please enter the degree angle (ex&gt; 90): &quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
	scanf  <span class="token punctuation">(</span><span class="token string">&quot;%f&quot;</span>, <span class="token operator">&amp;</span>angle <span class="token punctuation">)</span><span class="token punctuation">;</span>
	haha<span class="token punctuation">(</span> name <span class="token punctuation">)</span><span class="token punctuation">;</span>
	sin_value<span class="token punctuation">(</span> angle <span class="token punctuation">)</span><span class="token punctuation">;</span>
	cos_value<span class="token punctuation">(</span> angle <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><code>haha.c</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment">#include &lt;stdio.h&gt;</span>
int haha<span class="token punctuation">(</span>char name<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token builtin class-name">printf</span> <span class="token punctuation">(</span><span class="token string">&quot;<span class="token entity" title="\n">\n</span><span class="token entity" title="\n">\n</span>Hi, Dear %s, nice to meet you.&quot;</span>, name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><code>sin_value.c</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment">#include &lt;stdio.h&gt;</span>
<span class="token comment">#include &lt;math.h&gt;</span>
<span class="token comment">#define pi 3.14159</span>
float angle<span class="token punctuation">;</span>

void sin_value<span class="token punctuation">(</span>void<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
        float value<span class="token punctuation">;</span>
        value <span class="token operator">=</span> sin <span class="token punctuation">(</span> angle / <span class="token number">180</span>. * pi <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token builtin class-name">printf</span> <span class="token punctuation">(</span><span class="token string">&quot;<span class="token entity" title="\n">\n</span>The sin(%f) is: %5.2f<span class="token entity" title="\n">\n</span>&quot;</span>,angle, value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><code>cos_value.c</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment">#include &lt;stdio.h&gt;</span>
<span class="token comment">#include &lt;math.h&gt;</span>
<span class="token comment">#define pi 3.14159</span>
float angle<span class="token punctuation">;</span>

void cos_value<span class="token punctuation">(</span>void<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	float value<span class="token punctuation">;</span>
	value <span class="token operator">=</span> cos <span class="token punctuation">(</span> angle / <span class="token number">180</span>. * pi <span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token builtin class-name">printf</span> <span class="token punctuation">(</span><span class="token string">&quot;The Cos is: %5.2f<span class="token entity" title="\n">\n</span>&quot;</span>,value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><code>Makefile</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># This make file is a test rule file</span>
<span class="token comment"># # Version 0.1 2009/06/06</span>
LIBS <span class="token operator">=</span> -lm
OBJS <span class="token operator">=</span> main.o haha.o sin_value.o cos_value.o
main: <span class="token variable">${OBJS}</span>
        gcc -o main <span class="token variable">${OBJS}</span> <span class="token variable">${LIBS}</span>
clean:
        <span class="token function">rm</span> -f main <span class="token variable">${OBJS}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>记得调整上面使用 tab 的语法部分</p> <h3 id="由-0-1-升级到-0-2-的-patch-file"><a href="#由-0-1-升级到-0-2-的-patch-file" class="header-anchor">#</a> 由 0.1 升级到 0.2 的 patch file</h3> <p><code>main-0.1-to-0.2.patch</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">diff</span> -Naur main-0.1/cos_value.c main-0.2/cos_value.c
--- main-0.1/cos_value.c	<span class="token number">2015</span>-09-04 <span class="token number">14</span>:46:59.200444001 +0800
+++ main-0.2/cos_value.c	<span class="token number">2015</span>-09-04 <span class="token number">14</span>:47:10.215444000 +0800
@@ -7,5 +7,5 @@
 <span class="token punctuation">{</span>
 	float value<span class="token punctuation">;</span>
 	value <span class="token operator">=</span> cos <span class="token punctuation">(</span> angle / <span class="token number">180</span>. * pi <span class="token punctuation">)</span><span class="token punctuation">;</span>
-	<span class="token builtin class-name">printf</span> <span class="token punctuation">(</span><span class="token string">&quot;The Cos is: %5.2f<span class="token entity" title="\n">\n</span>&quot;</span>,value<span class="token punctuation">)</span><span class="token punctuation">;</span>
+	<span class="token builtin class-name">printf</span> <span class="token punctuation">(</span><span class="token string">&quot;The cos(%f) is: %5.2f<span class="token entity" title="\n">\n</span>&quot;</span>,angle, value<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
<span class="token function">diff</span> -Naur main-0.1/main.c main-0.2/main.c
--- main-0.1/main.c	<span class="token number">2009</span>-06-12 00:39:38.000000000 +0800
+++ main-0.2/main.c	<span class="token number">2009</span>-06-12 00:45:38.000000000 +0800
@@ -5,7 +5,7 @@
 
 int main<span class="token punctuation">(</span>void<span class="token punctuation">)</span>
 <span class="token punctuation">{</span>
-	<span class="token builtin class-name">printf</span> <span class="token punctuation">(</span><span class="token string">&quot;<span class="token entity" title="\n">\n</span>version 0.1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
+	<span class="token builtin class-name">printf</span> <span class="token punctuation">(</span><span class="token string">&quot;<span class="token entity" title="\n">\n</span>version 0.2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 	<span class="token builtin class-name">printf</span> <span class="token punctuation">(</span><span class="token string">&quot;<span class="token entity" title="\n">\n</span><span class="token entity" title="\n">\n</span>Please input your name: &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 	scanf  <span class="token punctuation">(</span><span class="token string">&quot;%s&quot;</span>, <span class="token operator">&amp;</span>name <span class="token punctuation">)</span><span class="token punctuation">;</span>
 	<span class="token builtin class-name">printf</span> <span class="token punctuation">(</span><span class="token string">&quot;<span class="token entity" title="\n">\n</span>Please enter the degree angle (ex&gt; 90): &quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">diff</span> -Naur main-0.1/Makefile main-0.2/Makefile
--- main-0.1/Makefile	<span class="token number">2009</span>-06-12 00:34:53.000000000 +0800
+++ main-0.2/Makefile	<span class="token number">2009</span>-06-12 00:42:39.000000000 +0800
@@ -1,8 +1,12 @@
 <span class="token comment"># This make file is a test rule file</span>
-<span class="token comment"># Version 0.1 2009/06/06</span>
+<span class="token comment"># Version 0.2 2009/06/11</span>
 LIBS <span class="token operator">=</span> -lm
 OBJS <span class="token operator">=</span> main.o haha.o sin_value.o cos_value.o
 main: <span class="token variable">${OBJS}</span>
 	gcc -o main <span class="token variable">${OBJS}</span> <span class="token variable">${LIBS}</span>
 clean:
 	<span class="token function">rm</span> -f main <span class="token variable">${OBJS}</span>
+install:
+	<span class="token function">cp</span> -a main /usr/local/bin
+uninstall:
+	<span class="token function">rm</span> -f /usr/local/bin/main
<span class="token function">diff</span> -Naur main-0.1/sin_value.c main-0.2/sin_value.c
--- main-0.1/sin_value.c	<span class="token number">2015</span>-09-04 <span class="token number">14</span>:46:52.286444001 +0800
+++ main-0.2/sin_value.c	<span class="token number">2015</span>-09-04 <span class="token number">14</span>:47:17.665444020 +0800
@@ -7,5 +7,5 @@
 <span class="token punctuation">{</span>
 	float value<span class="token punctuation">;</span>
 	value <span class="token operator">=</span> sin <span class="token punctuation">(</span> angle / <span class="token number">180</span>. * pi <span class="token punctuation">)</span><span class="token punctuation">;</span>
-	<span class="token builtin class-name">printf</span> <span class="token punctuation">(</span><span class="token string">&quot;<span class="token entity" title="\n">\n</span>The Sin is: %5.2f<span class="token entity" title="\n">\n</span>&quot;</span>,value<span class="token punctuation">)</span><span class="token punctuation">;</span>
+	<span class="token builtin class-name">printf</span> <span class="token punctuation">(</span><span class="token string">&quot;<span class="token entity" title="\n">\n</span>The sin(%f) is: %5.2f<span class="token entity" title="\n">\n</span>&quot;</span>,angle, value<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br></div></div><p>把这目录和文件放到 root 目录下</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>drwxr-xr-x. <span class="token number">2</span> root   root         <span class="token number">88</span> Apr  <span class="token number">6</span> 04:11 main-0.1
-rw-r--r--. <span class="token number">1</span> root   root       <span class="token number">1538</span> Apr  <span class="token number">6</span> 04:11 main-0.1-to-0.2.patch
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>在 0.1 版本中，有 main 与 clean 两个目标功能。而 0.2 版本则增加了 install 与 uninstall 的规则与设置。下面来进行升级</p> <h3 id="测试旧版程序的功能"><a href="#测试旧版程序的功能" class="header-anchor">#</a> 测试旧版程序的功能</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@study main-0.1<span class="token punctuation">]</span><span class="token comment"># make clean main   </span>
<span class="token function">rm</span> -f main main.o haha.o sin_value.o cos_value.o
cc    -c -o main.o main.c
cc    -c -o haha.o haha.c
cc    -c -o sin_value.o sin_value.c
cc    -c -o cos_value.o cos_value.c
gcc -o main main.o haha.o sin_value.o cos_value.o -lm
<span class="token punctuation">[</span>root@study main-0.1<span class="token punctuation">]</span><span class="token comment"># ./main </span>

version <span class="token number">0.1</span>

Please input your name: mrcode

Please enter the degree angle <span class="token punctuation">(</span>ex<span class="token operator">&gt;</span> <span class="token number">90</span><span class="token punctuation">)</span>: <span class="token number">45</span>


Hi, Dear mrcode, <span class="token function">nice</span> to meet you.
The Sin is:  <span class="token number">0.71</span>
The Cos is:  <span class="token number">0.71</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>与之前的结果类似，但是如果你下达 make install 时，系统会告知没有 install 的 target，如何更新到 0.2 版本呢？</p> <h3 id="查阅-patch-file-内容"><a href="#查阅-patch-file-内容" class="header-anchor">#</a> 查阅 patch file 内容</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># vim main-0.1-to-0.2.patch </span>
<span class="token function">diff</span> -Naur main-0.1/cos_value.c main-0.2/cos_value.c
--- main-0.1/cos_value.c	<span class="token number">2015</span>-09-04 <span class="token number">14</span>:46:59.200444001 +0800
+++ main-0.2/cos_value.c	<span class="token number">2015</span>-09-04 <span class="token number">14</span>:47:10.215444000 +0800
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><code>diff -Naur main-0.1/cos_value.c main-0.2/cos_value.c</code></p> <p>表示使用 diff 去比较时，比较的两个文件路径，该路径非常重要，因为 patch 的基本语法如下</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>patch -p 数字 <span class="token operator">&lt;</span> patch_file

-p： 与 patch_file 里列出的文件名有关的信息。假如 patch_file 里面累出的文件名有关的信息，假如第一行是写的 <span class="token variable"><span class="token variable">`</span>*** /home/guest/example/expatch.old<span class="token variable">`</span></span>

那么当下达 patch -p0 <span class="token operator">&lt;</span> patch_file 时，更新的文件是 /home/guest/example/expatch.old,
如果下达  patch -p1 <span class="token operator">&lt;</span> patch_file 时，更的文件是 home/guest/example/expatch.old
如果下达  patch -p4 <span class="token operator">&lt;</span> patch_file 时，更新的是 expatch.old
也就是说 -pxx xx 表示是拿掉几个斜线的意思

那么上面比较的文件是在 main-0.1/xxx 与 main-0.2/xxx 所以，如果你是在 main-0.1 下，并且想要处理更新时，就需要拿掉一个目录，因为并没有 main-0.2 的存在，我们是在当前的目录进行更新的，因此需要使用 -p1 才对
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="更新源码，并重新编译程序"><a href="#更新源码，并重新编译程序" class="header-anchor">#</a> 更新源码，并重新编译程序</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@study main-0.1<span class="token punctuation">]</span><span class="token comment"># patch -p1 &lt; ../main-0.1-to-0.2.patch </span>
patching <span class="token function">file</span> cos_value.c
patching <span class="token function">file</span> main.c
patching <span class="token function">file</span> Makefile
patching <span class="token function">file</span> sin_value.c
<span class="token comment"># 请注意，目前所在的目录在 main-0.1 ，注意与 patch 文件的相对路径</span>
<span class="token comment"># 虽然有 5 个文件，但是只有 4 个文件有修改过，上面显示有修改过的文件</span>

<span class="token punctuation">[</span>root@study main-0.1<span class="token punctuation">]</span><span class="token comment"># make clean main</span>
<span class="token function">rm</span> -f main main.o haha.o sin_value.o cos_value.o
cc    -c -o main.o main.c
cc    -c -o haha.o haha.c
cc    -c -o sin_value.o sin_value.c
cc    -c -o cos_value.o cos_value.c
gcc -o main main.o haha.o sin_value.o cos_value.o -lm
<span class="token punctuation">[</span>root@study main-0.1<span class="token punctuation">]</span><span class="token comment"># ./main </span>

version <span class="token number">0.2</span>

Please input your name: mrcode

Please enter the degree angle <span class="token punctuation">(</span>ex<span class="token operator">&gt;</span> <span class="token number">90</span><span class="token punctuation">)</span>: <span class="token number">45</span>


Hi, Dear mrcode, <span class="token function">nice</span> to meet you.
The sin<span class="token punctuation">(</span><span class="token number">45.000000</span><span class="token punctuation">)</span> is:  <span class="token number">0.71</span>
The cos<span class="token punctuation">(</span><span class="token number">45.000000</span><span class="token punctuation">)</span> is:  <span class="token number">0.71</span>

<span class="token punctuation">[</span>root@study main-0.1<span class="token punctuation">]</span><span class="token comment"># make install</span>
<span class="token function">cp</span> -a main /usr/local/bin
<span class="token comment"># 可以看到，把执行程序复制到了 bin 下，所以就可以不加绝对路径运行了</span>
<span class="token punctuation">[</span>root@study main-0.1<span class="token punctuation">]</span><span class="token comment"># main</span>
<span class="token punctuation">[</span>root@study main-0.1<span class="token punctuation">]</span><span class="token comment"># make uninstall</span>
<span class="token function">rm</span> -f /usr/local/bin/main
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><p>这个就是利用了 diff 和 patch 指令来完成的源码更新，然后重新编译安装的效果和流程。</p> <p>如果你 patch 错误呢？可以通过 <code>patch -R &lt; ../main-0.1-to-0.2.patch</code> 将已经更新过的还原。（笔者在复制笔记上的文件到虚拟机文件的时候，不知道哪里有问题，导致前 4 个文件可以 patch 成功，但是第 4 个文件显示失败，这种情况下，就可以通过这样的指令还原回去）</p> <p>一个问题：如果有一个很旧版本的软件，该软件已经更新到最新版本，例如核心，我可以使用 patch file 来更新吗？</p> <p>答：首先要确认有释放出 patch file 才行，以 kernel 2.2.xx 与 2.4.xx 来说，基本上的架构已经不同了，所以两者无法以 patch file 来更新的。不过 2.4.xx 与 2.4.yy 就可以。不过，因为 kernel 每次推出的 patch 文件都是针对前一个版本而已，假设你的内核是 kernel 2.4.20 要升级大 2.5.26，那么中间有 5 个文件，需要按顺序更新才可以。但是如果有朋友帮你对比过 2.4.20 与 2.4.26，那么你直接使用该 patch file 来直接一次更新也可以</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/zq99299/linux-tutorial/edit/master/docs/tutorial-basis/21/04.md" target="_blank" rel="noopener noreferrer">帮助我们改善此页面！</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">上次更新: :</span> <span class="time">a minute ago</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/linux-tutorial/tutorial-basis/21/03.html" class="prev">
        用 make 进行宏编译
      </a></span> <span class="next"><a href="/linux-tutorial/tutorial-basis/21/05.html">
        函数库的管理
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/linux-tutorial/assets/js/app.3ea62065.js" defer></script><script src="/linux-tutorial/assets/js/2.b00e63ff.js" defer></script><script src="/linux-tutorial/assets/js/164.9ee339c2.js" defer></script><script src="/linux-tutorial/assets/js/16.b0a90d5f.js" defer></script>
  </body>
</html>
