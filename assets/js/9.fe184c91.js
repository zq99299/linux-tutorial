(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{485:function(s,t,a){s.exports=a.p+"assets/img/image-20200227143813650.a20095d6.png"},486:function(s,t,a){s.exports=a.p+"assets/img/image-20200227144535061.022d6273.png"},487:function(s,t,a){s.exports=a.p+"assets/img/image-20200227145429427.c0786c46.png"},488:function(s,t,a){s.exports=a.p+"assets/img/image-20200227150303026.45c62b4d.png"},626:function(s,t,a){"use strict";a.r(t);var n=a(16),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"软件磁盘阵列（software-raid）"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#软件磁盘阵列（software-raid）"}},[s._v("#")]),s._v(" 软件磁盘阵列（Software RAID）")]),s._v(" "),n("h2",{attrs:{id:"什么是-raid"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#什么是-raid"}},[s._v("#")]),s._v(" 什么是 RAID")]),s._v(" "),n("p",[s._v("Redundant Arrays of Inexpensive Disks 简称 RAID，翻译为：容错式链家磁盘阵列。")]),s._v(" "),n("p",[s._v("RAID 通过一种技术（软件或硬件），将多个较小的磁盘整合成为一个较大的磁盘，而且还具有数据保护功能。根据等级不同，整合后的磁盘具有不同的功能，基本常见的 level 有如下几种：")]),s._v(" "),n("h3",{attrs:{id:"raid-0-等量模式-stripe：效能最佳"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#raid-0-等量模式-stripe：效能最佳"}},[s._v("#")]),s._v(" RAID-0 等量模式 stripe：效能最佳")]),s._v(" "),n("p",[s._v("该模式如果使用相同型号与容量的磁盘来组成时，效果较佳。RAID 将磁盘切出等量的区块（chunk），一般可设置为 4K~1M 之间，当一个文件要写入 RAID 时，该文件会依据 chunk 的大小切割好，再依序放到各个磁盘里。会优先等量存放到各个磁盘上去，比如：有两块磁盘都是 100G，你有一个文件 100M，那么每个磁盘会分到 50MB 的容量，但是如果一块磁盘是 50G，另外一块是 100G，由于是等量，但是由于磁盘小磁盘先被放满，那么其他数据就会落到另一块磁盘上，这种情况下效能就降低了，因为所有压力由一块磁盘承担了。")]),s._v(" "),n("p",[n("img",{attrs:{src:a(485),alt:"image-20200227143813650"}})]),s._v(" "),n("p",[s._v("这种模式下，越多的硬盘组成的 RAID-0 理论上效能会越好，因为每块磁盘负责的数据量更低了，但是 "),n("strong",[s._v("只要有任何一块磁盘顺坏，在 RAID 上面的所有数据都会丢失而无法读取")]),s._v("。")]),s._v(" "),n("p",[s._v("因为等量分散在每块硬盘上，坏掉一块硬盘，意味着有部分数据丢失了，那么一个文件的部分数据丢失了，不完整了，可能该文件也就损坏了")]),s._v(" "),n("h3",{attrs:{id:"raid-1-映像模式-mirror：完整备份"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#raid-1-映像模式-mirror：完整备份"}},[s._v("#")]),s._v(" RAID-1 映像模式 mirror：完整备份")]),s._v(" "),n("p",[s._v("建议使用相同磁盘容量，最好是一样的磁盘，如果是不同容量的磁盘组成，那么总容量将以最小的那一块为主。")]),s._v(" "),n("p",[s._v("这种模式主要是：让同一份数据，完整的保存在两块磁盘上。比如：100MB 的文件，且目前只有 两块硬盘组成 RAID-1 时，那么每块硬盘上都会写入 100MB 的数据。由于两块磁盘内容一模一样，好像镜子映照出来一样，所以也称为 mirror 模式")]),s._v(" "),n("p",[n("img",{attrs:{src:a(486),alt:"image-20200227144535061"}})]),s._v(" "),n("p",[s._v("如图，一份数据被写入到两块磁盘中，如果使用软件来做磁盘阵列，那么效能会大大降低，因为只有一个南桥，一份数据要写入两次。如果使用的是 RAID（磁盘阵列卡）时，阵列卡会主动复制一份儿不使用系统的 I/O 总线，效能就还可以。")]),s._v(" "),n("p",[s._v("由于是映像数据，当其中一块硬盘损坏，数据还是完整的。")]),s._v(" "),n("p",[s._v("RAID-1 最大的优点大概就在于数据的备份。用空间换安全。写入效能不佳，但是读取效能还不错，多个 processes 在读取同一份数据时，RAID 会自行取得最佳的读取平衡")]),s._v(" "),n("h3",{attrs:{id:"raid-1-0，raid-0-1"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#raid-1-0，raid-0-1"}},[s._v("#")]),s._v(" RAID 1+0，RAID 0+1")]),s._v(" "),n("p",[s._v("RAID-0 效能佳，数据不安全。RAID-1 数据安全，但效能不佳。将两者组合起来就形成了：")]),s._v(" "),n("ul",[n("li",[s._v("RAID 1 + 0：先让两块磁盘组成 RAID 1（共有两组），再让这两组 RAID 1 再组成一组 RAID 0")]),s._v(" "),n("li",[s._v("RAID 0 + 1：则与上面相反")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(487),alt:"image-20200227145429427"}})]),s._v(" "),n("p",[s._v("此种方式，最坏的可能性是同时坏掉 b 和 c，也就是 RAID 1 中的其中一块。那么数据都能保证完整。此种方式也是目前存储设备厂商推荐的方法")]),s._v(" "),n("p",[s._v("假设你有 20 快磁盘组成的系统，每两块组成一个 RAID 1，总共有 10 组可以自己复原的系统，再让这 10 组组成一个新的 RAID 0，速度立刻拉升 10 倍了。同时注意：因为每组 RAID 1 是个别独立存在的，因此任何一块磁盘损坏，数据都是从另一块磁盘直接复制过来重建，并不像 RAID5/RAID6 必须要整组 RAID 的磁盘共同重建一块独立的磁盘系统，而且 RAID 1 与 RAID 0 不需要经过计算的（striping），读写效率也比其他的 RAID 等级好太多了，这也是为什么会推荐 RAID1 + 0 方式了")]),s._v(" "),n("h3",{attrs:{id:"raid-5：效能与数据备份的均衡考虑"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#raid-5：效能与数据备份的均衡考虑"}},[s._v("#")]),s._v(" RAID 5：效能与数据备份的均衡考虑")]),s._v(" "),n("p",[s._v("RAID 5 至少需要三块以上的磁盘才能够组成这种类型的磁盘阵列。数据写入类似 RAID 0，不过每个循环的写入过程中（striping），在每块磁盘还加入一个同位检查数据（Parity），该数据会记录其他磁盘的备份数据，用于当有磁盘损坏时的救援。")]),s._v(" "),n("p",[n("img",{attrs:{src:a(488),alt:"image-20200227150303026"}})]),s._v(" "),n("p",[s._v("每个循环写入时，都会有部分的同为检查码 parity 被记录，并且记录的同位检查码每次都记录在不同的磁盘，当任何一个磁盘损坏时，可以由其他磁盘的检查码来重建原磁盘内的数据，由于有同位检查码，RAID 5 的总容量会是整体磁盘数量减 1 快磁盘。原本 3 块磁盘，只剩下 3-1 =2 快磁盘的容量。当磁盘损坏数量大于等于 2 块时，整组 RAID 5 的数据就损坏了。因此 RAID 5 预设只能支持一块磁盘损坏的情况")]),s._v(" "),n("p",[s._v("读写效能上的比较：")]),s._v(" "),n("ul",[n("li",[s._v("读：由于多快磁盘，效率堪比 RAID-0")]),s._v(" "),n("li",[s._v("写：有同位检查码 parity的计算，写入效能与系统的硬件关系较大，尤其当使用软件磁盘阵列时，parity 是通过 CPU 去计算而非专职的磁盘阵列卡，所以写效率需要评估")])]),s._v(" "),n("p",[s._v("RAID 5 仅能支持一块磁盘的损坏，因此出现了 RAID 6，RAID 6 使用 2 块磁盘作为 parity 的存储。所以当两块磁盘损坏时，数据还完整")]),s._v(" "),n("h3",{attrs:{id:"spare-disk：预备磁盘的功能"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#spare-disk：预备磁盘的功能"}},[s._v("#")]),s._v(" Spare Disk：预备磁盘的功能")]),s._v(" "),n("p",[s._v("当磁盘阵列损坏时，需要更换新的硬盘，并重建原本的数据。")]),s._v(" "),n("p",[s._v("更换上新的硬盘并顺利启动磁盘阵列后，磁盘阵列会主动重建（rebuild）原本损坏那块磁盘的数据到新的磁盘上，这是磁盘阵列的有点。必过，需要手动插拨硬盘（更换坏掉的硬盘），如果你的系统支持热插播，那么不需要关机就可以完成数据重建")]),s._v(" "),n("p",[s._v("为了让系统可以实时的在坏掉硬盘时主动重建，就需要预备磁盘（spare disk）。就是一块或多块磁盘不包含在原本的磁盘阵列等级中的磁盘，当磁盘阵列中的磁盘顺坏时，则会被主动拉进磁盘阵列中，将坏的磁盘移除磁盘阵列，并重建数据。")]),s._v(" "),n("p",[s._v("同样，如果你的磁盘阵列支持热插拨，拔掉旧硬盘，换上新硬盘，并设置为 spare disk。就更方便了")]),s._v(" "),n("p",[s._v("举例来说“有一个磁盘阵列可允许 16 快磁盘的数量，只有 10 块硬盘（每块 250G），用了 9 快硬盘组成 RAID 5。 1 快硬盘作为 spare disk，那么该磁盘阵列总容量为  (9-1)*250G=2000G。两年后看信号灯才发现坏掉了一块磁盘，那么之前预备的那块 spare disk 被自动拉进磁盘阵列了。 对数据没有任何影响")]),s._v(" "),n("h3",{attrs:{id:"磁盘阵列的优点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#磁盘阵列的优点"}},[s._v("#")]),s._v(" 磁盘阵列的优点")]),s._v(" "),n("p",[s._v("如果要磁盘阵列，应该考虑：")]),s._v(" "),n("ol",[n("li",[s._v("数据安全与可靠性：不是指网络信息安全，而是当硬件（磁盘）损坏时，数据是否能保证不丢失")]),s._v(" "),n("li",[s._v("读写效率：例如 RAID 0 可以加强读写效率，让你的系统 I/O 部分得到改善")]),s._v(" "),n("li",[s._v("容量：可以让多块磁盘组合起来，也就意味着单一文件系统可以有相当大的容量")])]),s._v(" "),n("p",[s._v("尤其是数据的可靠性与完整性更是使用 RAID 的考虑重点。")]),s._v(" "),n("p",[s._v("各个等级优缺点如下")]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",{staticStyle:{"text-align":"center"}},[s._v("项目")]),s._v(" "),n("th",{staticStyle:{"text-align":"center"}},[s._v("RAID 0")]),s._v(" "),n("th",{staticStyle:{"text-align":"center"}},[s._v("RAID 1")]),s._v(" "),n("th",{staticStyle:{"text-align":"center"}},[s._v("RAID 10")]),s._v(" "),n("th",{staticStyle:{"text-align":"center"}},[s._v("RAID 5")]),s._v(" "),n("th",{staticStyle:{"text-align":"center"}},[s._v("RAID 6")])])]),s._v(" "),n("tbody",[n("tr",[n("td",{staticStyle:{"text-align":"center"}},[s._v("最少磁盘")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("2")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("2")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("4")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("3")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("4")])]),s._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[s._v("最大容错磁盘（1）")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("无")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("n-1")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("n/2")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("1")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("2")])]),s._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[s._v("数据安全性（1）")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("完全没有")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("最佳")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("最佳")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("好")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("比 RAID5 好")])]),s._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[s._v("理论写入效率（2）")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("n")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("1")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("n/2")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("< n-1")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("< n-2")])]),s._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[s._v("理论读取效率（2）")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("n")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("n")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("n")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("< n-1")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("< n-2")])]),s._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[s._v("可用容量（3）")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("n")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("1")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("n/2")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("n-1")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("n -2")])]),s._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[s._v("一般应用")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("强调效率单数据不重要")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("资料与备份")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("服务器、云系统常用")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("资料与备份")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("资料与备份")])])])]),s._v(" "),n("p",[s._v("注意：因为 RAID5/6 读写需要经过 parity 的计算器，因此读写效率不会刚好满足使用的磁盘数量")]),s._v(" "),n("p",[s._v("另外，根据使用情况的不同，一般推荐的磁盘阵列的等级也不同；比如几百 GB 单一大文件数据，会选择在 RAID 6 ，能满足读写需求还有数据完整性保证。如果是在云程序环境中，因为需要确保每个虚拟机能够快速反应及提供数据完整性，因此 RAID5/6 效率较弱的等级是不考虑的，总结来说，大概就剩下  RAID 10 能满足云环境的效率需求了。在某些更特别的环境下，如果搭配 SSD 那么读写效率上会更好")]),s._v(" "),n("h2",{attrs:{id:"software、hardware-raid"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#software、hardware-raid"}},[s._v("#")]),s._v(" software、hardware RAID")]),s._v(" "),n("p",[s._v("磁盘阵列分为软件与硬件磁盘阵列")]),s._v(" "),n("p",[s._v("硬件磁盘阵列 hardware RAID 是通过磁盘阵列卡来达成数组的目的。上面有一块专门的芯片处理 RAID 任务，那么很多任务（如 RAID 5 的同为检查码计算）就不会重复消耗原本系统的 I/O 总线。理论上效率更好。另外一般的中高阶磁盘阵列卡都支持热插拨")]),s._v(" "),n("p",[s._v("磁盘阵列卡好的上万，低价的可能只能支持到 RAID 0 与 1，同时还需要磁盘阵列卡的驱动程序，才能使用")]),s._v(" "),n("p",[s._v("由于磁盘阵列有很多优秀的功能，但是很贵，因此就出现了软件仿真磁盘阵列功能，")]),s._v(" "),n("p",[s._v("软件磁盘阵列 software RAID 主要通过软件来仿真数组的任务，因此会耗费较多的系统资源，如 CPU 运算和 IO 总线等资源。由于个人计算机的发展快速，这些限制还不算严重，可以玩一玩软件磁盘阵列")]),s._v(" "),n("p",[s._v("以 CentOS 提供的软件 mdadm 磁盘阵列来说，它会以 partition 或 disk 为磁盘单位，意味着你不需要两块以上的磁盘，只需要有两个以上的分区槽（partition）就能过设计你的磁盘阵列。它支持的等级有 RAID0/1/5 spare disk 等，而且提供的管理机制还能达到类似热插拨的功能，可以在线（文件系统正常使用）进行分区槽的抽换。")]),s._v(" "),n("p",[s._v("硬件磁盘阵列在 Linux 下看起来就是一块实际的大磁盘，因此硬件磁盘阵列文件名为 `/dev/sd[a-p],因为使用到 SCSI 的模块的原因。")]),s._v(" "),n("p",[s._v("软件磁盘阵列时系统仿真的，因此使用的文件名是系统的装置文件，文件名为 "),n("code",[s._v("/dev/md0 /dev/md1 ...")])]),s._v(" "),n("p",[s._v("Intel 的南桥附赠的磁盘阵列功能，在 windows 视乎是完整的磁盘阵列，但是在 Linux 下被视为是软件磁盘阵列的一种，因此如果你有设置过 Intel 的南桥芯片磁盘阵列，那么在 Linux 下会是 "),n("code",[s._v("/dev/md126、/dev/md127")]),s._v(" 之类的装置文件名，而他的分区槽是 "),n("code",[s._v("/dev/md126p1、/dev/md126p2")]),s._v(" 之类")]),s._v(" "),n("h2",{attrs:{id:"磁盘阵列的设置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#磁盘阵列的设置"}},[s._v("#")]),s._v(" 磁盘阵列的设置")]),s._v(" "),n("p",[s._v("很简单，一个指令即可")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mdadm")]),s._v(" --detail /dev/md0\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mdadm")]),s._v(" --create /dev/md"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("-9"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" --auto"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("yes --level"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("015"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" --chunk"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("NK --raid-devices"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("N --spare-devices"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("N /dev/sdx /dev/hdx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n\n选项与参数：\n\n\t--create：创建 RAID 关键词\n\t--auto"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("yes：决定建立后面接的软件磁盘阵列装置。也就是 "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("/dev/md0 、/dev/md1 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n\t--chunk"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("NK：决定装置的 chunk 大小，也可以当成 stripe 大小，一般是 64K 或 512K\n\t--raid-devices"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("N：使用几个磁盘（partition）作为磁盘阵列的装置\n\t--spare-devices"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("N：使用几个磁盘作为备用（spare）装置\n\t--level"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("015"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("：设置这组磁盘阵列的等级。支持很多，不过建议只要用 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("、1、5\n\t--detail：后面接的那个磁盘阵列装置的详细信息\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("p",[s._v("如上语法中，谈到后面接装置名，这些装置文件可以是整块磁盘（如 /dev/sdb），也可以是分区槽（如 "),n("code",[s._v("/dev/sdb1")]),s._v("） 之类，但是这些装置文件名的总数必须要等于 "),n("code",[s._v("--raid-devices")]),s._v("  与 "),n("code",[s._v("--spare-devices")]),s._v(" 的个数综合才行。")]),s._v(" "),n("p",[s._v("下面使用测试机创建一个 RAID5 的软件磁盘阵列，磁盘阵列规划如下：")]),s._v(" "),n("ul",[n("li",[s._v("利用 4 个 partition 组成 RAID5")]),s._v(" "),n("li",[s._v("每个 partition 约 1GB，需确定每个 partition 一样大较佳")]),s._v(" "),n("li",[s._v("利用 1 个 partition 设置为 spare disk")]),s._v(" "),n("li",[s._v("chunk 设置为 256K")]),s._v(" "),n("li",[s._v("spare disk 的大小与其他 RAID 所需 partition 一样大")]),s._v(" "),n("li",[s._v("将此 RAID 5 装置挂载到 "),n("code",[s._v("/srv/raid")]),s._v(" 目录下")])]),s._v(" "),n("h3",{attrs:{id:"磁盘分区"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#磁盘分区"}},[s._v("#")]),s._v(" 磁盘分区")]),s._v(" "),n("p",[s._v("下面进行分区，"),n("a",{attrs:{href:"../07/03"}},[s._v("分区手段参考之前的的章节")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看当前磁盘状态")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# lsblk")]),s._v("\nNAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT\nsda               "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":0    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("40")]),s._v(".8G  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" disk \n├─sda1            "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":1    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    2M  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" part \n├─sda2            "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":2    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    1G  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" part /boot\n└─sda3            "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":3    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   30G  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" part \n  ├─centos-root "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("253")]),s._v(":0    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   10G  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" lvm  /\n  ├─centos-swap "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("253")]),s._v(":1    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    1G  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" lvm  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("SWAP"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  └─centos-home "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("253")]),s._v(":2    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    5G  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" lvm  /home\nsdb               "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":16   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    2G  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" disk \nsr0              "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":0    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("73")]),s._v(".6M  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" rom  \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 上面发现一快 sda 磁盘，有三个分区，分区大小是 33 G 左右，也就是说还有 7 G 左右可以使用")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# lsblk -ip /dev/sda")]),s._v("\nNAME                        MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT\n/dev/sda                      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":0    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("40")]),s._v(".8G  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" disk \n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("-/dev/sda1                   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":1    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    2M  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" part \n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("-/dev/sda2                   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":2    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    1G  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" part /boot\n"),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("-/dev/sda3                   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":3    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   30G  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" part \n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("-/dev/mapper/centos-root "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("253")]),s._v(":0    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   10G  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" lvm  /\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("-/dev/mapper/centos-swap "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("253")]),s._v(":1    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    1G  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" lvm  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("SWAP"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("-/dev/mapper/centos-home "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("253")]),s._v(":2    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    5G  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" lvm  /home\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 那么下面")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# lsblk -ip /dev/sda")]),s._v("\nNAME                        MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT\n/dev/sda                      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":0    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("40")]),s._v(".8G  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" disk \n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("-/dev/sda1                   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":1    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    2M  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" part \n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("-/dev/sda2                   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":2    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    1G  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" part /boot\n"),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("-/dev/sda3                   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":3    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   30G  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" part \n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("-/dev/mapper/centos-root "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("253")]),s._v(":0    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   10G  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" lvm  /\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("-/dev/mapper/centos-swap "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("253")]),s._v(":1    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    1G  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" lvm  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("SWAP"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("-/dev/mapper/centos-home "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("253")]),s._v(":2    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    5G  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" lvm  /home\n  \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开始分区，总共需要分出来 5 个 1 g 的分区")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# gdisk /dev/sda")]),s._v("\nGPT "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("fdisk")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("gdisk"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" version "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.8")]),s._v(".10\n\nPartition table scan:\n  MBR: protective\n  BSD: not present\n  APM: not present\n  GPT: present\n\nFound valid GPT with protective MBR"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" using GPT.\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看当前 磁盘 的状态")]),s._v("\nCommand "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("? "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("help")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": p\nDisk /dev/sda: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("85491712")]),s._v(" sectors, "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("40.8")]),s._v(" GiB\nLogical sector size: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("512")]),s._v(" bytes\nDisk identifier "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("GUID"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": 67038DBF-B66A-4D0F-92B2-BFBF0744CD1D\nPartition table holds up to "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("128")]),s._v(" entries\nFirst usable sector is "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("34")]),s._v(", last usable sector is "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("85491678")]),s._v("\nPartitions will be aligned on "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),s._v("-sector boundaries\nTotal "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("free")]),s._v(" space is "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20467645")]),s._v(" sectors "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("9.8")]),s._v(" GiB"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 空闲扇区")]),s._v("\n\nNumber  Start "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sector"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("    End "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sector"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  Size       Code  Name\n   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("            "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),s._v("            "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6143")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.0")]),s._v(" MiB     EF02  \n   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("            "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6144")]),s._v("         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2103295")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024.0")]),s._v(" MiB  0700  \n   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2103296")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("65026047")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("30.0")]),s._v(" GiB    8E00  \n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 有上面可以看出来，实际上还有 9 g 左右可以使用")]),s._v("\nCommand "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("? "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("help")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": n\nPartition number "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("-128, default "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": \nFirst sector "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("34")]),s._v("-85491678, default "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("65026048")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" or "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("+-"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("size"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("KMGTP"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(": \nLast sector "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("65026048")]),s._v("-85491678, default "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("85491678")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" or "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("+-"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("size"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("KMGTP"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(": +1G\nCurrent "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v(" is "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Linux filesystem'")]),s._v("\nHex code or GUID "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("L to show codes, Enter "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8300")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": Fd00\nChanged "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v(" of partition to "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Linux RAID'")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 上面分区了一个，后面 4 个分区，就不贴出来了")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\nCommand "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("? "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("help")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": P\nDisk /dev/sda: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("85491712")]),s._v(" sectors, "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("40.8")]),s._v(" GiB\nLogical sector size: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("512")]),s._v(" bytes\nDisk identifier "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("GUID"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": 67038DBF-B66A-4D0F-92B2-BFBF0744CD1D\nPartition table holds up to "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("128")]),s._v(" entries\nFirst usable sector is "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("34")]),s._v(", last usable sector is "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("85491678")]),s._v("\nPartitions will be aligned on "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),s._v("-sector boundaries\nTotal "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("free")]),s._v(" space is "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("9981885")]),s._v(" sectors "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.8")]),s._v(" GiB"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nNumber  Start "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sector"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("    End "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sector"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  Size       Code  Name\n   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("            "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),s._v("            "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6143")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.0")]),s._v(" MiB     EF02  \n   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("            "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6144")]),s._v("         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2103295")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024.0")]),s._v(" MiB  0700  \n   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2103296")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("65026047")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("30.0")]),s._v(" GiB    8E00  \n   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("65026048")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("67123199")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024.0")]),s._v(" MiB  FD00  Linux RAID\n   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("67123200")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("69220351")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024.0")]),s._v(" MiB  FD00  Linux RAID\n   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("69220352")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("71317503")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024.0")]),s._v(" MiB  FD00  Linux RAID\n   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("71317504")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("73414655")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024.0")]),s._v(" MiB  FD00  Linux RAID\n   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("73414656")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("75511807")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024.0")]),s._v(" MiB  FD00  Linux RAID\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 最后分区好的 5 个分区如上。每个都占用 1G 空间")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 最后保存分区")]),s._v("\nCommand "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("? "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("help")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": w\n\nFinal checks complete. About to "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("write")]),s._v(" GPT data. THIS WILL OVERWRITE EXISTING\nPARTITIONS"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("\n\nDo you want to proceed? "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Y/N"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": y\nOK"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" writing new GUID partition table "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("GPT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" to /dev/sda.\nWarning: The kernel is still using the old partition table.\nThe new table will be used at the next reboot.\nThe operation has completed successfully.\n\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 再次确认分区")]),s._v("\nCommand "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("? "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("help")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": p\nDisk /dev/sda: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("85491712")]),s._v(" sectors, "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("40.8")]),s._v(" GiB\nLogical sector size: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("512")]),s._v(" bytes\nDisk identifier "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("GUID"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": 67038DBF-B66A-4D0F-92B2-BFBF0744CD1D\nPartition table holds up to "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("128")]),s._v(" entries\nFirst usable sector is "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("34")]),s._v(", last usable sector is "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("85491678")]),s._v("\nPartitions will be aligned on "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),s._v("-sector boundaries\nTotal "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("free")]),s._v(" space is "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("9981885")]),s._v(" sectors "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.8")]),s._v(" GiB"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 空闲扇区")]),s._v("\n\nNumber  Start "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sector"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("    End "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sector"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  Size       Code  Name\n   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("            "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),s._v("            "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6143")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.0")]),s._v(" MiB     EF02  \n   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("            "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6144")]),s._v("         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2103295")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024.0")]),s._v(" MiB  0700  \n   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2103296")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("65026047")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("30.0")]),s._v(" GiB    8E00  \n   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("65026048")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("67123199")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024.0")]),s._v(" MiB  FD00  Linux RAID\n   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("67123200")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("69220351")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024.0")]),s._v(" MiB  FD00  Linux RAID\n   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("69220352")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("71317503")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024.0")]),s._v(" MiB  FD00  Linux RAID\n   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("71317504")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("73414655")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024.0")]),s._v(" MiB  FD00  Linux RAID\n   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("73414656")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("75511807")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024.0")]),s._v(" MiB  FD00  Linux RAID\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 之前空闲扇区是 9.8G，现在还有 4.8G,也有 5 个分区，证明是分区成功了的")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 最后记得分区相关的更新指令，否则使用 lsblk 还是看不到分区出来的 part ")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br"),n("span",{staticClass:"line-number"},[s._v("87")]),n("br"),n("span",{staticClass:"line-number"},[s._v("88")]),n("br"),n("span",{staticClass:"line-number"},[s._v("89")]),n("br"),n("span",{staticClass:"line-number"},[s._v("90")]),n("br"),n("span",{staticClass:"line-number"},[s._v("91")]),n("br"),n("span",{staticClass:"line-number"},[s._v("92")]),n("br"),n("span",{staticClass:"line-number"},[s._v("93")]),n("br"),n("span",{staticClass:"line-number"},[s._v("94")]),n("br"),n("span",{staticClass:"line-number"},[s._v("95")]),n("br"),n("span",{staticClass:"line-number"},[s._v("96")]),n("br"),n("span",{staticClass:"line-number"},[s._v("97")]),n("br"),n("span",{staticClass:"line-number"},[s._v("98")]),n("br"),n("span",{staticClass:"line-number"},[s._v("99")]),n("br"),n("span",{staticClass:"line-number"},[s._v("100")]),n("br"),n("span",{staticClass:"line-number"},[s._v("101")]),n("br"),n("span",{staticClass:"line-number"},[s._v("102")]),n("br"),n("span",{staticClass:"line-number"},[s._v("103")]),n("br"),n("span",{staticClass:"line-number"},[s._v("104")]),n("br"),n("span",{staticClass:"line-number"},[s._v("105")]),n("br"),n("span",{staticClass:"line-number"},[s._v("106")]),n("br"),n("span",{staticClass:"line-number"},[s._v("107")]),n("br"),n("span",{staticClass:"line-number"},[s._v("108")]),n("br"),n("span",{staticClass:"line-number"},[s._v("109")]),n("br"),n("span",{staticClass:"line-number"},[s._v("110")]),n("br"),n("span",{staticClass:"line-number"},[s._v("111")]),n("br"),n("span",{staticClass:"line-number"},[s._v("112")]),n("br"),n("span",{staticClass:"line-number"},[s._v("113")]),n("br"),n("span",{staticClass:"line-number"},[s._v("114")]),n("br"),n("span",{staticClass:"line-number"},[s._v("115")]),n("br"),n("span",{staticClass:"line-number"},[s._v("116")]),n("br"),n("span",{staticClass:"line-number"},[s._v("117")]),n("br"),n("span",{staticClass:"line-number"},[s._v("118")]),n("br"),n("span",{staticClass:"line-number"},[s._v("119")]),n("br"),n("span",{staticClass:"line-number"},[s._v("120")]),n("br"),n("span",{staticClass:"line-number"},[s._v("121")]),n("br"),n("span",{staticClass:"line-number"},[s._v("122")]),n("br"),n("span",{staticClass:"line-number"},[s._v("123")]),n("br"),n("span",{staticClass:"line-number"},[s._v("124")]),n("br")])]),n("p",[s._v("上面复习了一下分区操作，下面开始配置 RAID")]),s._v(" "),n("h3",{attrs:{id:"配置-raid"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置-raid"}},[s._v("#")]),s._v(" 配置 RAID")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 确认分区槽")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# lsblk")]),s._v("\nNAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT\nsda               "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":0    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("40")]),s._v(".8G  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" disk \n├─sda1            "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":1    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    2M  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" part \n├─sda2            "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":2    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    1G  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" part /boot\n├─sda3            "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":3    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   30G  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" part \n│ ├─centos-root "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("253")]),s._v(":0    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   10G  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" lvm  /\n│ ├─centos-swap "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("253")]),s._v(":1    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    1G  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" lvm  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("SWAP"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n│ └─centos-home "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("253")]),s._v(":2    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    5G  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" lvm  /home\n├─sda4            "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":4    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    1G  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" part \n├─sda5            "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":5    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    1G  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" part \n├─sda6            "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":6    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    1G  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" part \n├─sda7            "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":7    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    1G  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" part \n└─sda8            "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":8    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    1G  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" part \nsdb               "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":16   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    2G  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" disk \nsr0              "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":0    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("73")]),s._v(".6M  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" rom \n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 以 mdadm 建立 RAID")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mdadm --create /dev/md0 --auto=yes --level=5 --chunk=256K --raid-devices=4 --spare-devices=1 /dev/sda{4,5,6,7,8}")]),s._v("\nmdadm: /dev/sda5 appears to contain an ext2fs "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" system\n       "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("size")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("1048576K  "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("mtime")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Sun Oct "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(":05:52 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v("\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 有时候出现这个信息,不用管")]),s._v("\nContinue creating array? y\nmdadm: Defaulting to version "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.2")]),s._v(" metadata\nmdadm: array /dev/md0 started.\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 详细的参数说明，查看前面章节，这里使用 {} 将重复的项目简化")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 此外 dsa 5 提示 ext2fs 问题，是抓到之前的 filesystem")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 去人创建，就会删除之前的的旧系统")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mdadm --detail /dev/md0")]),s._v("\n/dev/md0:\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 装置文件名")]),s._v("\n           Version "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.2")]),s._v("\n     Creation Time "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" Sat Feb "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v(" 06:13:57 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("\t\t\t\t\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建 RAID 的时间")]),s._v("\n        Raid Level "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" raid5\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# RAID 等级，这里是 RAID5")]),s._v("\n        Array Size "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3139584")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.99")]),s._v(" GiB "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.21")]),s._v(" GB"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\t\t\t\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 整组 RAID 整组可用容量")]),s._v("\n     Used Dev Size "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1046528")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1022.00")]),s._v(" MiB "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1071.64")]),s._v(" MB"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 每块磁盘的容量")]),s._v("\n      Raid Devices "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 组成 RAID 的磁盘数量")]),s._v("\n     Total Devices "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 包含 spare 的总磁盘数量")]),s._v("\n       Persistence "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" Superblock is persistent\n\n       Update Time "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" Sat Feb "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v(" 06:14:06 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("\n             State "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" clean \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 目前这个磁盘整理的使用状态")]),s._v("\n    Active Devices "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# active 启动的装置数量")]),s._v("\n   Working Devices "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 目前使用此数组的数量")]),s._v("\n    Failed Devices "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 损坏的装置数量")]),s._v("\n     Spare Devices "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 预备磁盘的数量")]),s._v("\n\n            Layout "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" left-symmetric\n        Chunk Size "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" 256K\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# chunk 的区块容量")]),s._v("\n\nConsistency Policy "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" resync\n\n              Name "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" study.centos.mrcode:0  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("local to "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" study.centos.mrcode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n              UUID "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" ba4883f9:75e8224b:6961ac93:d16adbf7\n            Events "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v("\n\n    Number   Major   Minor   RaidDevice State\n       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      active "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sync")]),s._v("   /dev/sda4\n       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("      active "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sync")]),s._v("   /dev/sda5\n       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("      active "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sync")]),s._v("   /dev/sda6\n       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("      active "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sync")]),s._v("   /dev/sda7\n\n       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("        -      spare   /dev/sda8\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 最后的 5 行数据，是目前 5 快磁盘分区的情况，4 个 active sync，1 个 spare")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# RaidDevice 指的是此 RAID 内的磁盘顺序")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br")])]),n("p",[s._v("由于磁盘阵列创建需要一些时间，所以最好等待几分钟再使用该指令 "),n("code",[s._v("mdadm --detail /dev/md0")]),s._v("查看磁盘阵列情况，否则有可能看到某些磁盘正在 "),n("code",[s._v("spare rebuilding")]),s._v(" 之类的提示")]),s._v(" "),n("p",[s._v("通过以上操作，就创建了一个 RAID5 且含有一块 spare disk 的磁盘阵列。")]),s._v(" "),n("p",[s._v("还可以通过如下的文件来查看系统软件磁盘阵列的情况")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /proc/mdstat ")]),s._v("\nPersonalities "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("raid6"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("raid5"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("raid4"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" \nmd0 "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" active raid5 sda7"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" sda8"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("S"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" sda6"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" sda5"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" sda4"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3139584")]),s._v(" blocks super "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.2")]),s._v(" level "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(", 256k chunk, algorithm "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("/4"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("UUUU"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n      \nunused devices: "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[s._v("上述属性信息， md0 的两行信息：")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("第一行：指出 md0 为 raid5，且使用了 sda7、sda6、sda5、sda4 四块磁盘。每个装置后面的中括号中的数字是此磁盘在 RAID 中的顺序（RaidDevice），"),n("code",[s._v("sda8[4](s)")]),s._v(" 中的 s 则代表它为 spare 磁盘")])]),s._v(" "),n("li",[n("p",[s._v("第二行：此磁盘阵列有 3139584 blocks（每个 block 为 1k），所以总容量为 3GB，使用 readi 5 等级，写入磁盘的小区块 chunk 为 256K，使用 algorithm2 磁盘阵列算法。")]),s._v(" "),n("p",[n("code",[s._v("[m/n]")]),s._v(" 表示此数组需要 m 个装置，且 n 个装置正常运行。因此这里 需要 4 个装置且 4 个装置正常运作。")]),s._v(" "),n("p",[n("code",[s._v("[UUUU]")]),s._v(" 表示 4 个所需的装置的启动情况，U 表示运作，若为"),n("code",[s._v("_")]),s._v("则表示不正常")])])]),s._v(" "),n("h3",{attrs:{id:"格式化与挂载使用-raid"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#格式化与挂载使用-raid"}},[s._v("#")]),s._v(" 格式化与挂载使用 RAID")]),s._v(" "),n("p",[s._v("因为涉及到 xfs 文件系统的优化（第 7 章中有讲解到），所以这里参数为：")]),s._v(" "),n("ul",[n("li",[s._v("srtipe（chunk）容量为 256k， su=256k")]),s._v(" "),n("li",[s._v("共有 4 块组成 RAID5，因此容量少一块， sw=3")]),s._v(" "),n("li",[s._v("由上面两项计算出数据宽度为  256K*3=768K")])]),s._v(" "),n("p",[s._v("所以整体要优化这个 XFS 文件系统就是这样：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mkfs.xfs -f -d su=256k,sw=3 -r extsize=768k /dev/md0")]),s._v("\nmeta-data"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/dev/md0               "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("isize")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("512")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("agcount")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(", "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("agsize")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("98048")]),s._v(" blks\n         "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("                       "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("sectsz")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("512")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("attr")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(", "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("projid32bit")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n         "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("                       "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("crc")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("finobt")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(", "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("sparse")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\ndata     "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("                       "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("bsize")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("blocks")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("784384")]),s._v(", "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("imaxpct")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v("\n         "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("                       "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("sunit")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v("     "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("swidth")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192")]),s._v(" blks\nnaming   "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("version "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("              "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("bsize")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v("   ascii-ci"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ftype")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nlog      "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("internal log           "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("bsize")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("blocks")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2560")]),s._v(", "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("version")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n         "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("                       "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("sectsz")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("512")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("sunit")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" blks, lazy-count"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nrealtime "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("none                   "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("extsz")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("786432")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("blocks")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(", "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("rtextents")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 给该装置挂载到 /srv/raid 目录")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mkdir /srv/raid")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mount /dev/md0 /srv/raid/")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# df -Th /srv/raid/")]),s._v("\n文件系统       类型  容量  已用  可用 已用% 挂载点\n/dev/md0       xfs   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".0G   33M  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".0G    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("% /srv/raid\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 就看到多了一个 /dev/md0 的挂载装置了")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br")])]),n("h2",{attrs:{id:"仿真-raid-错误的救援模式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#仿真-raid-错误的救援模式"}},[s._v("#")]),s._v(" 仿真 RAID 错误的救援模式")]),s._v(" "),n("p",[s._v("万一磁盘阵列内的装置异常了，要怎么进行救援，下面进行仿真实践")]),s._v(" "),n("h3",{attrs:{id:"语法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#语法"}},[s._v("#")]),s._v(" 语法")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mdadm 救援方面的语法")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mdadm")]),s._v(" --manage /dev/md"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("-9"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("--add 装置"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("--remove 装置"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("--fail 装置"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n选项与参数：\n\t--add：将装置加入到该 md 中\n\t--remove：将装置从该 md 中移除\n\t--fail：将某个装置设置为出错状态\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("h3",{attrs:{id:"设置磁盘为错误"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#设置磁盘为错误"}},[s._v("#")]),s._v(" 设置磁盘为错误")]),s._v(" "),n("p",[s._v("让一块磁盘变成错误，然后让 spare disk 自动开始重建")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 先复制一点数据到磁盘阵列中")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cp -a /etc /var/log/ /srv/raid/")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# df -Th /srv/raid/")]),s._v("\nFilesystem     Type  Size  Used Avail Use% Mounted on\n/dev/md0       xfs   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".0G  121M  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".9G   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("% /srv/raid\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# du -sm /srv/raid/*")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("42")]),s._v("      /srv/raid/etc\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("45")]),s._v("      /srv/raid/log\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 已经复制过来文件了，并且依据看到使用量了")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1. 假设 /dev/sda6 这个磁盘出问题了，模拟方式如下")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mdadm --manage /dev/md0  --fail /dev/sda6")]),s._v("\nmdadm: "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" /dev/sda6 faulty "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" /dev/md0\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看状态")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mdadm --detail /dev/md0")]),s._v("\n/dev/md0:\n           Version "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.2")]),s._v("\n     Creation Time "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" Sat Feb "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v(" 06:13:57 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("\n        Raid Level "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" raid5\n        Array Size "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3139584")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.99")]),s._v(" GiB "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.21")]),s._v(" GB"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n     Used Dev Size "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1046528")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1022.00")]),s._v(" MiB "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1071.64")]),s._v(" MB"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n      Raid Devices "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\n     Total Devices "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n       Persistence "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" Superblock is persistent\n\n       Update Time "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" Sat Feb "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v(" 07:57:44 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("\n             State "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" clean \n    Active Devices "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\n   Working Devices "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\n    Failed Devices "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\t\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#出错的有一个")]),s._v("\n     Spare Devices "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\n            Layout "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" left-symmetric\n        Chunk Size "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" 256K\n\nConsistency Policy "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" resync\n\n              Name "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" study.centos.mrcode:0  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("local to "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" study.centos.mrcode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n              UUID "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" ba4883f9:75e8224b:6961ac93:d16adbf7\n            Events "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("37")]),s._v("\n\n    Number   Major   Minor   RaidDevice State\n       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      active "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sync")]),s._v("   /dev/sda4\n       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("      active "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sync")]),s._v("   /dev/sda5\n       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("      active "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sync")]),s._v("   /dev/sda8\n       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("      active "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sync")]),s._v("   /dev/sda7\n\n       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("        -      faulty   /dev/sda6\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这里 sda6 死掉了，我这里查看信息慢了点，没有看到 state 为 spare rebuilding 状态的信息")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 前面通过  cat /proc/mdstat  看到的是 sda8 是 spare 磁盘，这里已经变成 磁盘整理里面的磁盘了")]),s._v("\n\nPersonalities "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("raid6"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("raid5"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("raid4"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" \nmd0 "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" active raid5 sda7"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" sda8"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" sda6"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("F"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" sda5"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" sda4"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3139584")]),s._v(" blocks super "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.2")]),s._v(" level "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(", 256k chunk, algorithm "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("/4"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("UUUU"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n      \nunused devices: "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可以看到 sda6 死掉了。变成了 F")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br")])]),n("h3",{attrs:{id:"将出错的磁盘移除并加入新磁盘"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#将出错的磁盘移除并加入新磁盘"}},[s._v("#")]),s._v(" 将出错的磁盘移除并加入新磁盘")]),s._v(" "),n("p",[s._v("这里由于是让 sda6 模拟出错，如果是真实的盘要替换，也是如下的流程：")]),s._v(" "),n("ol",[n("li",[n("p",[s._v("从 "),n("code",[s._v("/dev/md0")]),s._v(" 数组中移除  "),n("code",[s._v("/dev/sda6")]),s._v(" 磁盘")])]),s._v(" "),n("li",[n("p",[s._v("整个 Linux 系统关机，拔出 sda6 这块磁盘，并安装上新的 "),n("code",[s._v("/dev/sda6")]),s._v(" 磁盘，之后开机")])]),s._v(" "),n("li",[n("p",[s._v("将新的 "),n("code",[s._v("/dev/sda6")]),s._v(" 放入 "),n("code",[s._v("/dev/md0")]),s._v(" 数组中")])]),s._v(" "),n("li",[n("p",[s._v("拔出旧的  sda6 磁盘")])])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这里我手误写成了 sda7 ,会提示在使用中的不能移除")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mdadm --manage /dev/md0 --remove /dev/sda7")]),s._v("\nmdadm: hot remove failed "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" /dev/sda7: Device or resource busy\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这里就正常了")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mdadm --manage /dev/md0 --remove /dev/sda6")]),s._v("\nmdadm: hot removed /dev/sda6 from /dev/md0\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mdadm --detail /dev/md0")]),s._v("\n    Number   Major   Minor   RaidDevice State\n       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      active "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sync")]),s._v("   /dev/sda4\n       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("      active "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sync")]),s._v("   /dev/sda5\n       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("      active "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sync")]),s._v("   /dev/sda8\n       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("      active "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sync")]),s._v("   /dev/sda7\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sda6 被移除了")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("ol",{attrs:{start:"5"}},[n("li",[s._v("安装新的 "),n("code",[s._v("/dev/sda6")]),s._v(" 磁盘")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mdadm --manage /dev/md0 --add /dev/sda6")]),s._v("\nmdadm: added /dev/sda6\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mdadm --detail /dev/md0")]),s._v("\n\n   Number   Major   Minor   RaidDevice State\n       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      active "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sync")]),s._v("   /dev/sda4\n       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("      active "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sync")]),s._v("   /dev/sda5\n       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("      active "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sync")]),s._v("   /dev/sda8\n       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("      active "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sync")]),s._v("   /dev/sda7\n\n       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("        -      spare   /dev/sda6\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("p",[s._v("如果你的系统支持磁盘热插拨，还不需要关机，就能完成这里的操作，可以说是不停机完成维护，很强")]),s._v(" "),n("h2",{attrs:{id:"开机自动启动-raid-并自动挂载"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#开机自动启动-raid-并自动挂载"}},[s._v("#")]),s._v(" 开机自动启动 RAID 并自动挂载")]),s._v(" "),n("p",[s._v("新版 distribution 可能会自动搜索 "),n("code",[s._v("/dev/md[0-9]")]),s._v(" 开机时设置好所需要的功能建议还是通过配置文件配置。")]),s._v(" "),n("p",[n("code",[s._v("/etc/mdadm.conf")]),s._v(" 是 RAID 的配置文件。只要知道 "),n("code",[s._v("/dev/md0")]),s._v(" 的 UUID 就可以完成配置")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mdadm --detail /dev/md0 | grep -i uuid")]),s._v("\n              UUID "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" ba4883f9:75e8224b:6961ac93:d16adbf7\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# UUID 是想系统注册的 UUID 标识")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置 mdadm.conf")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /etc/mdadm.conf")]),s._v("\nARRAY /dev/md0 "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("UUID")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ba4883f9:75e8224b:6961ac93:d16adbf7\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# \t\tRAID 装置\tUUID")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置开机自动挂载并测试")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# blkid /dev/md0")]),s._v("\n/dev/md0: "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("UUID")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"319f3d68-a144-4d9a-9a83-c83b4a26b98f"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("TYPE")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xfs"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /etc/fstab")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# UUID=319f3d68-a144-4d9a-9a83-c83b4a26b98f       /srv/raid       xfs     0 0 ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("UUID")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("319f3d68-a144-4d9a-9a83-c83b4a26b98f /srv/raid     xfs     defaults        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 记得上述一定要仔细，这里卸载后，再挂载就提示有问题，检查后发现，少了一个 defaults 项")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 否则直接重启的话，有可能就启动不了了")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# umount /dev/md0; mount -a")]),s._v("\nmount: wrong fs type, bad option, bad superblock on /dev/md0,\n       missing codepage or helper program, or other error\n\n       In some cases useful info is found "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" syslog - try\n       "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("dmesg")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tail")]),s._v(" or so.\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改后就正常了")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# umount /dev/md0")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mount -a")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# df -Th /srv/raid/")]),s._v("\nFilesystem     Type  Size  Used Avail Use% Mounted on\n/dev/md0       xfs   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".0G  121M  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".9G   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("% /srv/raid\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# reboot \t# 重启后，再查看是否自动挂载了")]),s._v("\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br")])]),n("h2",{attrs:{id:"关闭软件-raid（重要）"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#关闭软件-raid（重要）"}},[s._v("#")]),s._v(" 关闭软件 RAID（重要）")]),s._v(" "),n("p",[s._v("除非你未来要使用这块  software RAID 的 /dev/md0；否则请关闭它")]),s._v(" "),n("p",[s._v("因为：因为这是练习机，后续不会用，另外，它使用了 "),n("code",[s._v("/dev/sda{4,5,6,7,8}")]),s._v(" 分区，如果只是将 "),n("code",[s._v("/dev/md0")]),s._v(" 卸载，然后忘记关闭 RAID，结果就是在重新分区 "),n("code",[s._v("/dev/sdaX")]),s._v(" 时可能会出现一些莫名其妙的错误")]),s._v(" "),n("p",[s._v("关闭步骤如下")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1. 卸载且删除配置文件与这个 /dev/md0 有关的设置")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# umount /srv/raid/")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /etc/fstab ")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2. 覆盖掉 RAID 的 metadata 以及 XFS 的 superblock，再关闭 /dev/md0")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# dd if=/dev/zero of=/dev/md0 bs=1M count=50")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这一步很危险；笔者刚刚发现执行 stop,提示找不到 /dev/md0")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 找到问题是在 vim /etc/mdadm.conf 中 ARRAY 写错了，导致开机没有加载")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 然后修改之后，把 fstab 中增加上，再重启，就开不了机了，本想是重试这里的正常卸载")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 谁知道，上面吧  /dev/md0 数据擦除了，导致启动不了系统")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 后来想到前面讲解过怎么进入救援模式，再编辑 fstab 文件，去掉对 /dev/md0 的挂载配置，就好了")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启后，在执行下面的指令就正常了")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mdadm --stop /dev/md0")]),s._v("\nmdadm:stopped /dev/md0\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /proc/mdstat ")]),s._v("\nPersonalities "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("raid6"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("raid5"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("raid4"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" \nunused devices: "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 不存在任何数组装置")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在去掉这里的配置就可以了")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /etc/mdadm.conf ")]),s._v("\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br")])]),n("p",[s._v("上面使用 dd 是因为 RAID 的相关数据会存一份在磁盘中，如果只是把配置文件去掉了，但是分区槽没有重新规划过，那么重启后，系统还是会将这块磁盘阵列建立起来，只是名称可能会改变成 "),n("code",[s._v("/dev/md127")])]),s._v(" "),n("p",[s._v("所以，记得上述的步骤，但是不要错误的 dd 到了其他磁盘，这个很严重的")])])}),[],!1,null,null,null);t.default=e.exports}}]);