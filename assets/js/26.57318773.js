(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{508:function(s,t,e){s.exports=e.p+"assets/img/image-20200401114254117.07115526.png"},509:function(s,t,e){s.exports=e.p+"assets/img/image-20200401131409238.dd5e4167.png"},664:function(s,t,e){"use strict";e.r(t);var n=e(16),a=Object(n.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"开机过程的问题解决"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#开机过程的问题解决"}},[s._v("#")]),s._v(" 开机过程的问题解决")]),s._v(" "),n("p",[s._v("很多时候，可能要我做了某些设置，或不正常关机，而导致系统的 filesystem 错乱，因此 Linux 可能无法顺利开机，可以先尝试进入 rescue 模式去处理，下面讲解几个常见的问题")]),s._v(" "),n("h2",{attrs:{id:"忘记-root-密码"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#忘记-root-密码"}},[s._v("#")]),s._v(" 忘记 root 密码")]),s._v(" "),n("p",[s._v("原理是：只要能挂载到原来的根目录，就可以重新设置下 root 密码")]),s._v(" "),n("p",[s._v("在新版的 systemd 的管理机制中，默认的 rescue 模式无法直接取得 root 权限，还是需要使用 root 密码才能进入 rescure 环境，可以通过 "),n("code",[s._v("rd.break")]),s._v(" 的核心参数来处理")]),s._v(" "),n("p",[n("code",[s._v("rd.break")]),s._v(" 是在 Ram Disk 里的操作系统状态，因此不能直接取得原本的 Linux 系统操作环境，所以还是需要 chroot 的支持，至于 SELinux 的问题，可能还要加上某些特殊的流程才能顺利的搞定 root 密码的救援")]),s._v(" "),n("p",[s._v("开机进入选单编辑模式，如下图")]),s._v(" "),n("p",[n("img",{attrs:{src:e(508),alt:"image-20200401114254117"}})]),s._v(" "),n("p",[s._v("按 ctrl + x 重启后，开机画面会出现如下类似的画面，这应该是在 RAM Disk 的环境，并不是原本的环境，因此根目录下的数据与你原本的系统无关，而且你的系统应该会被挂载到 "),n("code",[s._v("/sysroot")]),s._v(" 目录下，需要这样操作")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("Generating "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/run/initramfs/rdsosreport.txt"')]),s._v("\n\nEnter emergency mode. Exit the shell to continue.\nType "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"journalctl"')]),s._v(" to view system logs.\nYou might want to save "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/run/initramfs/rdsosreport.txt"')]),s._v(" to a USB stick or /boot\nafter mounting them and attach it to a bug report.\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 无需输入密码就取得了 root 权限")]),s._v("\nswitch_root:/"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 检查挂载点")]),s._v("\nswitch_root:/"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mount")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n/dev/mapper/centos-root on /sysroot "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v(" xfs "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ro,relatime,attr,inode64,noquo\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这里的权限是 ro? 不能写入，只可以读，重新挂载成可读写的")]),s._v("\nswitch_root:/"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mount -o remount,rw /sysroot")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 切回原本的系统环境")]),s._v("\nswitch_root:/"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# chroot /sysroot")]),s._v("\n\nsh-4.2"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# echo "你的新密码" | passwd --stdin root')]),s._v("\nsh-4.2"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# touch /.autorelabel\t\t# 很重要，变回 SELinux 的安全本文")]),s._v("\nsh-4.2"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# exit")]),s._v("\n\nswitch_root:/"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# reboot")]),s._v("\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br")])]),n("p",[s._v("下面进行疑问解释：")]),s._v(" "),n("ul",[n("li",[n("p",[n("code",[s._v("chroot 目录")]),s._v("：")]),s._v(" "),n("p",[s._v("表示将你的根目录「暂时」切换到 指定的目录。上面的 "),n("code",[s._v("sysroot")]),s._v(" 目录我们知道是原本的系统根目录，所以就可以处理了")])]),s._v(" "),n("li",[n("p",[s._v("为何需要 "),n("code",[s._v(".autorelabel")])]),s._v(" "),n("p",[s._v("在 "),n("code",[s._v("rd.break")]),s._v(" 的 RAM Disk 环境下，系统是没有 SELinux 的，而刚刚更改了 "),n("code",[s._v("/etc/shadow")]),s._v(" （更改密码导致），所以这个文件的 SELinux 安全本文的特性将会被取消，如果没有让系统再开机时自动恢复 SELinux 的安全本文，将产生无法登陆的问题（在SELinux 为 Enforcing 的模式下）。使用 "),n("code",[s._v("/.autorelabel")]),s._v("  表示让系统再开机时自动使用预设的 SELinux type 重新写入 SELinux 安全本文到每个文件上去")])])]),s._v(" "),n("p",[s._v("由于 "),n("code",[s._v("/.autorelabel")]),s._v(" 开机恢复需要不少时间，还可以使用如下方式")]),s._v(" "),n("ul",[n("li",[s._v("在 rd.break 模式下，修改完 root 密码后， 将 "),n("code",[s._v("/etc/selinux/config")]),s._v("  内的 SELinux 类型改为 permissive")]),s._v(" "),n("li",[s._v("重新启动后，使用 root 身份下达 "),n("code",[s._v("restorecon -Rv /etc")]),s._v(" 仅修改 /etc 下的文件")]),s._v(" "),n("li",[s._v("重新修改 "),n("code",[s._v("/etc/selinux/config")]),s._v(" 内的 SELinux 类型为 enforcing，然后执行 "),n("code",[s._v("setenfore")]),s._v(" 即可")])]),s._v(" "),n("h2",{attrs:{id:"开机直接以-root-执行-bash-的方法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#开机直接以-root-执行-bash-的方法"}},[s._v("#")]),s._v(" 开机直接以 root 执行 bash 的方法")]),s._v(" "),n("p",[s._v("还可以直接开机取得系统根目录后，让系统直接给我们一个 bash。")]),s._v(" "),n("p",[s._v("配置方法同样是在 linux 哪一行添加参数，不用  rd.break，而是使用 "),n("code",[s._v("init=/bin/bash")]),s._v("，同样不需要 root 密码就可以获取到 root 权限")]),s._v(" "),n("p",[s._v("该 bash 无法完整的操作系统，这个原理是将 PID=1 的第一个程序改为了 bash，所以最多还是用在救援方面。同样需要 remount 根目录才可以")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 直接就在根目录，所以只需要改成写模式就可以了，后续流程和上面的一样")]),s._v("\nswitch_root:/"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mount -o remount,rw /")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("h2",{attrs:{id:"因文件系统错误而无法开机"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#因文件系统错误而无法开机"}},[s._v("#")]),s._v(" 因文件系统错误而无法开机")]),s._v(" "),n("p",[s._v("如果因为设置错误导致无法开机时，就更简单了，通常设置错误导致无法开机的文件是 "),n("code",[s._v("/etc/fstab")]),s._v(" 文件，修改完成后，又没有通过  "),n("code",[s._v("mount -a")]),s._v("  来测试就重启系统了，那么就无法开机成功了，这种情况的问题大多数为下图所示")]),s._v(" "),n("p",[n("img",{attrs:{src:e(509),alt:"image-20200401131409238"}})]),s._v(" "),n("p",[s._v("提示输入 root 密码进入救援，之后重新挂载写模式 "),n("code",[s._v("mount -o remount,rw /")]),s._v("，就可以编辑错误的设置了")]),s._v(" "),n("p",[s._v("如果是因为不正常关机后，导致文件系统不一致（Inconsistend）的情况，也可能出现相同的问题，如果是扇区错乱的情况，请看上图第 2 行，fsck 告知是 "),n("code",[s._v("/dev/md0")]),s._v(" 错误，此时你应该利用 fsck.ext3 去检测 "),n("code",[s._v("/dev/md0")]),s._v(" 才是，等到系统发现错误，并且出现 "),n("code",[s._v("clear[Y/N]")]),s._v(" 时，输入 Y 尝试恢复")]),s._v(" "),n("p",[s._v("如果是 XFS 文件系统的话，可能需要使用  xfs_repair 指令来处理，"),n("code",[s._v("fsck/xfs_repair")]),s._v(" 的处理过程可能会很长，如果你的 partition 上的 filesystem 有过多的数据顺坏时即使 "),n("code",[s._v("fsck/xfs_repair")]),s._v(" 完成后，可能因为损坏了系统槽，导致某些关键系统文件数据的损坏，那么依旧是无法进入 Linux 的。此时就只能将系统中重要的数据复制出来，然后重新安装，并且检验下是否是实体硬盘有损坏的现象")])])}),[],!1,null,null,null);t.default=a.exports}}]);