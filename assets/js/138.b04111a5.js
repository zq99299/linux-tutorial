(window.webpackJsonp=window.webpackJsonp||[]).push([[138],{645:function(s,t,a){"use strict";a.r(t);var n=a(16),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"systemctl-针对-service-类型的配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#systemctl-针对-service-类型的配置"}},[s._v("#")]),s._v(" systemctl 针对 service 类型的配置")]),s._v(" "),a("p",[s._v("以前需要建立系统服务，需要在 "),a("code",[s._v("/etc/init.d/")]),s._v(" 创建对应的 bash shell script 来处理，如今在 systemd 环境下，该怎么设置相关的服务启动环境？")]),s._v(" "),a("h2",{attrs:{id:"配置文件相关目录简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置文件相关目录简介"}},[s._v("#")]),s._v(" 配置文件相关目录简介")]),s._v(" "),a("p",[s._v("systemd 的配置文件大部分在 "),a("code",[s._v("/usr/lib/systemd/system/")]),s._v(" 目录内，Red Hat 官方文件指出，该目录的文件主要是原本软件所提供的设置，建议不要修改。修改的位置在 "),a("code",[s._v("/etc/systemd/system/")]),s._v(" 目录内")]),s._v(" "),a("p",[s._v("比如：想要额外修改  vsftpd.service ，建议放到的位置如下：")]),s._v(" "),a("ul",[a("li",[a("p",[a("code",[s._v("/usr/lib/systemd/vsftpd.service")]),s._v(" ：官方的预设配置文件")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("/etc/systemd/system/vsftp.service.d/custom.conf")]),s._v("：")]),s._v(" "),a("p",[s._v("建立同名并已 "),a("code",[s._v(".d")]),s._v(" 后缀结尾的目录，该目录下的文件会「累加其他设置」进入 "),a("code",[s._v("/usr/lib/systemd/vsftpd.service")])]),s._v(" "),a("p",[s._v("意思应该是：这里是配置会覆盖掉 "),a("code",[s._v("/usr/lib/systemd/vsftpd.service")]),s._v(" 中的同名配置")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("/etc/systemd/system/vsftpd.service.wants/*")])]),s._v(" "),a("p",[s._v("此目录内的文件为链接文件，设置相依服务的链接。作用是启动了 vsftpd.service 后，最好再加上该目录下的建议服务")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("/etc/systemd/system/vsftpd.service.requires/*")])]),s._v(" "),a("p",[s._v("此目录内的文件为链接文件，设置相依服务的链接。作用是，在启动 vsftpd.service 之前，需要事先启动哪些服务")])])]),s._v(" "),a("p",[s._v("基本上在配置文件中，你可以自由设置相依服务的检查，并且设置加入到哪些 target 里。就是建议不要修改原始的配置文件，在上述建议目录下去操作修改")]),s._v(" "),a("h2",{attrs:{id:"配置文件的设置项目简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置文件的设置项目简介"}},[s._v("#")]),s._v(" 配置文件的设置项目简介")]),s._v(" "),a("p",[s._v("这次通过 sshd.service 的配置文件来讲解配置文件的内容")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /usr/lib/systemd/system/sshd.service")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Unit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Description")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("OpenSSH server daemon\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Documentation")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("man:sshd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" man:sshd_config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("After")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("network.target sshd-keygen.service\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Wants")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("sshd-keygen.service\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Service"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 该项目于实际执行的指令参数有关")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("notify\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("EnvironmentFile")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/sysconfig/sshd\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStart")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/sbin/sshd -D "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$OPTIONS")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecReload")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/bin/kill -HUP "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$MAINPID")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("KillMode")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("process\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Restart")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("on-failure\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("RestartSec")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("42s\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Install"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 此 unit 要挂载到哪个 target 下")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("WantedBy")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("multi-user.target\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("p",[s._v("分析上述文件，大概分为三个部分：")]),s._v(" "),a("ul",[a("li",[a("p",[a("code",[s._v("[Unit]")])]),s._v(" "),a("p",[s._v("unit 本身的说明，以及其他相依 daemon 的设置，包括在什么服务之后才启动此 unit 之类的设置")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("[Service]、[Socket][Timer][Mount][Path]...")])]),s._v(" "),a("p",[s._v("不同的 unit type 需要使用对应的设置项目。对于 service 来说，主要在规范服务启动脚本、环境配置文件名、重新启动的方式等")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("[Install]")]),s._v("：将此 unit 安装到哪个 target 里面")])])]),s._v(" "),a("p",[s._v("配置文件内有些设置规则如下：")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("设置项目通常是可以重复的")]),s._v(" "),a("p",[s._v("例如可以设置两个 After 在配置文件中，不过，后面的设置会取代前面的，可以使用 "),a("code",[s._v("After=")]),s._v("  的方式，将该项清空归零")])]),s._v(" "),a("li",[a("p",[s._v("如果设置参数需要有「是/否 boolean 类型值」的项目，可以使用 1、yes、true、on 代表启动，0、no、false、off 代表关闭")])]),s._v(" "),a("li",[a("p",[s._v("空白行、开头为 "),a("code",[s._v("#")]),s._v(" 或 "),a("code",[s._v(";")]),s._v(" 都表示批注信息")])])]),s._v(" "),a("p",[s._v("每个部分的说明如下：")]),s._v(" "),a("h3",{attrs:{id:"unit-部分"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#unit-部分"}},[s._v("#")]),s._v(" "),a("code",[s._v("[unit]")]),s._v(" 部分")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("Description")]),s._v(" "),a("p",[s._v("使用 systemctl list-units 时，展示出来的简易说明。systemctl status 中输出的服务说明也是该值")])]),s._v(" "),a("li",[a("p",[s._v("Documentation")]),s._v(" "),a("p",[s._v("提供管理员能够进一步的文件查询功能，提供的文件可以是如下的资料")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("=http://www..")])]),s._v(" "),a("li",[a("code",[s._v("=man:sshd(8)")])]),s._v(" "),a("li",[a("code",[s._v("=file:/etc/ssh/sshd_config")])])])]),s._v(" "),a("li",[a("p",[s._v("After：说明此 unit 是在哪个 daemon 启动之后才能启动。")]),s._v(" "),a("p",[s._v("基本上仅是说明启动顺序，并无强制要求里面的服务一定要启动后此 unit 才能启动。它与 Requires 的设置含义是有差异的。")])]),s._v(" "),a("li",[a("p",[s._v("Before：在什么服务启动前，启动本服务")]),s._v(" "),a("p",[s._v("同样，并非强制性的")])]),s._v(" "),a("li",[a("p",[s._v("Rrquires：相依性配置")]),s._v(" "),a("p",[s._v("明确定义此 unit 需要在哪个 daemon 启动后才能启动。如果依赖的服务没有启动，则该服务不会被启动")])]),s._v(" "),a("li",[a("p",[s._v("Wants：")]),s._v(" "),a("p",[s._v("此 unit 启动之后，还需要启动哪些服务。不是强制性的，只是希望建立让使用者比较好的操作环境")])]),s._v(" "),a("li",[a("p",[s._v("Conflicts：冲突服务")]),s._v(" "),a("p",[s._v("如果这里申明的服务已经启动，那么本 unit 就不能启动。如果我们的 unit 有启动，那么这里定义的服务不能启动。")])])]),s._v(" "),a("h3",{attrs:{id:"service-部分"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#service-部分"}},[s._v("#")]),s._v(" "),a("code",[s._v("[service]")]),s._v(" 部分")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("Type：启动方式，会影响到 ExecStart。一般有如下几种")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("simple：默认值，主要由 ExecStart 定义的指令串来启动，启动后常驻于内存中")])]),s._v(" "),a("li",[a("p",[s._v("forking：")]),s._v(" "),a("p",[s._v("由 ExecStart 启动的程序通过 spawns 延伸出其他子程序来作为此 daemon 的主要服务。原生的父程序在启动结束后就会终止运行。传统的 unit 服务大多属于这种项目。")]),s._v(" "),a("p",[s._v("例如：httpd 这个 www 服务，当 httpd 的程序因为运行过久因此即将终结了，则 systemd 会再重新生出另一个子程序持续运行后，再将父程序删除。据说这样的效率比较好")])]),s._v(" "),a("li",[a("p",[s._v("oneshot：与 simple 类似，不过该程序工作完毕后就结束了，不会常驻内存中")])]),s._v(" "),a("li",[a("p",[s._v("dbus：与 simple 类似，但是这个 daemon 必须要在取得一个 D-Bus 的名称后，才会继续运行，因此设置该项目时，通常也要设置 BusName 才行")])]),s._v(" "),a("li",[a("p",[s._v("idle：与 simple 类似，要执行这个 daemon 必须要所有的工作都顺利执行完成后，才会执行，这里的 daemon 通常是开机到最后才执行的服务")])])]),s._v(" "),a("p",[s._v("比较重要的 simple、forking 与 oneshot，很多服务需要子程序 forking，还有很多服务只需要在开机的时候执行一次 oneshot")])]),s._v(" "),a("li",[a("p",[s._v("EnvironmentFile：指定启动脚本的环境配置文件")]),s._v(" "),a("p",[s._v("例如：sshd.service 的配置文件写入到 "),a("code",[s._v("/etc/sysconfig/sshd")]),s._v(" 中，也可以直接在该项后面用多个不同的 Shell 变量来设置")])]),s._v(" "),a("li",[a("p",[s._v("ExecStart：实际执行此 daemon 的指令或脚本程序")]),s._v(" "),a("p",[s._v("也可以使用 ExecStartPre（之前） 以及 ExecStartPost（之后）在实际启动服务前后进行额外的指令行为。但是仅支持「指令 参数 参数...」格式，不能接受 "),a("code",[s._v("< > >> | &")]),s._v(" 等特殊字符，很多 bash 语法也不支持，如果需要这些特殊字符的时候，最好直接写到指令脚本里面。还有一种方式可以支持完整的语法；将 Type=oneshot 就可以了")])]),s._v(" "),a("li",[a("p",[s._v("ExecStop：与 systemctl stop 的执行有关，关闭此服务时所执行的指令")])]),s._v(" "),a("li",[a("p",[s._v("ExecReload：与 systemctl reload 有关的指令行为")])]),s._v(" "),a("li",[a("p",[s._v("Restart：")]),s._v(" "),a("p",[s._v("当设置 Restart=1 时，当此 daemon 服务终止后，会再次启动该服务")]),s._v(" "),a("p",[s._v("除非使用 systemctl 强制将此服务关闭，否则该功能会一直生效")])]),s._v(" "),a("li",[a("p",[s._v("RemainAfterExit")]),s._v(" "),a("p",[s._v("当值设置为 1 时， 当该 daemon 所属的所有程序都终止后，此服务会再尝试启动。这对于 Type=oneshot 的服务有帮助")])]),s._v(" "),a("li",[a("p",[s._v("TimeoutSec：若这个服务在启动或是关闭时，因为某些缘故导致无法顺利「正常启动或正常结束」的情况下，则需要等待多久才进入「强制结束」的状态")])]),s._v(" "),a("li",[a("p",[s._v("KillMode")]),s._v(" "),a("p",[s._v("可以是 process、control-group、none 其中的一种：")]),s._v(" "),a("ul",[a("li",[s._v("process：终止时，只会终止主要的程序（ExecStart 后面指令串启动的）")]),s._v(" "),a("li",[s._v("control-group：则由此 daemon 所产生的其他 control-group 的程序，也会被关闭")]),s._v(" "),a("li",[s._v("one：没有程序会被关闭")])])]),s._v(" "),a("li",[a("p",[s._v("RestartSec：")]),s._v(" "),a("p",[s._v("与 Restart 有相关性，如果该服务被关闭，需要重新启动时，大概要 sleep 多少时间再重新启动。预设是 100ms")])])]),s._v(" "),a("h3",{attrs:{id:"install-部分"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#install-部分"}},[s._v("#")]),s._v(" "),a("code",[s._v("[Install]")]),s._v(" 部分")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("WantedBy：该 unit 本身是附挂在哪一个 target unit 下")]),s._v(" "),a("p",[s._v("该项设置大部分都是 "),a("code",[s._v("*.target unit")]),s._v(" 。大多数服务性质的 unit 都是附挂在 multi-user.target 下")])]),s._v(" "),a("li",[a("p",[s._v("Also：相依性 enable")]),s._v(" "),a("p",[s._v("当前 unit 本身被 enable 时，Also 声明的 unit 也 enable")])]),s._v(" "),a("li",[a("p",[s._v("Alias：别名")]),s._v(" "),a("p",[s._v("当 systemctl enable 相关的服务时，此服务会进行连接文件的建立，以 "),a("code",[s._v("multi-user.target")]),s._v(" 为例，它是用来预设操作环境 default.target 的规划，因此当设置用 default.target 时， "),a("code",[s._v("/etc/systed/system/default.target")]),s._v(" 就会连结到 "),a("code",[s._v("/usr/lib/systemd/system/multi-user.target")])])])]),s._v(" "),a("p",[s._v("配置讲解之后，下面用这些知识点来练习")]),s._v(" "),a("h2",{attrs:{id:"两个-vsftpd-运行的实例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#两个-vsftpd-运行的实例"}},[s._v("#")]),s._v(" 两个 vsftpd 运行的实例")]),s._v(" "),a("p",[s._v("在上一章将 vsftpd 的 port 修改成了 555。这里再运行一个端口为 21 的 vsftpd 程序，需要两个配置文件以及两个启动脚本来设置了：")]),s._v(" "),a("ul",[a("li",[s._v("port 21:\n"),a("ul",[a("li",[a("code",[s._v("/etc/vsftpd/vsftpd.conf")]),s._v(" 配置文件")]),s._v(" "),a("li",[a("code",[s._v("/usr/lib/systemd/system/vsftpd.service")]),s._v(" 启动脚本")])])]),s._v(" "),a("li",[s._v("port 555:\n"),a("ul",[a("li",[a("code",[s._v("/etc/vsftpd/vsftpd2.conf")]),s._v(" 配置文件")]),s._v(" "),a("li",[a("code",[s._v("/usr/lib/systemd/system/vsftpd2.service")]),s._v(" 启动脚本")])])])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1. 建立好需要的配置文件")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd /etc/vsftpd/")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study vsftpd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll")]),s._v("\ntotal "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("\n-rw-------. "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("125")]),s._v(" Oct "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v(" ftpusers\n-rw-------. "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("361")]),s._v(" Mar "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(":59 user_list\n-rw-------. "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5199")]),s._v(" Mar "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":02 vsftpd.conf\n-rwxr--r--. "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("338")]),s._v(" Oct "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v(" vsftpd_conf_migrate.sh\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study vsftpd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cp vsftpd.conf vsftpd2.conf")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study vsftpd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim vsftpd.conf")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# listen_port=555")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 把端口注释掉，他默认的端口是 21.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study vsftpd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# diff vsftpd.conf vsftpd2.conf")]),s._v("\n131c131\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# listen_port=555")]),s._v("\n---\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("listen_port")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("555")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 通过对比，两个文件只有端口号不同")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2. 开始处理启动脚本设置")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study vsftpd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd /etc/systemd/system/")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study system"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll | grep vsftp")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 由于我们没有额外修改过启动脚本，所以该目录下是没有 vsftp 相关的脚本的")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从原始的启动脚本目录复制一份过来")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study system"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cp /usr/lib/systemd/system/vsftpd.service vsftpd2.service")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study system"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim vsftpd2.service")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Unit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Description")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Vsftpd2 "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ftp")]),s._v(" daemon\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("After")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("network.target\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Service"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("forking\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStart")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/sbin/vsftpd /etc/vsftpd/vsftpd2.conf\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Install"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("WantedBy")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("multi-user.target\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重点只是修改 ExecStart 后面的配置文件")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 3. 重新加载 systemd 的脚本配置文件内容")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl daemon-reload")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study system"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl list-unit-files --all | grep vsftpd")]),s._v("\nvsftpd.service                                enabled\nvsftpd2.service                               disabled\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 已经能找到了")]),s._v("\nvsftpd@.service                               disabled\nvsftpd.target                                 disabled\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study system"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl status vsftpd2.service")]),s._v("\n* vsftpd2.service - Vsftpd2 "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ftp")]),s._v(" daemon\n   Loaded: loaded "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/etc/systemd/system/vsftpd2.service"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" disabled"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" vendor preset: disabled"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n   Active: inactive "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("dead"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 由于之前直接修改的 vsftp 的配置文件，所以 vsftp 也需要重新启动")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study system"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl restart vsftpd.service vsftpd2.service")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study system"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl enable vsftpd.service vsftpd2.service")]),s._v("\nCreated symlink from /etc/systemd/system/multi-user.target.wants/vsftpd2.service to /etc/systemd/system/vsftpd2.service.\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study system"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl status vsftpd.service vsftpd2.service")]),s._v("\n* vsftpd.service - Vsftpd "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ftp")]),s._v(" daemon\n   Loaded: loaded "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/usr/lib/systemd/system/vsftpd.service"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" enabled"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" vendor preset: disabled"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n   Active: active "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("running"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" since Thu "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-03-19 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":50:22 CST"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" 27s ago\n Main PID: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5986")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("vsftpd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n   CGroup: /system.slice/vsftpd.service\n           "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("-5986 /usr/sbin/vsftpd /etc/vsftpd/vsftpd.conf\n\nMar "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":50:22 study.centos.mrcode systemd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": Stopped Vsftpd "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ftp")]),s._v(" daemon.\nMar "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":50:22 study.centos.mrcode systemd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": Starting Vsftpd "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ftp")]),s._v(" daemon"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nMar "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":50:22 study.centos.mrcode systemd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": Started Vsftpd "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ftp")]),s._v(" daemon.\n\n* vsftpd2.service - Vsftpd2 "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ftp")]),s._v(" daemon\n   Loaded: loaded "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/etc/systemd/system/vsftpd2.service"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" enabled"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" vendor preset: disabled"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n   Active: active "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("running"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" since Thu "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-03-19 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":50:22 CST"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" 27s ago\n Main PID: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5987")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("vsftpd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n   CGroup: /system.slice/vsftpd2.service\n           "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("-5987 /usr/sbin/vsftpd /etc/vsftpd/vsftpd2.conf\n\nMar "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":50:22 study.centos.mrcode systemd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": Stopped Vsftpd2 "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ftp")]),s._v(" daemon.\nMar "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":50:22 study.centos.mrcode systemd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": Starting Vsftpd2 "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ftp")]),s._v(" daemon"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nMar "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":50:22 study.centos.mrcode systemd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": Started Vsftpd2 "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ftp")]),s._v(" daemon.\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study system"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# netstat -tlnp | grep vsftp")]),s._v("\ntcp6       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" :::555                  :::*                    LISTEN      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5987")]),s._v("/vsftpd         \ntcp6       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" :::21                   :::*                    LISTEN      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5986")]),s._v("/vsftpd\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br"),a("span",{staticClass:"line-number"},[s._v("77")]),a("br"),a("span",{staticClass:"line-number"},[s._v("78")]),a("br"),a("span",{staticClass:"line-number"},[s._v("79")]),a("br"),a("span",{staticClass:"line-number"},[s._v("80")]),a("br")])]),a("p",[s._v("这样一个启动脚本的完成了")]),s._v(" "),a("h2",{attrs:{id:"多重的重复设置方式：以-getty-为例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#多重的重复设置方式：以-getty-为例"}},[s._v("#")]),s._v(" 多重的重复设置方式：以 getty 为例")]),s._v(" "),a("p",[s._v("CentOS 7 开机后，有 6 个终端机可以使用（tty1 ~ tty6），是由 agetty 指令搞定的。终端机的功能涉及很多层面，主要管理的是 getty.target 这个 target unit，实际产生 tty1~tty6 的则是由 getty@.service 所提供的。")]),s._v(" "),a("p",[s._v("通过这个 getty@.service  的启动脚本来获取 @ 是啥含义")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study system"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /usr/lib/systemd/system/getty@.service")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  This file is part of systemd.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  systemd is free software; you can redistribute it and/or modify it")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  under the terms of the GNU Lesser General Public License as published by")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  the Free Software Foundation; either version 2.1 of the License, or")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  (at your option) any later version.")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Unit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Description")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Getty on %I\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Documentation")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("man:agetty"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" man:systemd-getty-generator"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Documentation")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://0pointer.de/blog/projects/serial-console.html\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("After")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("systemd-user-sessions.service plymouth-quit-wait.service getty-pre.target\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("After")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("rc-local.service\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# If additional gettys are spawned during boot then we should make")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sure that this is synchronized before getty.target, even though")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# getty.target didn't actually pull it in.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Before")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("getty.target\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("IgnoreOnIsolate")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("yes\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# On systems without virtual consoles, don't start any getty. Note")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# that serial gettys are covered by serial-getty@.service, not this")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# unit.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ConditionPathExists")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/dev/tty0\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Service"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# the VT is cleared by TTYVTDisallocate")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStart")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("-/sbin/agetty --noclear %I "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$TERM")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("idle\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Restart")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("always\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("RestartSec")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("UtmpIdentifier")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("%I\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("TTYPath")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/dev/%I\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("TTYReset")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("yes\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("TTYVHangup")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("yes\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("TTYVTDisallocate")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("yes\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("KillMode")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("process\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("IgnoreSIGPIPE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("no\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SendSIGHUP")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("yes\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Unset locale for the console getty since the console has problems")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# displaying some internationalized messages.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Environment")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("LANG")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("LANGUAGE")])]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LC_CTYPE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("LC_NUMERIC")])]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("LC_TIME")])]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LC_COLLATE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("LC_MONETARY")])]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LC_MESSAGES")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("LC_PAPER")])]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("LC_NAME")])]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("LC_ADDRESS")])]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("LC_TELEPHONE")])]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("LC_MEASUREMENT")])]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("LC_IDENTIFICATION")])]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Install"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("WantedBy")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("getty.target\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DefaultInstance")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tty1\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br")])]),a("p",[s._v("重要项： ExecStart，通过  man agetty 时发现它的语法应该是 "),a("code",[s._v("agetty --noclear tty1")]),s._v(" （笔者没有看懂里面哪里写的有这个，内容有点多），那么启动 6 个的话，就需要有 6 个 启动配置来分别配置启动指令 tty1~tty6，是在很繁琐，这就出现了 "),a("code",[s._v("getty@.service")]),s._v(" 中的  @ 。先来看看他的上游 "),a("code",[s._v("Before=getty.target")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study system"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl show getty.target")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Id")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("getty.target\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Names")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("getty.target\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Wants")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("getty@tty1.service\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("WantedBy")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("multi-user.target\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Conflicts")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("shutdown.target\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Before")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("multi-user.target\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("After")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("getty@tty1.service\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这里，笔者的环境上与书上不一致了，书上是 getty@tty1.service getty@tty2.service 等 6 个")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 注意，这里笔者发现了为什么不一样")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /usr/lib/systemd/system/getty.target 里面内容很少，没有上面这些定义")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 但是用 show 可以显示出来，这个书上目前没有讲解")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 但是，通过切换到 tty2 tty3 上去的时候，使用  systemctl show getty.target 查看状态时，After 后面就会出现已经切换过之后的 tty。和书上展示是一样的效果")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("p",[s._v("书上说，上面的 After 的配置，当 执行完 getty.target 之后，会持续要求 getty@tty1.service  等 6 个服务继续启动。那么 systemd 就会如下做：")]),s._v(" "),a("ul",[a("li",[s._v("先查找 "),a("code",[s._v("/usr/lib/systemd/system/")]),s._v("、"),a("code",[s._v("/etc/systemd/system/")]),s._v(" 有无 "),a("code",[s._v("getty@tty1.service")]),s._v(" 的设置，若有就启动，没有则执行下一步")]),s._v(" "),a("li",[s._v("找到 "),a("code",[s._v("getty@.service")]),s._v(" 的设置，则将 @ 后面的数据代入成 "),a("code",[s._v("%I")]),s._v(" 的变量，进入 gett@.service 执行")])]),s._v(" "),a("p",[s._v("也就是说 "),a("code",[s._v("getty@tty1.service")]),s._v(" 实际上是不存在的，主要是通过 "),a("code",[s._v("getty@.service")]),s._v(" 来执行，来简化多个执行的启动设置，他的命名方式如下：")]),s._v(" "),a("ul",[a("li",[s._v("源文件：执行服务名称@.service")]),s._v(" "),a("li",[s._v("执行文件：执行服务名称@范例名称.service")])]),s._v(" "),a("p",[a("code",[s._v("getty@.service")]),s._v(" 中的启动指令"),a("code",[s._v("ExecStart=-/sbin/agetty --noclear %I $TERM")]),s._v("，根据 getty.target 的信息输出来看，"),a("code",[s._v("getty@tty1.service")]),s._v(" 的 "),a("code",[s._v("%I")]),s._v(" 的值是 tty1，因此执行脚本会变成 "),a("code",[s._v("/sbin/agetty --noclear tty1")])]),s._v(" "),a("h3",{attrs:{id:"将-tty-的数量由-6-个降低到-4-个"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#将-tty-的数量由-6-个降低到-4-个"}},[s._v("#")]),s._v(" 将 tty 的数量由 6 个降低到 4 个")]),s._v(" "),a("p",[s._v("这个配置是在 "),a("code",[s._v("/etc/systemd/logind.conf")]),s._v(" 里面配置的。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1. 打开注释信息，并修改成 4 个")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study system"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /etc/systemd/logind.conf")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Login"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("NAutoVTs")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ReserveVT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2. 如果你切换到 tty5 和 tty6 的话，请将他们关闭后重启 getty.target")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl stop getty@tty5.service")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl stop getty@tty6.service")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl restart systemd-logind.service")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("当你回到桌面环境下，再切换到 tty5 和 tty6 时就切换不过去了。")]),s._v(" "),a("p",[s._v("到这里笔者貌似迷糊了，getty.target 只是一个定义，类似组，里面并没有定义什么，被其他的 unit 附加。有点不太明白和这里启动 1~6 个有什么关系？这里启动的是  systemd-logind.service ，而且切换只能在桌面环境下，也就是说 tty1~tty6 的切换是这个指令的功能，只是实际启动时用 getty@.service 启动的。但是具体怎么关联上的，是在是迷糊，看不懂")]),s._v(" "),a("p",[s._v("那么其实可以通过指令方式直接启动一个 tty。而无需其他的配置文件")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("systemctl start getty@tty8.service\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("如果只单独看这里的演示的话，笔者能明白的就是 getty@.service 是一个功能，可以通过 @ 传递参数给服务")]),s._v(" "),a("h3",{attrs:{id:"暂时新增-vsftpd-到-2121-端口"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#暂时新增-vsftpd-到-2121-端口"}},[s._v("#")]),s._v(" 暂时新增 vsftpd 到 2121 端口")]),s._v(" "),a("p",[s._v("vsftpd 也提供了 @ 的服务方式")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll /usr/lib/systemd/system | grep vsftpd")]),s._v("\n-rw-r--r--. "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("171")]),s._v(" Oct "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v(" vsftpd.service\n-rw-r--r--. "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("89")]),s._v(" Oct "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v(" vsftpd.target\n-rw-r--r--. "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("184")]),s._v(" Oct "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v(" vsftpd@.service\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这里")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /usr/lib/systemd/system/vsftpd@.service")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Unit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Description")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Vsftpd "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ftp")]),s._v(" daemon\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("After")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("network.target\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PartOf")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("vsftpd.target\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Service"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("forking\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStart")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/sbin/vsftpd /etc/vsftpd/%i.conf\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Install"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("WantedBy")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("vsftpd.target\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("这里使用了 "),a("code",[s._v("%i")]),s._v("，也就是说大小写的的变量都可以，这里启动指令拼接了一个配置文件路径 "),a("code",[s._v("/etc/vsftpd/%i.conf")])]),s._v(" "),a("p",[s._v("那么先创建这个配置文件，然后通过 @ 方式启动")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1. 制作一个 vsftpd3.conf ，并吧端口修改为 2121")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd /etc/vsftpd/    ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study vsftpd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll")]),s._v("\ntotal "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("28")]),s._v("\n-rw-------. "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("125")]),s._v(" Oct "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v(" ftpusers\n-rw-------. "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("361")]),s._v(" Mar "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(":59 user_list\n-rw-------. "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5201")]),s._v(" Mar "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":35 vsftpd.conf\n-rw-------. "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5199")]),s._v(" Mar "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":35 vsftpd2.conf\n-rwxr--r--. "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("338")]),s._v(" Oct "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v(" vsftpd_conf_migrate.sh\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study vsftpd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cp vsftpd.conf vsftpd3.conf")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study vsftpd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim vsftpd3.conf")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("listen_port")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2121")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2. 暂时启动，不要开机启动")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study vsftpd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl start vsftpd@vsftpd3.service")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study vsftpd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl status vsftpd@vsftpd3.service")]),s._v("\n* vsftpd@vsftpd3.service - Vsftpd "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ftp")]),s._v(" daemon\n   Loaded: loaded "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/usr/lib/systemd/system/vsftpd@.service"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" disabled"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" vendor preset: disabled"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n   Active: active "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("running"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" since Thu "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-03-19 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(":48:57 CST"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" 5s ago\n  Process: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7536")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStart")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/sbin/vsftpd /etc/vsftpd/%i.conf "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("code"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("exited, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("status")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/SUCCESS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n Main PID: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7538")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("vsftpd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n   CGroup: /system.slice/system-vsftpd.slice/vsftpd@vsftpd3.service\n           `-7538 /usr/sbin/vsftpd /etc/vsftpd/vsftpd3.conf\n\nMar "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(":48:57 study.centos.mrcode systemd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": Starting Vsftpd "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ftp")]),s._v(" daemon"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nMar "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(":48:57 study.centos.mrcode systemd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": Started Vsftpd "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ftp")]),s._v(" daemon.\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study vsftpd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# netstat -tlnp | grep vsftpd")]),s._v("\ntcp6       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" :::2121                 :::*                    LISTEN      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7538")]),s._v("/vsftpd         \ntcp6       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" :::555                  :::*                    LISTEN      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5987")]),s._v("/vsftpd         \ntcp6       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" :::21                   :::*                    LISTEN      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5986")]),s._v("/vsftpd\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br")])]),a("p",[s._v("可以看到通过这种 @ 的方式，能让我们制作启动脚本的时候更为灵活一点")]),s._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),a("p",[s._v("有一件事情，这次使用了 2121 端口，却不用修改 SELinux？因为默认启动小于 1024 以下的端口时，需要使用到 root 的权限，大于 2014 的相对来说对系统的影响可能小一些，就忽略了 SELinux 的限制了")]),s._v(" "),a("p",[s._v("笔者看这句话，貌似记不起有关 SELinux 端口限制的知识了？懵逼状态")])]),s._v(" "),a("h2",{attrs:{id:"自己的服务自己做"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#自己的服务自己做"}},[s._v("#")]),s._v(" 自己的服务自己做")]),s._v(" "),a("p",[s._v("下面模拟自己做一个服务：制作一个可以备份自己系统的服务，这脚本放在 "),a("code",[s._v("/backups")]),s._v(" 下，内容如下")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mkdir /backups\t\t# 下面脚本，上层目录不存在，都无法保存的")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /backups/backup.sh")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#!/bin/bash")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("source")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc /home /root /var/lib /var/spool/{cron,at,mail}"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("target")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/backups/backup-system-'),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("date")]),s._v(" +%Y-%m-%d"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v('.tar.gz"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" -d /backups "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /backups\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -zcvf "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${target}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${source}")]),s._v(" $"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /backups/backup.log\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# chmod a+x /backups/backup.sh")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll /backups/backup.sh")]),s._v("\n-rwxr-xr-x. "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("222")]),s._v(" Mar "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" 09:24 /backups/backup.sh\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("p",[s._v("准备 backup.service 的启动脚本")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /etc/systemd/system/backup.service")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("unit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Description")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("backup my server\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Requires")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("atd.service\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Service"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("simple\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStart")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/bin/bash -c "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('" echo /backups/backup.sh | at now"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Install"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("WantedBy")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("multi-user.target\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 因为 ExecStart 里面用到了 at 指令，因此 atd.service 是一定需要的服务")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl daemon-reload")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl start backup.service")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl status backup.service")]),s._v("\n* backup.service - backup my server\n   Loaded: loaded "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/etc/systemd/system/backup.service"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" disabled"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" vendor preset: disabled"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n   Active: inactive "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("dead"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nMar "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" 09:30:56 study.centos.mrcode systemd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": Started backup my server.\nMar "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" 09:30:56 study.centos.mrcode bash"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17748")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": job "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" at Fri Mar "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" 09:30:00 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可以看到服务在执行了，状态是 inactive ，这不是一个驻留内存的服务，执行完成就退出了")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这里笔者看不懂为啥用 echo /backups/backup.sh | at now； 而不是直接直接给定脚本路径，而且貌似脚本里面的内容执行也有问题")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br")])])])}),[],!1,null,null,null);t.default=e.exports}}]);