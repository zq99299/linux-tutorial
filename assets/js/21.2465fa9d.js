(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{461:function(s,t,n){s.exports=n.p+"assets/img/image-20191101234333791.15ef750d.png"},462:function(s,t,n){s.exports=n.p+"assets/img/image-20191101234746782.507a7977.png"},577:function(s,t,n){"use strict";n.r(t);var a=n(16),e=Object(a.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"光盘写入工具"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#光盘写入工具"}},[s._v("#")]),s._v(" 光盘写入工具")]),s._v(" "),a("p",[s._v("企业喜欢使用磁带来进行备份，容量高、存储时限常、耐摔等等，至于以前的 DVD/CD 等，因为存储速度慢、容量没有大幅度提升，很少使用了")]),s._v(" "),a("p",[s._v("虽然现在很少使用了，不过在特别的情况下，没有这东西又不行，因此这里介绍在文本模式的刻录行为是怎么处理的，通常做法是这样的：")]),s._v(" "),a("ol",[a("li",[s._v("现将所需要备份的数据建立成为一个映像文档（iso)，利用 mkisofs 指令来处理")]),s._v(" "),a("li",[s._v("将该映像文件刻录到光盘或则 DVD 中，利用 cdrecord 指令来处理")])]),s._v(" "),a("h2",{attrs:{id:"mkisofs-建立映像文档"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mkisofs-建立映像文档"}},[s._v("#")]),s._v(" mkisofs 建立映像文档")]),s._v(" "),a("p",[s._v("刻录可开机与不可开机的光盘，使用方法不太一样")]),s._v(" "),a("h3",{attrs:{id:"制作一般数据光盘映像文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#制作一般数据光盘映像文件"}},[s._v("#")]),s._v(" 制作一般数据光盘映像文件")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkisofs")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-o 映像文档"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-Jrv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-V vol"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-m file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" 待备份文件 -graft-point "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("isodir")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("systemdir "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("选项与参数：")]),s._v(" "),a("ul",[a("li",[s._v("o：接想要产生的映像文档名")]),s._v(" "),a("li",[s._v("J：产生较兼容于 windows 机器的文件名结构，可增加文件名长度 64 个 unicode 字符")]),s._v(" "),a("li",[s._v("r：通过 Rock Ridge 产生支持 Unix/Linux 的文件数据，可记录较多的信息（如 UID/GID) 等")]),s._v(" "),a("li",[s._v("v：显示建立 ISO 文件的过程")]),s._v(" "),a("li",[s._v("V vol：建立 Volume ，有点像 windows 在文件总管内看到的 CD title 的东西")]),s._v(" "),a("li",[s._v("m file：-m 为排除文件（exclude），后面的文件不备份到该映像文档中，也可以使用 * 通配符")]),s._v(" "),a("li",[s._v("-graft-point：graft 有转嫁或移植的意思，相关资料在下面说明")])]),s._v(" "),a("p",[s._v("mkisofs 有非常多好用的选项，只想制作数据光盘时，上述的选项就够用了。光盘格式一般称为 iso9660，这种格式一般仅支持旧版的 DOS 文件名（文件只能以 8.3 即 文件名 8 个字符，扩展名 3 个字符的方式存在）。如果加上 -r 选项后，文件信息能够被记录得比较完整")]),s._v(" "),a("p",[s._v("此外，一般预设的情况下，所有要被加到映像中的文件都会被放置到映像文件的根目录，如此一来可能会造成刻录后的文件分类不易的情况，可以使用 -graft-point 选项")]),s._v(" "),a("ul",[a("li",[s._v("映像文件中的目录所在 等于 实际 Linux 文件系统的目录所在")]),s._v(" "),a("li",[s._v("/movies=/srv/movies（在 Linux 的 /srv/movies 内的文件，加到映像文件中的 /movies/ 目录）")]),s._v(" "),a("li",[s._v("/linux/etc=/etc（将 Linux 中的 /etc/ 内的所有数据备份到映像文件中的 /liux/etc 目录中")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 假如想要讲 /root、/home、/etc 等目录内的数据通过刻录起来的话，先要处理下映像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 先不使用 -graft-point 的选项处理")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mkisofs -v -o /tmp/system.img /root /home/ /etc/")]),s._v("\nI: -input-charset not specified, using utf-8 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("detected "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" locale settings"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ngenisoimage "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.1")]),s._v(".11 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Linux"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nScanning /root\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". 很多的文件记录输出\nWriting:   The File"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                             Start Block "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("955")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9.23")]),s._v("% done, estimate finish Tue Oct "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v(" 03:55:51 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18.47")]),s._v("% done, estimate finish Tue Oct "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v(" 03:55:51 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27.72")]),s._v("% done, estimate finish Tue Oct "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v(" 03:55:51 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("36.94")]),s._v("% done, estimate finish Tue Oct "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v(" 03:55:51 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("46.19")]),s._v("% done, estimate finish Tue Oct "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v(" 03:55:51 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("55.39")]),s._v("% done, estimate finish Tue Oct "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v(" 03:55:51 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64.62")]),s._v("% done, estimate finish Tue Oct "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v(" 03:55:51 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("73.85")]),s._v("% done, estimate finish Tue Oct "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v(" 03:55:51 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("83.08")]),s._v("% done, estimate finish Tue Oct "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v(" 03:55:52 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("92.33")]),s._v("% done, estimate finish Tue Oct "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v(" 03:55:52 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v("\nTotal translation table size: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nTotal rockridge attributes bytes: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nTotal directory bytes: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1869824")]),s._v("\nPath table size"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bytes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13350")]),s._v("\nDone with: The File"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                             Block"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("53057")]),s._v("\nWriting:   Ending Padblock                         Start Block "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("54012")]),s._v("\nDone with: Ending Padblock                         Block"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("150")]),s._v("\nMax brk space used "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("378000")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("54162")]),s._v(" extents written "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("105")]),s._v(" MB"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 笔者这个直接成功了，在树上因为 /etc/crontab 和 /root/crontab 中有相同的文件")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 他们没有被归档的时候，都会出现在映像文档中的根目录，所以报错")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll -h /tmp/system.img ")]),s._v("\n-rw-r--r--. "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root 106M "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("月 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v(" 03:55 /tmp/system.img\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看该映像中的内容")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可以挂载到某个目录下，再查看")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mount -o loop /tmp/system.img /mnt/")]),s._v("\nmount: /dev/loop0 写保护，将以只读方式挂载\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# df -h /mnt/")]),s._v("\n文件系统        容量  已用  可用 已用% 挂载点\n/dev/loop0      106M  106M     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("% /mnt\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用 ll /mnt 指令查看，只发现里面全是没有路径的文件")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br")])]),a("p",[s._v("发现所有的数据都放在了映像文件中的根目录，下面使用归档再看看")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 卸载掉")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("umount")]),s._v(" /mnt\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mkisofs -r -V 'linux_file' -o /tmp/system.img -m /roo/etc --graft-point /root=/root /home/=/home /etc=/etc")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll -h /tmp/system.img ")]),s._v("\n-rw-r--r--. "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root 107M "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("月 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v(" 04:05 /tmp/system.img\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mount -o loop /tmp/system.img /mnt/")]),s._v("\nmount: /dev/loop0 写保护，将以只读方式挂载\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll /mnt/")]),s._v("\n总用量 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("46")]),s._v("\ndr-xr-xr-x. "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("143")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("38912")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("月  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(":38 etc\ndr-xr-xr-x.   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" root root  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("月  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":01 home\ndr-xr-xr-x.   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" root root  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("月 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v(" 00:57 root\ndr-xr-xr-x.   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" root root  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("月 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v(" 04:05 rr_moved\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("h2",{attrs:{id:"制作-修改可开机光盘映像文档"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#制作-修改可开机光盘映像文档"}},[s._v("#")]),s._v(" 制作/修改可开机光盘映像文档")]),s._v(" "),a("p",[s._v("要制作一键安装系统的光盘，需要修改原版光盘映像文件，改成可以自动加载某些程序的流程；刻录成光盘后，放入光驱，只要开机利用光盘来开机，就直接安装系统，不再需要询问管理员一些问题，等于是自动化处理，当然这些流程很麻烦，需要了解 kickstart 等相关技术，这里先不谈。本章让你知道如何让光盘内容被修改之后，还可以刻录成可开机的映像文档")]),s._v(" "),a("p",[s._v("笔者刚开始使用 mac，传入虚拟机文档不知道怎么弄，特别慢。就不跟着练习了，直接截图了")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看 iso 的信息")]),s._v("\nisoinfo -d -i /home/CentOS-7.iso \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 挂载该 iso 到 /mnt")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mount")]),s._v(" /home/CentOS-7.iso /mnt\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /srv/newcd\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rsync 可以完整复制所有的权限属性等数据，也可以进行镜像处理")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 现在 newcd 总已经是完整映像文档的内容了")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rsync")]),s._v(" -a /mnt /srv/newcd\nll /srv/newcd/\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这里就可以修改 newcd 里面的内容了，假设已经处理完")]),s._v("\nll /srv/newcd/isolinux\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /srv/newcd\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkisofs")]),s._v(" -o /custom.iso -b isolinux/isolinux.bin -c isolinux/boot.cat "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" -no-emul-boot -V "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'CentOS 7 x86_64'")]),s._v(" -boot-load-size "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" -boot-info-table -R -J -v -T\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 运行之后，就会存在一个 /custom.img 的文件存在,可以将该文件刻录到光盘上")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("p",[a("img",{attrs:{src:n(461),alt:"image-20191101234333791"}})]),s._v(" "),a("p",[a("img",{attrs:{src:n(462),alt:"image-20191101234746782"}})]),s._v(" "),a("h2",{attrs:{id:"cdrecord-光盘刻录工具"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cdrecord-光盘刻录工具"}},[s._v("#")]),s._v(" cdrecord 光盘刻录工具")]),s._v(" "),a("p",[s._v("新版的 CentOS 7 使用的是 wodim 指令来进行刻录行为（旧版是 cdrecord，为了兼容 wodim 也链接了旧版的）")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 常见的指令入戏")]),s._v("\nwodim --devices dev/det/sr0\t\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查询刻录机的 BUS 位置")]),s._v("\nwodim -v "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dev")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/dev/sr0 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("blank")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("fast"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("all"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 抹除重复读写片")]),s._v("\nwodim -v "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dev")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/dev/sr0 -format\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 格式化 DVD + RW")]),s._v("\nwodim -v "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dev")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/dev/sr0 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("可用选项功能"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" file.iso\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("选项与参数：")]),s._v(" "),a("ul",[a("li",[s._v("devices：用在扫描磁盘总线并找出可用的刻录机，后续的装置为 ATA 接口")]),s._v(" "),a("li",[s._v("v：在 cdrecord 运作的过程中，显示过程")]),s._v(" "),a("li",[s._v("dev=/dev/sr0：可以找出此光驱的 bus 地址，非常重要")]),s._v(" "),a("li",[s._v("`blank[fast|all]：blank 为抹除可重复写的 Cd/DVD-RW ，使用 fast 较快，all 较完成")]),s._v(" "),a("li",[s._v("format：对光盘进行格式化，但是仅针对 DVD+RW 这种格式的 DVD")]),s._v(" "),a("li",[s._v("可用选项与功能：\n"),a("ul",[a("li",[a("code",[s._v("-data")]),s._v("：指定后面的文件以数据格式写入，不是以 CD 音轨（-audio）方式写入")]),s._v(" "),a("li",[s._v("speed=x：指定刻录速度，例如 CD 可用 speed=40 为 40 倍数，DVD 则可用 speed=4 之类")]),s._v(" "),a("li",[a("code",[s._v("-eject")]),s._v("：指定刻录完毕后自动退出光盘")]),s._v(" "),a("li",[s._v("fs=Ym：指定多少缓存存储器，可用在将映像档先暂存至缓冲存储器。预设为 4m，一般建议可增加到 8m，不过还是得视你的刻录机而定")])])]),s._v(" "),a("li",[s._v("针对 DVD 的选项功能：\n"),a("ul",[a("li",[s._v("driveropts=burnfree：打开 Buffer Underrun Free 模式的写入功能")]),s._v(" "),a("li",[a("code",[s._v("-sao")]),s._v("：支持 DVD-RW 的格式")])])])]),s._v(" "),a("h3",{attrs:{id:"侦测你的刻录机所在位置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#侦测你的刻录机所在位置"}},[s._v("#")]),s._v(" 侦测你的刻录机所在位置")]),s._v(" "),a("p",[s._v("文不能模式的刻录确实比较麻烦，需要先找到刻录机才行。早期刻录机都是使用 SCSI 接口，因此配合 SCSI 接口认定来查询")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll /dev/sr0 ")]),s._v("\nbrw-rw----+ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root cdrom "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("月 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("28")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(":38 /dev/sr0\t "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 一般 Linux 光驱文件名")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# wodim --devices dev=/dev/sr0")]),s._v("\nwodim: Warning: controller returns zero sized CD capabilities page.\nwodim: Warning: controller returns wrong size "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" CD capabilities page.\nwodim: Warning: controller returns wrong page "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" CD capabilities page "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("2A"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(".\nwodim: Overview of accessible drives "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" found"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("\n-------------------------------------------------------------------------\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dev")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/dev/sr0'")]),s._v("      rwrw-- "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'VBOX'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'CD-ROM'")]),s._v("\n-------------------------------------------------------------------------\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#笔者这个是虚拟机的，因此无法真正的使用，那么下面的指令直接记录书上的步骤")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("h3",{attrs:{id:"进入-cd-dvd-的刻录动作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#进入-cd-dvd-的刻录动作"}},[s._v("#")]),s._v(" 进入 CD/DVD 的刻录动作")]),s._v(" "),a("p",[s._v("如何将 /tmp/system.img 刻录到 cd/dvd 里面？")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 0. 先抹除光盘的原始内容：（非可重复读写则可略过此步骤）")]),s._v("\nwodim -v "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dev")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/dev/sr0 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("blank")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("fast\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 中间会抛出一堆信息告诉你抹除的进度，而且会有 10 秒的时间等待你取消")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1. 开始刻录; eject 刻录完成之后，DVD 会被退出光驱，记得推回去")]),s._v("\nwodim -v "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dev")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/dev/sr0 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("speed")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" -dummy -eject /tmp/system.img\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2. 刻录完成后，测试挂载一下，检验内容")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mount")]),s._v(" /dev/sr0/mnt\ndh -h /mnt\nll /mnt\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("umount")]),s._v(" /mnt\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[s._v("简单刻录上面的语法就够了，但是还是建议在图形化界面中来刻录")])])}),[],!1,null,null,null);t.default=e.exports}}]);