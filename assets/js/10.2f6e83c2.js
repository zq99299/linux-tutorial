(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{494:function(s,t,n){s.exports=n.p+"assets/img/image-20200316175339460.9e6cc7da.png"},495:function(s,t,n){s.exports=n.p+"assets/img/image-20200317094948523.1dd1aeb9.png"},496:function(s,t,n){s.exports=n.p+"assets/img/image-20200317115128966.fecb0517.png"},497:function(s,t,n){s.exports=n.p+"assets/img/image-20200317132323274.bd90cb61.png"},643:function(s,t,n){"use strict";n.r(t);var a=n(16),e=Object(a.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"selinux-初探"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#selinux-初探"}},[s._v("#")]),s._v(" SELinux 初探")]),s._v(" "),a("p",[s._v("CentOS 5.x 之后，SELinux 已经是个非常完备的核心模块了，尤其是 CentOS 提供了很多管理 SELinux 的指令与机制，因此在整理架构上面是单纯且容易操作管理的，所以在没有自行开发网络服务软件以及使用其他第三方协力软件的情况下，也就是全部使用 CentOS 官方提供的软件来使用我们服务器的情况下，建议不要关闭 SELinux")]),s._v(" "),a("h2",{attrs:{id:"什么是-selinux"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是-selinux"}},[s._v("#")]),s._v(" 什么是 SELinux")]),s._v(" "),a("p",[s._v("Security Enhanced Linux 的缩写 SELinux，字面意思是安全强化的 LInux。至于强化的是哪个部分？下面来了解下")]),s._v(" "),a("h3",{attrs:{id:"当初设计的目标：避免资源的误用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#当初设计的目标：避免资源的误用"}},[s._v("#")]),s._v(" 当初设计的目标：避免资源的误用")]),s._v(" "),a("p",[s._v("SELinux 是由美国国家安全局（NSA）开发的，需求来源于内部员工资源误用导致系统出现问题；")]),s._v(" "),a("p",[s._v("资源误用：将一个 "),a("code",[s._v("/var/www/html/")]),s._v(" 目录权限设置成 777，那么当启动 www 服务器软件，就意味着这个软件触发的进程拥有对该目录写入的权限，只要通过该进程服务器对目录大量写入，就会导致系统硬盘资源被爆破")]),s._v(" "),a("p",[s._v("SELinux 是在进行进程、文件等西部权限设置依据的一个核心模块，由于启动网络服务的也是进程，因此刚好也能够控制网络服务是否能存取系统资源的一道关卡")]),s._v(" "),a("p",[s._v("在讲解 SELinux 之前，先回顾一下之前讲到的：系统文件权限与用户之间的关系")]),s._v(" "),a("h3",{attrs:{id:"传统的文件权限与账户关系：自主式访问控制-dac"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#传统的文件权限与账户关系：自主式访问控制-dac"}},[s._v("#")]),s._v(" 传统的文件权限与账户关系：自主式访问控制 DAC")]),s._v(" "),a("p",[s._v("第 13 章中讲到：系统账户主要分为系统管理员（root）与一般用户，他们能否使用系统上的文件资源与 rwx 权限设置有关。（各种权限设置对 root 无效）。当某个进程想要对文件进行存取时，系统会根据该进程的拥有者、群组，并比对文件的权限，若通过权限检查，就可以存取该文件")]),s._v(" "),a("p",[s._v("这种存取文件的方式被称为 "),a("strong",[s._v("自主式访问控制 Discretionary Access Controller 简称 DAC")]),s._v("，基本上就是依据进程的拥有者与文件资源的 rwx 权限来决定有无存取的能力。DAC 有如下困扰：")]),s._v(" "),a("ul",[a("li",[s._v("root 具有最高的权限：只要取得属于 root 的进程，那么就很危险")]),s._v(" "),a("li",[s._v("使用者可以取得进程来变更文件资源的访问权限：如果将某个目录权限不小心设置为 777，由于对任何人的权限会变成 rwx，因此该目录就会被任何人所任意存取")])]),s._v(" "),a("h3",{attrs:{id:"以政策规则规定特定进程读取特定文件：委任式访问控制-mac"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#以政策规则规定特定进程读取特定文件：委任式访问控制-mac"}},[s._v("#")]),s._v(" 以政策规则规定特定进程读取特定文件：委任式访问控制 MAC")]),s._v(" "),a("p",[s._v("为了避免 DAC 的困扰，SELinux 导入了委任式访问控制 Mandatory Access Control 简称 MAC")]),s._v(" "),a("p",[s._v("MAC 可以针对特定的进程与特定的文件资源来进行权限的控制。即使你是 root，那么在使用不同的进程时，你所能取得的权限并不一定是 root，而需要看当时该进程的设置。如此一来针对控制的「主体」变成了「进程」而不是使用者，但是真个系统进程很多、文件也很多，一项一项控制太麻烦，所以 SELinux 也提供一些预设的政策 "),a("strong",[s._v("Policy")]),s._v(" ，并在该政策内提供多个规则 "),a("strong",[s._v("rule")]),s._v("，让你可以选择是否启用该控制规则")]),s._v(" "),a("p",[s._v("在该种模式下，进程能够活动的空变小了。比如：www 服务器软件达成进程为 httpd 这个程序，默认情况下， httpd 仅能在 "),a("code",[s._v("/var/www")]),s._v(" 目录下存取文件，如果 httpd 进程要去其他目录存储数据时，除了规则设置要开放外，目标目录也要设置成 httpd 可读取的模式 type 才行，限制非常多，所以，即使 httpd 这个进程被黑客取得了控制权限，它也无权限浏览其他的目录文件")]),s._v(" "),a("p",[s._v("简单说，针对 Apache 这个 www 网络服务使用 DAC 或 MAC 的结果来说，两者的关系可用下图来说明")]),s._v(" "),a("p",[a("img",{attrs:{src:n(494),alt:"image-20200316175339460"}})]),s._v(" "),a("p",[s._v("圆环表示画地为牢，DAC 模式下，由于是 root，牢房对 root 无效。在 MAC 下，牢房就生效了")]),s._v(" "),a("h2",{attrs:{id:"selinux-的运作模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#selinux-的运作模式"}},[s._v("#")]),s._v(" SELinux 的运作模式")]),s._v(" "),a("p",[a("strong",[s._v("强调")]),s._v("：SELinux 是通过 MAC 方式来管控 "),a("strong",[s._v("进程")]),s._v("，进程是主体，而目标则是该进程能否读取的文件资源。")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("主体 Subject：可以看成就是 进程")])]),s._v(" "),a("li",[a("p",[s._v("目标 Object：目标资源，一般就是文件系统")])]),s._v(" "),a("li",[a("p",[s._v("政策 Policy：会根据某些服务来制定基本的存取安全性政策，政策内还会有详细的规则 rule 来指定不同的服务开放某些资源的存取。在目前的 CentOS 7.x 里面仅提供 3 个主要的政策：")]),s._v(" "),a("ul",[a("li",[s._v("targeted：针对网络服务限制较多，针对本机限制较少，是预设的政策")]),s._v(" "),a("li",[s._v("minimum：由 target 修正而来，仅针对选择的进程来保护")]),s._v(" "),a("li",[s._v("mls：完整的 SELinux 限制，限制方面较严格")])])]),s._v(" "),a("li",[a("p",[s._v("安全性本文 security context")]),s._v(" "),a("p",[s._v("主体是否能存取目标除了政策指定之外，"),a("strong",[s._v("主体与目标的安全性本文必须一致才能够顺利存取")])]),s._v(" "),a("p",[s._v("security context 类似文件系统的 rwx，如果设置错误，你的某些服务（主体进程）就无法存取文件系统（目标资源），就会出现权限不符对的错误信息了")])])]),s._v(" "),a("p",[s._v("由于 SELinux 重点在保护进程读取文件系统的权限，上述说明的示意图如下：")]),s._v(" "),a("p",[a("img",{attrs:{src:n(495),alt:"image-20200317094948523"}})]),s._v(" "),a("p",[s._v("传统的进程与文件的 rwx 方式，在这中间增加了 SELinux 月 安全性本文 "),a("em",[s._v("规则")]),s._v(" ，通过了这些规则之后，才和传统的进程与文件的 rwx 方式一致。")]),s._v(" "),a("p",[s._v("笔者理解为是通过拦截器的方式，出台了 SELinux ，前面通过 SElinux 拦截细化权限，符合要求的再去到传统的方式，这样一来就对传统的加强了")]),s._v(" "),a("h3",{attrs:{id:"安全性本文-security-context"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安全性本文-security-context"}},[s._v("#")]),s._v(" 安全性本文 Security Context")]),s._v(" "),a("p",[s._v("CentOS 7.x 的 target 政策提供了非常多的规则，只需要如何开启关闭某项规则即可。")]),s._v(" "),a("p",[s._v("安全性本文则非常麻烦，可能需要自行配置它，比如你常常设置文件的 rwx 权限，那么这个安全性本文就类似，可以看成是 SELinux 中的 rwx")]),s._v(" "),a("p",[s._v("安全性本文存在于主体进程中与目标文件资源中，物理位置是放在文件的 inode 中，因此主体进程想要读取目标文件资源时，同样需要读取 inode，这就可以对比安全性本文一级 rwx 等权限是否正确了。")]),s._v(" "),a("p",[s._v("观察安全性本文可使用 "),a("code",[s._v("ls -Z")]),s._v(" ，但是前提是需要启动 SELinux 才行，下个小节会介绍如何启动 SELinux，这里先介绍知识点")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls -Z")]),s._v("\n-rw-r--r--. root root unconfined_u:object_r:admin_home_t:s0 accountadd.sh\n-rw-r--r--. root root unconfined_u:object_r:admin_home_t:s0 accountadd.txt\n-rwxr--r--+ root root unconfined_u:object_r:admin_home_t:s0 acl_test1\n-rw-r--r--. root root unconfined_u:object_r:admin_home_t:s0 addaccount2.sh\n-rw-------. root root system_u:object_r:admin_home_t:s0 anaconda-ks.cfg\n-rw-r--r--. root root system_u:object_r:admin_home_t:s0 initial-setup-ks.cfg\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 上述字段很长的那一栏就是安全性本文了")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("安全性本文主要用冒号分割为三个字段，含义如下：")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("identify：身份")]),s._v(" "),a("p",[s._v("相当于账户方面的身份识别，常见有几下几种类型")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("unconfined_u：不受限的用户")]),s._v(" "),a("p",[s._v("该文件来自不受限的进程所产生的，一般来说，可以使用可登录账号来取得 bash，预设的 bash 环境是不受 SELinux 管制的，因为 bash 并不是什么特别的网络服务，因此在该 bash 进程所产生的文件，其身份识别大多就是该类型了")])]),s._v(" "),a("li",[a("p",[s._v("system_u：系统用户")]),s._v(" "),a("p",[s._v("基本上，如果是系统会软件本身所提供的文件，大多就是该类型，如果是用户通过 bash 自己建立的文件，大多则是不受限的 unconfined_u 身份，如果是网络服务所产生的文件，或则是系统服务运行过程中所产生的文件，则大部分是 system_u")])])])]),s._v(" "),a("li",[a("p",[s._v("role：角色")]),s._v(" "),a("p",[s._v("通过该字段，可以知道这个资料是属于进程、文件资源还是代表使用者，一般的角色有：")]),s._v(" "),a("ul",[a("li",[s._v("object_r：代表的是文件或目录等文件资源")]),s._v(" "),a("li",[s._v("system_r：代表的是进程，不过一般使用者也会被指定为 system_r")])])]),s._v(" "),a("li",[a("p",[s._v("type：类型，最重要")]),s._v(" "),a("p",[s._v("在预设的 targeted 政策中， identify 与 role 字段基本上是不重要的，而 type 是最重要的，基本上，一个主体进程能不能读取到这个文件资源，与类型字段有关，而类型字段在文件与进程的定义不相同：")]),s._v(" "),a("ul",[a("li",[s._v("type：在文件资源（object）上面称为类型（type）")]),s._v(" "),a("li",[s._v("domain：在主体进程（subject）则称为领域（domain）")])]),s._v(" "),a("p",[s._v("domain 需要与 type 搭配，则该进程才能够顺利的读取文件资源")]),s._v(" "),a("h2",{attrs:{id:"进程与文件-selinux-type-字段的相关性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#进程与文件-selinux-type-字段的相关性"}},[s._v("#")]),s._v(" 进程与文件 SELinux type 字段的相关性")]),s._v(" "),a("p",[s._v("通过身份识别与角色字段的定义，我们可以大概某个进程所代表的意义")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 观察下系统 进程的 SELinux 相关信息")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ps -eZ")]),s._v("\nLABEL                             PID TTY          TIME CMD\nsystem_u:system_r:init_t:s0         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" ?        00:00:01 systemd\nsystem_u:system_r:kernel_t:s0       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" ?        00:00:00 kthreadd\nsystem_u:system_r:kernel_t:s0       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" ?        00:00:00 kworker/0:0H\nsystem_u:system_r:kernel_t:s0       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" ?        00:00:00 kworker/u2:0\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nsystem_u:system_r:sshd_t:s0-s0:c0.c1023 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2344")]),s._v(" ? 00:00:00 sshd\nunconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2350")]),s._v(" ? 00:00:00 sshd\nunconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2353")]),s._v(" pts/0 00:00:00 "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\nunconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2415")]),s._v(" pts/0 00:00:00 "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("su")]),s._v("\nunconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2424")]),s._v(" pts/0 00:00:00 "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\nsystem_u:system_r:kernel_t:s0    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2726")]),s._v(" ?        00:00:00 kworker/u2:2\nsystem_u:system_r:kernel_t:s0    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2778")]),s._v(" ?        00:00:00 kworker/0:1\nsystem_u:system_r:kernel_t:s0    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2836")]),s._v(" ?        00:00:00 kworker/0:3\nsystem_u:system_r:kernel_t:s0    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2877")]),s._v(" ?        00:00:00 kworker/0:0\nsystem_u:system_r:ksmtuned_t:s0  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2885")]),s._v(" ?        00:00:00 "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v("\nunconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2886")]),s._v(" pts/0 00:00:00 "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 基本上进程主要分为两大类，")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 一种是系统有受限的 system_u:system_r，")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 另一种可能是用户自己的，比较不受限的进程（通常是本机用户自己执行的程序 ） unconfined_u:unconfined_r")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023 2424 pts/0 00:00:00 bash")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 比如上面这个进程，就是我们自己执行命令所在的 bash")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br")])]),a("p",[s._v("基本上，这些对于资料在 targeted 政策下的对应对下")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("身份识别")]),s._v(" "),a("th",[s._v("角色")]),s._v(" "),a("th",[s._v("对应在 targeted 的意义")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("unconfined_u")]),s._v(" "),a("td",[s._v("unconfined_r")]),s._v(" "),a("td",[s._v("一般可登陆使用者的进程，比较没有受限的进程。大多数都是用户已经顺利登陆系统（不论是网络还是本机登陆来取得可用的 shell）后，所用来操作系统的进程，如 bash x window 相关富安居等")])]),s._v(" "),a("tr",[a("td",[s._v("system_u")]),s._v(" "),a("td",[s._v("system_r")]),s._v(" "),a("td",[s._v("由于为系统账户，因此是非交谈式的系统运行进程，大多数的系统进程均是这种类型")])])])]),s._v(" "),a("p",[s._v("如上所述，在预设的 target 政策下，最重要的是 type 字段，主体与目标之间是否具有可读写的权限，与进程的 domain 与文件的 type 有关。这两者的关系可以使用 crond 以及他的配置文件来说明")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1. 先看看 crond 这个进程的安全本文内容")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ps -eZ | grep cron")]),s._v("\nsystem_u:system_r:crond_t:s0-s0:c0.c1023 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1398")]),s._v(" ? 00:00:00 atd\nsystem_u:system_r:crond_t:s0-s0:c0.c1023 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1400")]),s._v(" ? 00:00:00 crond\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这个安全本文的类型名称为 crond_t 格式")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2. 看看 /usr/ssbin/crond 、 /etc/cron.d、/etc/cron.d 文件的安全本文内容")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll -Zd /usr/sbin/crond /etc/crontab /etc/cron.d")]),s._v("\ndrwxr-xr-x. root root system_u:object_r:system_cron_spool_t:s0 /etc/cron.d\n-rw-r--r--. root root system_u:object_r:system_cron_spool_t:s0 /etc/crontab\n-rwxr-xr-x. root root system_u:object_r:crond_exec_t:s0 /usr/sbin/crond\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("执行 "),a("code",[s._v("/usr/ssbin/crond")]),s._v(" 后，该程序编程的进程 domain 类似是 crond_t，它能够读取的配置文件是 "),a("code",[s._v("system_cron_spool_t")]),s._v(" 类型。因此无论 "),a("code",[s._v("/etc/crontab")]),s._v("与 "),a("code",[s._v("/etc/cron.d")]),s._v(" 以及 "),a("code",[s._v("/var/spool/cron")]),s._v(" 都会是相关的 SELinux 类型（"),a("code",[s._v("/var/spool/cron")]),s._v(" 为 "),a("code",[s._v("user_cron_spool_t")]),s._v(" 类型）。下面图示说明")]),s._v(" "),a("p",[a("img",{attrs:{src:n(496),alt:"image-20200317115128966"}})])])]),s._v(" "),a("ol",[a("li",[s._v("crond 执行后，具有 crond_exec_t 类型")]),s._v(" "),a("li",[s._v("该文件类型会造成主体进程 Subject 具有 crond 这个领域 domain，政策针对这个领域有许多规则，其中就包括可以读取的目标资源类型")]),s._v(" "),a("li",[s._v("由于 crond domain 被设置为可以读取 system_cron_spool_t 类型的目标文件 object，因此你的配置文件放到 "),a("code",[s._v("/etc/cron.d/")]),s._v(" 目录下，就能够被 crond 进程读取了")]),s._v(" "),a("li",[s._v("但是最终能不能读到正确的资料，还需要看传统的 rwx 是否符合 Linux 的权限规范")])]),s._v(" "),a("p",[s._v("下面来测试上述说明")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1. 假设你因为不熟悉的缘故，因此是在 root 家目录建立一个如下的 cron 设置")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim checktime")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" * * * * root "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" 60s\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2. 发现文件放错目录了，又不想要保留副本，因此使用 mv 移动到正确的目录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mv checktime /etc/cron.d/")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll /etc/cron.d/checktime ")]),s._v("\n-rw-r--r--. "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("26")]),s._v(" Mar "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":12 /etc/cron.d/checktime\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 权限是 644，任何进程都可以读取")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 3. 强制重新启动 crond，然后查看登录日志")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl restart crond          ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tail /var/log/cron")]),s._v("\nMar "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":01:01 study run-parts"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/etc/cron.hourly"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3889")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": finished mcelog.cron\nMar "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":10:01 study CROND"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3972")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" CMD "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/usr/lib64/sa/sa1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nMar "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":14:01 study crond"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1400")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("((")]),s._v("null"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")])]),s._v(" Unauthorized SELinux "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("context")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("system_u:system_r:system_cronjob_t:s0-s0:c0.c1023 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("file_context")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("unconfined_u:object_r:admin_home_t:s0 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/etc/cron.d/checktime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nMar "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":14:01 study crond"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1400")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" FAILED "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("loading "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cron")]),s._v(" table"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nMar "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":15:08 study crond"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1400")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("CRON"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" INFO "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Shutting down"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nMar "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":15:08 study crond"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4073")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("CRON"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" INFO "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("RANDOM_DELAY will be scaled with factor "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v("% "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" used."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nMar "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":15:08 study crond"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4073")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("((")]),s._v("null"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")])]),s._v(" Unauthorized SELinux "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("context")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("system_u:system_r:system_cronjob_t:s0-s0:c0.c1023 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("file_context")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("unconfined_u:object_r:admin_home_t:s0 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/etc/cron.d/checktime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nMar "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":15:08 study crond"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4073")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" FAILED "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("loading "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cron")]),s._v(" table"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nMar "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":15:08 study crond"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4073")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("CRON"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" INFO "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("running with inotify support"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nMar "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":15:08 study crond"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4073")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("CRON"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" INFO "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("@reboot "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("jobs")]),s._v(" will be run at computer's startup."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 上述日志中有 Unauthorized 的信息，表示有错误，因为原本的安全本文与文件的实际安全本文无法搭配的缘故，")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 信息还列出了 SELinux context 与 file_context 的信息，表示的确不匹配")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br")])]),a("p",[s._v("从如上的测试来看，上述测试由于安全本文不匹配导致进程无法读取该文件")]),s._v(" "),a("h2",{attrs:{id:"selinux-三种模式的启动、关闭与观察"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#selinux-三种模式的启动、关闭与观察"}},[s._v("#")]),s._v(" SELinux 三种模式的启动、关闭与观察")]),s._v(" "),a("p",[s._v("并非所有的 Linux distribution 都支持 SELinux，CentOS 7.x 本身就有支持 SELinux，所以你不需要自行编译 SELinux 到你的 Linux 核心中。目前 SELinux 是否启动有三种模式：")]),s._v(" "),a("ul",[a("li",[s._v("enforcing：强制模式，表示 SELinux 运行中，且已经正确的开始限制 domain/type 了")]),s._v(" "),a("li",[s._v("permissive：宽容模式，表示 SELinux 运行中，不过仅有警告进行并不会实际限制 domain/type 的存取。这种模式可以用来 debug SELinux 的配置")]),s._v(" "),a("li",[s._v("disabled：SELinux 关闭中")])]),s._v(" "),a("p",[s._v("三种模式的示意图如下：")]),s._v(" "),a("p",[a("img",{attrs:{src:n(497),alt:"image-20200317132323274"}})]),s._v(" "),a("p",[s._v("注意：并非有所的进程都受 SELinux 的管控，注意是有 "),a("strong",[s._v("受限的进程主体")]),s._v("，可以通过 "),a("code",[s._v("ps -eZ")]),s._v(" 来观察该进程是否有受限（confined）。下面来观察 crond 与 bash 程序是否有被限制")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ps -eZ | grep -E 'cron|bash'")]),s._v("\nsystem_u:system_r:crond_t:s0-s0:c0.c1023 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1398")]),s._v(" ? 00:00:00 atd\nunconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2353")]),s._v(" pts/0 00:00:00 "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\nunconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2424")]),s._v(" pts/0 00:00:00 "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\nsystem_u:system_r:crond_t:s0-s0:c0.c1023 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4073")]),s._v(" ? 00:00:00 crond\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("因为目前 target 这个政策下，只有第 3 个字段 type 会有影响，因此可以看到 crond 有 "),a("code",[s._v("crond_t")]),s._v(" 类型，是受限的，而 bash 是 "),a("code",[s._v("unconfined_t")]),s._v(" 类型，是不受限的，也就是说 bash 不会经过上图的流程，而直接去判定 rwx")]),s._v(" "),a("p",[s._v("可以通过以下方式获取当前的 SELinux 模式")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# getenforce ")]),s._v("\nEnforcing\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("查询当前 SELinux 的政策（Policy）")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("sestatus "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-vb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n选项与参数：\n\t-v：检查 /etc/sestatus.conf 内的文件与进程的安全性本文内容\n\t-b：将目前政策的规则布尔值列出，即某些规则 rule 是否要启动（0/1）\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 范例 1：列出目前 SELinux 使用的哪个政策 Policy")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sestatus   \t\t")]),s._v("\nSELinux status:                 enabled\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# SELinux 是否启动")]),s._v("\nSELinuxfs mount:                /sys/fs/selinux\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# SELinux 的相关文件数据挂载点")]),s._v("\nSELinux root directory:         /etc/selinux\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# SELinux 的根目录所在")]),s._v("\nLoaded policy name:             targeted\t\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 当前的政策")]),s._v("\nCurrent mode:                   enforcing\t\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 当前模式")]),s._v("\nMode from config file:          enforcing\t\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 目前配置文件内规范的 SELinux 模式")]),s._v("\nPolicy MLS status:              enabled\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否含有 MLS 的模式机制")]),s._v("\nPolicy deny_unknown status:     allowed\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否预设抵挡未知的主体进程")]),s._v("\nMax kernel policy version:      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("上述信息科知道，SELinux 目前的政策是 targeted ，可通过如下方式修改")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /etc/selinux/config ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# This file controls the state of SELinux on the system.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# SELINUX= can take one of these three values:")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     enforcing - SELinux security policy is enforced.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     permissive - SELinux prints warnings instead of enforcing.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     disabled - No SELinux policy is loaded.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SELINUX")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("enforcing\t\t \t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可选择为上述 3 个")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# SELINUXTYPE= can take one of three values:")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     targeted - Targeted processes are protected,")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     minimum - Modification of targeted policy. Only selected processes are protected. ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     mls - Multi Level Security protection.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SELINUXTYPE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("targeted\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可选值为上述 3 个")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("h3",{attrs:{id:"selinux-的启动与关闭"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#selinux-的启动与关闭"}},[s._v("#")]),s._v(" SElinux 的启动与关闭")]),s._v(" "),a("p",[s._v("由于 SElinux 是整合到核心中去的，因此修改上述配置文件之后，需要重新启动。")]),s._v(" "),a("p",[s._v("注意：如果从 disable 转到启动 SELinux 的模式时，由于系统必须要针对文件写入安全性本文信息，因此开机过程需要耗费不少时间等待重新写入 SELinux 安全性本文（有时也称为SELinux Label），而且在写完之后还需要重新启动一次，启动成功之后，再使用 "),a("code",[s._v("getenforce 和 sestatus")]),s._v(" 来观察是否有成功启动到 Enforcing 模式")]),s._v(" "),a("p",[s._v("如果当前已经是 Enforcing 模式，可能由于一些设置问题大道至 SELinux 让某些服务无法正常的运行，此时可将模式修改为宽容模式（permissive），让 SELinux 只发出警告信息")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("setenforce "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n选项与参数：\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("：转成 permissive 宽容模式\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("：转成 Enforcing 强制模式\n注意：无法在 Disabled 模式下进程模式的切换\t\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("某些时候从 Disabled 换成 Enforcing 之后，有部分服务可能无法顺利启动，可能会报错 "),a("code",[s._v("/lib/xxx")]),s._v(" 数据没有权限读取的错误信息。这大多数是由于重新写入 Selinux type（Relabel）出错的原因，使用 Permissive 模式就没有该错误。最简单的办法是在 Permissive 模式下使用指令 "),a("code",[s._v("restorecon -Rv /")]),s._v(" 重新还原所有 SELinux 的类型")]),s._v(" "),a("h2",{attrs:{id:"selinux-政策内的规则管理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#selinux-政策内的规则管理"}},[s._v("#")]),s._v(" SELinux 政策内的规则管理")]),s._v(" "),a("h3",{attrs:{id:"selinux-各个规则的布尔值查询：getsebool"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#selinux-各个规则的布尔值查询：getsebool"}},[s._v("#")]),s._v(" SELinux 各个规则的布尔值查询：getsebool")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("getsebool "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("规则名称"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n选项与参数：\n\t-a：列出目前系统上所有 SELinux 规则的布尔值为开启或关闭（on/off）\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 范例 1：查询所有的布尔值设置")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# getsebool -a")]),s._v("\nabrt_anon_write --"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" off\nabrt_handle_event --"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" off\nabrt_upload_watch_anon_write --"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" on\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\ncron_can_relabel --"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" off\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这个与 cron 有关")]),s._v("\ncron_system_cronjob_use_shares --"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" off\ncron_userdomain_transition --"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" on\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nhttpd_anon_write --"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" off\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 与网页 http 有关")]),s._v("\nhttpd_builtin_scripting --"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" on\nhttpd_can_check_spam --"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" off\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 每一行都是一个规则")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("h3",{attrs:{id:"selinux-各个规则规范的主体进程能够读取的文件-selinux-type-查询-seinfo、sesearch"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#selinux-各个规则规范的主体进程能够读取的文件-selinux-type-查询-seinfo、sesearch"}},[s._v("#")]),s._v(" SELinux 各个规则规范的主体进程能够读取的文件 SELinux type 查询 seinfo、sesearch")]),s._v(" "),a("p",[s._v("上述指令知道了所有的规则开启情况，可以通过 seinfo、sesearch 等工具来查看每个规则具体在限制什么。")]),s._v(" "),a("p",[s._v("上述工具并未预装，"),a("RouterLink",{attrs:{to:"/tutorial-basis/07/03.html#挂载-cd-或-dvd-光盘"}},[s._v("请拿出安装光盘挂载到 /mnt 目录下")]),s._v("，安装")],1),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# blkid ")]),s._v("\n/dev/sr0: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("UUID")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2019-09-11-18-50-31-00"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LABEL")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CentOS 7 x86_64"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("TYPE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"iso9660"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PTTYPE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dos"')]),s._v(" \n/dev/sda1: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("UUID")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"e9d54afb-2afe-42de-87fe-9f55d747fcd9"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("TYPE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xfs"')]),s._v(" \n/dev/sda2: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("UUID")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CNUXwS-J3Lh-0nDA-TssW-l1vT-90us-MHYnT1"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("TYPE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"LVM2_member"')]),s._v(" \n/dev/mapper/centos_study-root: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("UUID")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"d7e09bb4-2f04-4ed4-b377-91a22fe85ce7"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("TYPE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xfs"')]),s._v(" \n/dev/mapper/centos_study-swap: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("UUID")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"684eebc0-3f70-4fc1-9a5d-d683f6a07cd0"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("TYPE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"swap"')]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mount /dev/sr0 /mnt/")]),s._v("\nmount: /dev/sr0 is write-protected, mounting read-only\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# yum install /mnt/Packages/setools-console-*                               ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nComplete"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# umount /mnt/  # 卸载光盘")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("seinfo "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-Atrub"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n选项与参数：\n\t-A：列出 SELinux 的状态、规则布尔值、身份识别、角色、类型等所有信息\n\t-u：列出 SELinux 的所有身份识别 user 种类\n\t-r：列出 SELinux 的所有角色 role 种类\n\t-t：列出 SELinux 的所有类型 "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v(" 种类\n\t-b：列出所有规则的种类（布尔值）\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 范例 1：列出 SELinux 在此政策下的统计状态")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# seinfo ")]),s._v("\n\nStatistics "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" policy file: /sys/fs/selinux/policy\nPolicy Version "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v(" Type: v.31 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("binary, mls"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n   Classes:           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("130")]),s._v("    Permissions:       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("272")]),s._v("\n   Sensitivities:       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("    Categories:       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),s._v("\n   Types:            "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4792")]),s._v("    Attributes:        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("253")]),s._v("\n   Users:               "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("    Roles:              "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v("\n   Booleans:          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("316")]),s._v("    Cond. Expr.:       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("362")]),s._v("\n   Allow:          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("107360")]),s._v("    Neverallow:          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n   Auditallow:        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("157")]),s._v("    Dontaudit:       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10020")]),s._v("\n   Type_trans:      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18129")]),s._v("    Type_change:        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("74")]),s._v("\n   Type_member:        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("35")]),s._v("    Role allow:         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("39")]),s._v("\n   Role_trans:        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("416")]),s._v("    Range_trans:      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5899")]),s._v("\n   Constraints:       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("143")]),s._v("    Validatetrans:       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n   Initial SIDs:       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v("    Fs_use:             "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")]),s._v("\n   Genfscon:          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("103")]),s._v("    Portcon:           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("614")]),s._v("\n   Netifcon:            "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    Nodecon:             "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n   Permissives:         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    Polcap:              "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n   \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 当前政策是 targeted ？ （哪里显示的？），此政策下的 Types 类型有 4792 个")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# SELinux 的规则（Booleans）有 316 条")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br")])]),a("p",[s._v("在前面讲到过几个身份识别 user 与 角色 role，seinfo 可以查询到所有的种类，可自行查询")]),s._v(" "),a("p",[s._v("在前面讲到 "),a("code",[s._v("/etc/cron.d/checktime")]),s._v("  的 SElinux type 类型不太对，我们知道 crond 进程的 type 是 "),a("code",[s._v("crond_t")]),s._v("，那么查找下 "),a("code",[s._v("crond_t")]),s._v(" 能够读取的文件 SELinux type 有哪些")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("sesearch "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-A"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-s 主体类别"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-t 目标类别"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-b 布尔值"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n选项与参数：\n\t-A：列出后面数据中，允许「读取或放行」的相关数据\n\t-t：后面还要接 type、例如 -t httpd_t\n\t-b：后面接 SELinux 的规则，例如 -b httpd_enable_ftp_server\n\t\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 范例 1：找出 crond_t 主体进程能够读取的文件 SELinux type")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sesearch -A -s crond_t | grep spool")]),s._v("\n   allow crond_t var_spool_t "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("dir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" ioctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" getattr lock search "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n   allow crond_t system_cron_spool_t "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("dir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" ioctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" getattr lock search "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n   allow crond_t user_cron_spool_t "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" lnk_file "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" getattr "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n   allow crond_t user_cron_spool_t "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" ioctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("write")]),s._v(" create getattr setattr lock append unlink "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("link")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rename")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n   allow crond_t system_cron_spool_t "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" ioctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("write")]),s._v(" create getattr setattr lock append unlink "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("link")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rename")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n   allow crond_t var_spool_t "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" ioctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" getattr lock "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n   allow crond_t cron_spool_t "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" ioctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("write")]),s._v(" create getattr setattr lock append unlink "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("link")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rename")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n   allow daemon user_cron_spool_t "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" ioctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("write")]),s._v(" getattr lock append "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n   allow crond_t cron_spool_t "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("dir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" ioctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("write")]),s._v(" getattr lock add_name remove_name search "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n   allow crond_t user_cron_spool_t "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("dir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" ioctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("write")]),s._v(" getattr lock add_name remove_name search "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n   allow crond_t user_cron_spool_t "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" ioctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("write")]),s._v(" create getattr setattr lock append unlink "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("link")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rename")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n   allow crond_t system_cron_spool_t "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" ioctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("write")]),s._v(" create getattr setattr lock append unlink "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("link")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rename")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# allow 后面是主体进程以及文件的 SELinux type，上面数据是截取出来的")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# crond_t 可以读取 system_cron_spool_t 的文件/目录类型等")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 范例 2：找出 crond_t 是否能读取 /etc/cron.d/checktime 这个我们自定义的配置文件？")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll -Z /etc/cron.d/checktime ")]),s._v("\n-rw-r--r--. root root unconfined_u:object_r:admin_home_t:s0 /etc/cron.d/checktime\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 两个重点：SELinux type 为 admin_home_t，一个是文件（file）")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sesearch -A -s crond_t | grep admin_home_t")]),s._v("\n   allow domain admin_home_t "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("dir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" getattr search "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n   allow crond_t admin_home_t "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("dir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" ioctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" getattr lock search "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n   allow userdom_filetrans_type admin_home_t "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" lnk_file "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" getattr "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n   allow userdom_filetrans_type admin_home_t "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("dir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" ioctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("write")]),s._v(" getattr lock add_name remove_name search "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n   allow domain admin_home_t "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" lnk_file "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" getattr "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n   allow crond_t admin_home_t "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" lnk_file "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" getattr "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 发现有 crond_t admin_home_t 存在，不过这个是总体的信息")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 没有针对某些规则的查询，所以不能确定 checktime 能否被读取，但是基本上就是 SELinux type 出现问题，才无法读取的")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br")])]),a("p",[s._v("现在知道了 "),a("code",[s._v("/etc/cron.d/checktime")]),s._v(" 是 SELinux type 错误导致无法读取的。看来在 "),a("code",[s._v("getsebool -a")]),s._v(" 中看到的 "),a("code",[s._v("httpd_enable_homedirs")]),s._v(" 是什么？又是规范了哪些主体进程能够读取的 SELinux type")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# semanage boolean -l | grep httpd_enable_homedirs")]),s._v("\nhttpd_enable_homedirs          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("off  ,  off"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  Allow httpd to "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" homedirs\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# httpd_enable_homedirs 的功能是允许 httpd 进程读取用户家目录")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 范例 3：列出该规则中，主体进程能够读取的文件  SELinux type")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sesearch -A -b httpd_enable_homedirs")]),s._v("\nFound "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("77")]),s._v(" semantic av rules:\n   allow httpd_t user_home_type "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" lnk_file "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" getattr "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n   allow httpd_suexec_t user_home_type "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" lnk_file "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" getattr "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n   allow httpd_suexec_t user_home_dir_t "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" lnk_file "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" getattr "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n   allow httpd_t nfs_t "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" lnk_file "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" getattr "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n   allow httpd_sys_script_t nfs_t "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" ioctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" getattr lock "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n   allow httpd_sys_script_t cifs_t "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" lnk_file "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" getattr "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n   allow httpd_user_script_t user_home_type "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" lnk_file "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" getattr "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n   allow httpd_user_script_t user_home_type "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("dir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" getattr search "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n   allow httpd_t cifs_t "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" ioctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" getattr lock "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n   allow httpd_sys_script_t nfs_t "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("dir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" getattr search "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n   allow httpd_sys_script_t nfs_t "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("dir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" ioctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" getattr lock search "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n   allow httpd_sys_script_t nfs_t "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("dir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" getattr search "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n   allow httpd_sys_script_t nfs_t "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("dir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" ioctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" getattr lock search "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n   allow httpd_t user_home_dir_t "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("dir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" getattr search "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n   allow httpd_sys_script_t cifs_t "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" ioctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" getattr lock "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n   allow httpd_sys_script_t user_home_dir_t "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("dir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" getattr search "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n   allow httpd_sys_script_t user_home_dir_t "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" lnk_file "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" getattr "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   xxx\n "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从上面的数据才可以理解，主要是放行 httpd_t 能否读取用户家目录的文件 （笔者这里是懵逼的没有看出来）")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 所以，如果该规则没有启动，基本上 httpd_t 这种进程就无法读取用户家目录下的文件")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br")])]),a("h3",{attrs:{id:"修改-selinux-规则的布尔值-setsebool"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改-selinux-规则的布尔值-setsebool"}},[s._v("#")]),s._v(" 修改 SELinux 规则的布尔值 setsebool")]),s._v(" "),a("p",[s._v("查询到某个 SELinux rule ，并且以 seaserch 知道该规则的用途后，可以通过下面的方式来管理")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("setsebool "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-p"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("规则名称"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n-P：直接将设置值写入配置文件，该设置数据未来会生效\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 范例 1：查询 httpd_enable_homedirs 这个规则的状态，并且修改这个规则为不同的布尔值")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# getsebool httpd_enable_homedirs")]),s._v("\nhttpd_enable_homedirs --"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" off\t\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭状态")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# setsebool -P httpd_enable_homedirs 1\t\t# 开启它")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# getsebool httpd_enable_homedirs")]),s._v("\nhttpd_enable_homedirs --"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" on\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h2",{attrs:{id:"selinux-安全本文的修改"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#selinux-安全本文的修改"}},[s._v("#")]),s._v(" SELinux 安全本文的修改")]),s._v(" "),a("p",[s._v("SELinux 对受限的主体进程没有影响：")]),s._v(" "),a("ol",[a("li",[s._v("考虑 SELinux 的三种类型")]),s._v(" "),a("li",[s._v("考虑 SELinux的政策规则是否放行")]),s._v(" "),a("li",[s._v("比对 SELinux type 关系")])]),s._v(" "),a("p",[s._v("上面讲解过可以通过 sesearch 来找到主体进程与文件的 SELinux type 关系，那么怎么修改文件的 SELinux type，能让主体进程读到呢？")]),s._v(" "),a("h3",{attrs:{id:"使用-chcon-手动修改文件的-selinux-type"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用-chcon-手动修改文件的-selinux-type"}},[s._v("#")]),s._v(" 使用 chcon 手动修改文件的 SELinux type")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("chcon "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-R"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-t type"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-u user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-r role"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" 文件\nchcon "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-R"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" --reference"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("范例文件 文件\n\n选项与参数：\n\t-R：连同该目录下的次目录也同时修改\n\t-t：后面接安全性本文的类型字段，例如 httpd_sys_content_t\n\t-u：后面接身份识别，例如 system_u "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("不重要"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t-r：后面接角色，例如 system_r （不重要）\n\t-v：若有变化成功，将变动的结果列出来\n\t--reference"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("文件：拿某个文件档范例来修改后续接的文件的类型\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 范例 1：查询 /etc/hosts 的 SELinux type，并将该类型套用到 /etc/cron.d/checktime 上")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll -Z /etc/hosts")]),s._v("\n-rw-r--r--. root root system_u:object_r:net_conf_t:s0  /etc/hosts\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# net_conf_t 是上面文件中的类型")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# chcon -v -t net_conf_t /etc/cron.d/checktime ")]),s._v("\nchanging security context of "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/etc/cron.d/checktime'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll -Z /etc/cron.d/checktime ")]),s._v("\n-rw-r--r--. root root unconfined_u:object_r:net_conf_t:s0 /etc/cron.d/checktime\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 范例 2：直接以 /etc/shadow 的 type 套用")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# chcon -v --reference=/etc/shadow /etc/cron.d/checktime")]),s._v("\nchanging security context of "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/etc/cron.d/checktime'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll -Z /etc/shadow /etc/cron.d/checktime ")]),s._v("\n-rw-r--r--. root root system_u:object_r:shadow_t:s0    /etc/cron.d/checktime\n----------. root root system_u:object_r:shadow_t:s0    /etc/shadow\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("p",[s._v("上面的示例并不能解决 crond 不能读取 "),a("code",[s._v("/etc/cron.d/checktime")]),s._v(" 的问题，因为需要改成 "),a("code",[s._v("/etc/cron.d")]),s._v(" 下的标准 type 才行。可以使用 restorecon 来让 SELinux 自己默认解决目录下的 type 问题")]),s._v(" "),a("h3",{attrs:{id:"使用-restorecon-让文件恢复正确的-selinux-type"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用-restorecon-让文件恢复正确的-selinux-type"}},[s._v("#")]),s._v(" 使用 restorecon 让文件恢复正确的 SELinux type")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("restorecon "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-Rv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" 文件或目录\n\n选项与参数：\n\t-R：连同次目录一起修改\n\t-v：将过程显示到屏幕上\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 范例 3：将 /etc/cron.d/ 下的文件都恢复成预设的 SELinux type")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# restorecon -Rv /etc/cron.d/")]),s._v("\nrestorecon reset /etc/cron.d/checktime context system_u:object_r:shadow_t:s0-"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("system_u:object_r:system_cron_spool_t:s0\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 上面将  shadow_t 改成了 system_cron_spool_t 类型")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 范例 4：重新启动 crond 看看有没有正确启动 checktime")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl restart crond          ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tail /var/log/cron")]),s._v("\nMar "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":01:01 study CROND"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5886")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" CMD "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("run-parts /etc/cron.hourly"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nMar "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":01:01 study run-parts"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/etc/cron.hourly"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5886")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": starting 0anacron\nMar "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":01:01 study run-parts"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/etc/cron.hourly"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5898")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": finished 0anacron\nMar "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":01:01 study run-parts"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/etc/cron.hourly"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5886")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": starting mcelog.cron\nMar "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":01:01 study run-parts"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/etc/cron.hourly"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5904")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": finished mcelog.cron\nMar "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":10:01 study CROND"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5989")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" CMD "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/usr/lib64/sa/sa1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nMar "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":12:48 study crond"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4073")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("CRON"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" INFO "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Shutting down"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nMar "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":12:48 study crond"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6068")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("CRON"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" INFO "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("RANDOM_DELAY will be scaled with factor "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("62")]),s._v("% "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" used."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nMar "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":12:49 study crond"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6068")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("CRON"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" INFO "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("running with inotify support"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nMar "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":12:49 study crond"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6068")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("CRON"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" INFO "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("@reboot "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("jobs")]),s._v(" will be run at computer's startup."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 没有报错信息")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br")])]),a("p",[s._v("从这里看来 restorecon 很方便，chcon 还是比较麻烦的")]),s._v(" "),a("h3",{attrs:{id:"semanage-默认目录的安全性本文查询与修改"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#semanage-默认目录的安全性本文查询与修改"}},[s._v("#")]),s._v(" semanage 默认目录的安全性本文查询与修改")]),s._v(" "),a("p",[s._v("为什么 restorecon 可以恢复原本的 SELinux type 呢？那一定是有个地方在记录每个文件/目录的 SELinux 默认类型")]),s._v(" "),a("ol",[a("li",[s._v("如何查询预设的 SELinux type")]),s._v(" "),a("li",[s._v("如何增加、修改、删除 预设的 SELinux type")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("semanage "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("login"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("user"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("interface"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("fcontext"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("translation"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" -l\nsemanage fcontext -"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("a"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("d"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-frst"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" file_spec\n\n选项与参数：\n\tfcontext：主要用在安全性本文方面的用途， -l 为查询\n\t-a：增加；可以增加一些目录的默认安全性本文类型设置\n\t-m：修改\n\t-d：删除\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 范例 1：查询 /etc/   /etc/cron.d/ 的预设 SELinux type")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# semanage fcontext -l | grep -E '^/etc |^/etc/cron'")]),s._v("\n/etc/cron.daily"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/.*"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("?                              all files          system_u:object_r:bin_t:s0 \n/etc/cron.weekly"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/.*"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("?                             all files          system_u:object_r:bin_t:s0 \n/etc/cron.hourly"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/.*"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("?                             all files          system_u:object_r:bin_t:s0 \n/etc/cron.monthly"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/.*"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("?                            all files          system_u:object_r:bin_t:s0 \n/etc/cron.minutely/openshift-facts                 regular "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("       system_u:object_r:openshift_cron_exec_t:s0 \n/etc/cron"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("daily"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("monthly"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("/acct                    regular "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("       system_u:object_r:acct_exec_t:s0 \n/etc/cron"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("daily"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("weekly"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("/sysklogd                 regular "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("       system_u:object_r:logrotate_exec_t:s0 \n/etc/cron"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("daily"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("monthly"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("/mailman                 regular "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("       system_u:object_r:mailman_queue_exec_t:s0 \n/etc/cron"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("daily"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("weekly"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("/man-db.*                 regular "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("       system_u:object_r:mandb_exec_t:s0 \n/etc/cron"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("daily"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("monthly"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("/radiusd                 regular "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("       system_u:object_r:radiusd_exec_t:s0 \n/etc/cron"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("daily"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("weekly"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("/ntp-simple               regular "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("       system_u:object_r:ntpd_exec_t:s0 \n/etc/cron"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("daily"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("weekly"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("/ntp-server               regular "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("       system_u:object_r:ntpd_exec_t:s0 \n/etc/cron"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("."),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("((")]),s._v("daily"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("weekly"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("monthly"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")])]),s._v("/freeradius regular "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("       system_u:object_r:radiusd_exec_t:s0 \n/etc/cron"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(".d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/.*"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("?                                 all files          system_u:object_r:system_cron_spool_t:s0 \n/etc/cron"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(".daily/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("sm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("locate                        regular "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("       system_u:object_r:locate_exec_t:s0 \n/etc/cron"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(".weekly/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("?fingerd                      regular "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("       system_u:object_r:fingerd_exec_t:s0 \n/etc                                               all files          system_u:object_r:etc_t:s0 \n/etc/crontab                                       regular "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("       system_u:object_r:system_cron_spool_t:s0 \n/etc/cron"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(".daily/prelink                           regular "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("       system_u:object_r:prelink_cron_system_exec_t:s0 \n/etc/cron"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(".daily/calamaris                         regular "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("       system_u:object_r:calamaris_exec_t:s0 \n/etc/cron"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(".daily/certwatch                         regular "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("       system_u:object_r:certwatch_exec_t:s0 \n/etc/cron"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(".monthly/proftpd                         regular "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("       system_u:object_r:ftpd_exec_t:s0\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br")])]),a("p",[s._v("看 "),a("code",[s._v("/etc/cron\\.d(/.*)? all files system_u:object_r:system_cron_spool_t:s0")]),s._v("  这一行，这也是为什么直接使用 vim 在 "),a("code",[s._v("/etc/cron.d")]),s._v(" 下新建文件时，预设 SELinux type 是正确的。")]),s._v(" "),a("p",[s._v("练习：下面要建立一个 "),a("code",[s._v("/srv/mycron")]),s._v(" 目录，默认也是需要变成 "),a("code",[s._v("system_cron_spool_t")]),s._v(" 时")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1. 先建立 mycron 目录，再放入配置文件，观察 SELinux type")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mkdir /srv/mycron")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cp /etc/cron.d/checktime /srv/mycron/")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll -dZ /srv/mycron/ /srv/mycron/checktime ")]),s._v("\ndrwxr-xr-x. root root unconfined_u:object_r:var_t:s0   /srv/mycron/\n-rw-r--r--. root root unconfined_u:object_r:var_t:s0   /srv/mycron/checktime\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 发现变成了 var_t")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2. 观察上层 /srv 的 SELinux type")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# semanage fcontext -l | grep '^/srv'")]),s._v("\n/srv/.*                                            all files          system_u:object_r:var_t:s0 \n/srv/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("^/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("*/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("?www"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/.*"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("?                            all files          system_u:object_r:httpd_sys_content_t:s0 \n/srv/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("^/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("*/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("?ftp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/.*"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("?                            all files          system_u:object_r:public_content_t:s0 \n/srv/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("^/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("*/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("?rsync"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/.*"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("?                          all files          system_u:object_r:public_content_t:s0 \n/srv/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("^/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("*/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("?www/logs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/.*"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("?                       all files          system_u:object_r:httpd_log_t:s0 \n/srv/node"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/.*"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("?                                    all files          system_u:object_r:swift_data_t:s0 \n/srv/gallery2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/.*"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("?                                all files          system_u:object_r:httpd_sys_content_t:s0 \n/srv/lib/gitosis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/.*"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("?                             all files          system_u:object_r:gitosis_var_lib_t:s0 \n/srv/gallery2/smarty"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/.*"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("?                         all files          system_u:object_r:httpd_sys_rw_content_t:s0 \n/srv/loopback-device"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/.*"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("?                         all files          system_u:object_r:swift_data_t:s0 \n/srv                                               all files          system_u:object_r:var_t:s0\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可以看到这里默认就是  var_t 类型的")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 3. 将 mycron 默认值改为 system_cron_spool_t")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# semanage fcontext -a -t system_cron_spool_t "/srv/mycron(/.*)?"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# semanage fcontext -l | grep '^/srv/mycron'")]),s._v("\n/srv/mycron"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/.*"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("?                                  all files          system_u:object_r:system_cron_spool_t:s0 \n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 4. 回复 /srv/mycron 以及子目录相关的 SELinux type")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# restorecon -Rv /srv/mycron/")]),s._v("\nrestorecon reset /srv/mycron context unconfined_u:object_r:var_t:s0-"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("unconfined_u:object_r:system_cron_spool_t:s0\nrestorecon reset /srv/mycron/checktime context unconfined_u:object_r:var_t:s0-"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("unconfined_u:object_r:system_cron_spool_t:s0\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br")])]),a("p",[s._v("通过这个例子来看，restorecon 的确是很方便 ，学会这些基础的工具，对于 SELinux 来说基本上也够用了")]),s._v(" "),a("h2",{attrs:{id:"一个网络服务案例及登录文件协助"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一个网络服务案例及登录文件协助"}},[s._v("#")]),s._v(" 一个网络服务案例及登录文件协助")]),s._v(" "),a("p",[s._v("本章在 SELinux 小节中介绍到的各个指令，尤其是 setsebool、chcon、restorecon 等都是为了当你的某些网络服务无法正常提供相关功能时，才需要进行修改的一些指令动作。")]),s._v(" "),a("p",[s._v("可以通过主动检查的方式来检查是否有 SELinux 产生的错误。而不是等客户端联机失败来反馈")]),s._v(" "),a("h3",{attrs:{id:"setroubleshoot：错误信息写入-var-log-messages"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#setroubleshoot：错误信息写入-var-log-messages"}},[s._v("#")]),s._v(" setroubleshoot：错误信息写入 "),a("code",[s._v("/var/log/messages")])]),s._v(" "),a("p",[s._v("几乎所有 SELinux 相关的程序都是以 se 开头，该服务时错误克服，启动后，会将关于 SELinux 的错误信息与克服方法记录到 "),a("code",[s._v("/var/log/messages")]),s._v(" 与 "),a("code",[s._v("/var/log/setroubleshoot/*")]),s._v(" 中")]),s._v(" "),a("p",[s._v("需要安装：setroubleshoot 与 setroubleshoot-server。原本 SELinux 信息是两个服务来记录的，分别是 auditd 与 setroubleshoot。在 CentOS 6.x 起整合成 auditd 了。所以安装好 setroubleshoot-server 后，需要重新启动 auditd 服务，否则 setroubleshoot 功能不会被启动")]),s._v(" "),a("p",[s._v("实际上。CentOS 7.x 对 setroubleshoot 的运行方式是：先由 auditd 去呼叫 audispd 服务，然后 audispd 服务启动 sedispatch 程序， sedispatch 再将原本的 auditd 信息转成 setroubleshoot 的信息，存储下来")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rpm -qa | grep setroubleshoot")]),s._v("\nsetroubleshoot-3.2.30-7.el7.x86_64\nsetroubleshoot-plugins-3.0.67-4.el7.noarch\nsetroubleshoot-server-3.2.30-7.el7.x86_64\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("在预设的情况下 setroubleshoot 被安装了，记得刚安装 setroubleshoot 的话，需要重新启动 auditd 服务的、")]),s._v(" "),a("p",[s._v("目前我们没有任何受限的网络服务主体进程在运行，下面使用一个简单的 FTP 服务器软件示例，来了解上面讲到的许多重点应用")]),s._v(" "),a("h3",{attrs:{id:"实例说明：通过-vsftpd-这个-ftp-服务器来存取系统上的文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实例说明：通过-vsftpd-这个-ftp-服务器来存取系统上的文件"}},[s._v("#")]),s._v(" 实例说明：通过 vsftpd 这个 FTP 服务器来存取系统上的文件")]),s._v(" "),a("p",[s._v("在 CentOS 7.x 环境下， FTP 的默认服务器软件主要是 vsftpd")]),s._v(" "),a("p",[s._v("详细的 FTP 协议在服务器篇讲解，这里简单利用 vsftpd 与 FTP 的协议来讲解 SELinux 的问题与错误克服。")]),s._v(" "),a("p",[s._v("下面只接受一些简单的 FTP  知识：客户端需要使用 FTP 账户登录 FTP 服务器，有一个称为「匿名 （anonymous）」的账户可以登录系统，但是这个匿名的账户登录后，只能存取一个特定的目录，而无法脱离该目录")]),s._v(" "),a("p",[s._v("在 vsftpd 中，一般用户与匿名者的家目录说明如下：")]),s._v(" "),a("ul",[a("li",[s._v("匿名者：如果使用浏览器来联机到 FTP 服务器，那预设就是使用匿名者登录系统。匿名者的家目录默认是在 "),a("code",[s._v("/var/ftp")]),s._v(" 中，同时，匿名者在家目录下只能下载数据，不能上传数据到 FTP 服务器，同时匿名者无法离开 FTP 服务器的 "),a("code",[s._v("/var/ftp")]),s._v(" 目录")]),s._v(" "),a("li",[s._v("一般 FTP 账户：在预设情况下，所有 UID 大于 1000 的账户，都可以使用 FTP 来登录系统，登录系统后，所有的账户都能够取得自己家目录下的文件数据，预设也可以上传、下载文件的")])]),s._v(" "),a("p",[s._v("为了避免与之前章节的用户产生误解情况，创建一个名为 ftptest 的账户，且账户密码为 myftp123")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# useradd -s /sbin/nologin ftptest")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# echo "myftp123" | passwd --stdin ftptest')]),s._v("\nChanging password "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" user ftptest.\npasswd: all authentication tokens updated successfully.\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("下面来安装 vsftp 服务器软件（还是在光盘中安装，前面挂载那样）")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# yum install /mnt/Packages/vsftpd-3*                    ")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl start vsftpd\t\t# 启动 vsftpd 服务")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl enable vsftpd\t\t# 设置为开机启动")]),s._v("\nCreated symlink from /etc/systemd/system/multi-user.target.wants/vsftpd.service to /usr/lib/systemd/system/vsftpd.service.\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# netstat -tlnp")]),s._v("\nActive Internet connections "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("only servers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nProto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    \ntcp        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:631           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:*               LISTEN      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1374")]),s._v("/cupsd          \ntcp        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:25            "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:*               LISTEN      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1578")]),s._v("/master         \ntcp        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:6010          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:*               LISTEN      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2350")]),s._v("/sshd: mrcode@p \ntcp        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:111             "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:*               LISTEN      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/systemd           \ntcp        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".122.1:53        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:*               LISTEN      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1975")]),s._v("/dnsmasq        \ntcp        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:22              "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:*               LISTEN      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1378")]),s._v("/sshd           \ntcp6       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" ::1:631                 :::*                    LISTEN      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1374")]),s._v("/cupsd          \ntcp6       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" ::1:25                  :::*                    LISTEN      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1578")]),s._v("/master         \ntcp6       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" ::1:6010                :::*                    LISTEN      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2350")]),s._v("/sshd: mrcode@p \ntcp6       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" :::111                  :::*                    LISTEN      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/systemd           \ntcp6       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" :::21                   :::*                    LISTEN      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6656")]),s._v("/vsftpd         \ntcp6       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" :::22                   :::*                    LISTEN      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1378")]),s._v("/sshd\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可以看到   6656/vsftpd 这行数据，代表已经启动了")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br")])]),a("h3",{attrs:{id:"匿名者无法下载的问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#匿名者无法下载的问题"}},[s._v("#")]),s._v(" 匿名者无法下载的问题")]),s._v(" "),a("p",[s._v("模拟一些 FTP 的常用状态，假设将 "),a("code",[s._v("/etc/securetty")]),s._v(" 以及主要的 "),a("code",[s._v("/etc/sysctl.conf")]),s._v(" 放置给所有人下载，那么可以能会这样做")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cp -a /etc/securetty /etc/sysctl.conf /var/ftp/pub")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll /var/ftp/pub/")]),s._v("\ntotal "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("\n-rw-------. "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("221")]),s._v(" Oct "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v(" securetty\n-rw-r--r--. "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("449")]),s._v(" Aug  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v(" sysctl.conf\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("一般来说，默认要给用户下载的 FTP 文件会放在 "),a("code",[s._v("/var/ftp/pub")]),s._v(" 目录中。下面使用简单的终端机浏览器 curl 来观察")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1. 查看 FTP 根目录下有哪些内容")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl ftp://localhost")]),s._v("\ndrwxr-xr-x    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("              "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("42")]),s._v(" Mar "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" 09:03 pub\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 确实看到了 pub 目录")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2. 查看 pub 目录内的内容")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl ftp://localhost/pub")]),s._v("\ncurl: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("78")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" RETR response: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("550")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 无法访问，是因为 pub 是一个目录需要后缀 / 结尾")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl ftp://localhost/pub/")]),s._v("\n-rw-------    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("             "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("221")]),s._v(" Oct "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v(" securetty\n-rw-r--r--    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("             "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("449")]),s._v(" Aug 08  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v(" sysctl.conf\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 3. 查看里面的文件内容")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl ftp://localhost/pub/sysctl.conf")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sysctl settings are defined through files in")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /usr/lib/sysctl.d/, /run/sysctl.d/, and /etc/sysctl.d/.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Vendors settings live in /usr/lib/sysctl.d/.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# To override a whole file, create a new file with the same in")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /etc/sysctl.d/ and put new settings there. To override")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# only specific settings, add a file with a lexically later")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# name in /etc/sysctl.d/ and put new settings there.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# For more information, see sysctl.conf(5) and sysctl.d(5).")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 上面不是错误信息，是哪个文件的内容")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 4. 继续查看下一个文件内容")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl ftp://localhost/pub/securetty  ")]),s._v("\ncurl: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("78")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" RETR response: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("550")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这里看不到了，但是 securetty 的确是一个文件而不是一个目录，基本原因应该是权限问题")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 因为 vsftpd 默认放在 /var/ftp/pub 内的资料，无论什么 SELinux type 几乎都可以被读取才对")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 5. 修正权限后，再观察一次 securetty 文件")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll /var/ftp/pub/")]),s._v("\ntotal "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("\n-rw-------. "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("221")]),s._v(" Oct "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v(" securetty\n-rw-r--r--. "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("449")]),s._v(" Aug  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v(" sysctl.conf\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可以看到 securetty 的其他人权限没有。改变成其他人也可以读取")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# chmod a+r /var/ftp/pub/securetty ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl ftp://localhost/pub/securetty")]),s._v("\nconsole\nvc/1\nvc/2\nvc/3\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 此时已经能看到文件内容了")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 6. 修正 SELinux type 的内容（非必须）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# restorecon -Rv /var/ftp/")]),s._v("\nrestorecon reset /var/ftp/pub/securetty context system_u:object_r:etc_runtime_t:s0-"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("system_u:object_r:public_content_t:s0\nrestorecon reset /var/ftp/pub/sysctl.conf context system_u:object_r:system_conf_t:s0-"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("system_u:object_r:public_content_t:s0\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br")])]),a("p",[s._v("上述列子告诉我们，要先从权限角度来检查，如果无法被读取 ，可能是因为没有 r 或则没有 rx 权限，并不一定是 SELinux 引起的。下面看看用一般账户登录")]),s._v(" "),a("h3",{attrs:{id:"无法从家目录下载文件的问题分析与解决"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#无法从家目录下载文件的问题分析与解决"}},[s._v("#")]),s._v(" 无法从家目录下载文件的问题分析与解决")]),s._v(" "),a("p",[s._v("由于通过一般账户，前面建立的 ftptest 账户登录的话，文字型的 FTP 客户端软件，默认会将用户引导在根目录，而不是家目录，因此，访问的 URL 需要更改一下")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 0. 在 ftptest 家目录下创建一些数据")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# echo  ~ftptest/")]),s._v("\n/home/ftptest/\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# echo "testing" >  ~ftptest/test.txt')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cp -a /etc/hosts /etc/sysctl.conf ~ftptest/")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll ~ftptest/")]),s._v("\ntotal "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("\n-rw-r--r--. "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("158")]),s._v(" Jun  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2013")]),s._v(" hosts\n-rw-r--r--. "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("449")]),s._v(" Aug  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v(" sysctl.conf\n-rw-r--r--. "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" Mar "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(":23 test.txt\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1. 一般账户直接登录 FTP 服务器，同时变换目录到家目录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl ftp://ftptest:myftp123@localhost/~/")]),s._v("\ncurl: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("67")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" Access denied: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("530")]),s._v("\t\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这里报错了")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 注意：书上在增加 ftptest 用户的时候，使用的是 /sbin/nologin，就无法访问 ftp，这里修改下，就可以了")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# usermod -s  /bin/bash ftptest")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl ftp://ftptest:myftp123@localhost/~/")]),s._v("\n-rw-r--r--    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("             "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("158")]),s._v(" Jun 07  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2013")]),s._v(" hosts\n-rw-r--r--    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("             "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("449")]),s._v(" Aug 08  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v(" sysctl.conf\n-rw-r--r--    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("               "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" Mar "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" 09:23 test.txt\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 看左边的权限也是没有问题的")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从这里开始，笔者的实验和书上的结果对不上了，下面只记录书上的操作指令")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 就是因为上面修改用户的 bash 后，虽然可以访问了，但是下面的却可以下载文件，无法达到和书上的效果一样")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2. 下载上面可以阅读的权限文件")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl ftp://ftptest:myftp123@localhost/~/test.txt")]),s._v("\ncurl:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("78")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" RETR response:550\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 无法访下载，是否是 SELinux 造成的？")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 3. 将 SELinux 从 Enforce 转成 Permissive ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# setenforce 0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl ftp://ftptest:myftp123@localhost/~/test.txt")]),s._v("\ntesting\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# setenforce 1\t# 确定是 SELinux 权限问题后，改回来")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 需要该规则还是该 type？现在不知道")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 所以先查询下登录日志有没有相关的信息提供给我们处理")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /var/log/messages")]),s._v("\nAug "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" 02:55:58 station3-39 setroubleshoot:SELinux is preventing /usr/sbin/vsftpd\n\tfrom lock access on the "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" /home/ftptest/test.txt. For complete SELinux messages.\n\trun sealert -l 3axxxxxxxx\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 之类的字样，关键词就是 sealert ，执行这条命令")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sealert -l 3axxxxxxxx")]),s._v("\nSELinux is preventing /usr/sbin/vsftpd from lock access on the "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" /home/ftptest/test/txt.\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下面说有 47.5% 的几率是由于这个原因所发生，并且可以使用 setsebool 去解决的意思")]),s._v("\n******* Plugin catchall_boolean"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("47.5")]),s._v(" confidence"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" suggests ********\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" you want to allow "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ftp")]),s._v(" to home "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("dir")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nDo\nsetsebool -P ftp_home_dir "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n\n******* Plugin catchall"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(".38confidence"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" suggests ********\nDO\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# grep vsftpd /var/log/audit/audit.log | audit2allow -M mypol")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# semodule -i mypol.pp")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下面就重要了，是整个问题发生的主要原因")]),s._v("\nAdditional Information:\nSource Context\tsystem_u:system_r:ftpd_t:s0-s0:c0.c1023\nTarget Context\tunconfined_u:object_r:user_home_t:s0\nTarget Objects\t/home/ftptest/test/txt "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br")])]),a("p",[s._v("通过上面的测试，知道主要的问题发生在 SElinux 的 type 不是 vsftpd_t 所能读取的原因，上面 47.5 的概率问题，ftp_home_dir 是 SELinux rules 的配置")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1. 确认下 SELinux 的模式，并且无法访问")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# getenforce ")]),s._v("\nEnforcing\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl ftp://ftptest:myftp123@localhost/~/test.txt")]),s._v("\ncurl:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("78")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" RETR response:550\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# setsebool -P ftp_home_dir 1")]),s._v("\nBoolean ftp_home_dir is not defined\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可惜笔者这里提示没有被定义，与书上对不上啊")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h3",{attrs:{id:"一般账户用户从非正规目录上传-下载文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一般账户用户从非正规目录上传-下载文件"}},[s._v("#")]),s._v(" 一般账户用户从非正规目录上传/下载文件")]),s._v(" "),a("p",[s._v("提供 "),a("code",[s._v("/srv/gogogo")]),s._v(" 目录给 ftptest 用户使用，该如何处理？假设不考虑 SELiunx 的话，就是如下方式")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1. 处理好所需要的目录数据")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mkdir /srv/gogogo")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# chgrp ftptest /srv/gogogo/")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 把用户组改成 ftptest 这个组")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll -d /srv/gogogo/")]),s._v("\ndrwxr-xr-x. "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" root ftptest "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("月  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":43 /srv/gogogo/\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# echo "test" > /srv/gogogo/test.txt')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl ftp://ftptest:myftp123@localhost//srv/gogogo/test.txt")]),s._v("\ncurl: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("78")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" RETR response: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("550")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 访问不了，查看日志")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# grep sealert /var/log/messages | tail")]),s._v("\nMar "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":46:35 study setroubleshoot: SELinux is preventing /usr/sbin/vsftpd from "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" access on the "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" test.txt. For complete SELinux messages run: sealert -l 88f08c09-c510-4518-bbcc-58bcee06ffb0\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sealert -l 88f08c09-c510-4518-bbcc-58bcee06ffb0")]),s._v("\nSELinux is preventing /usr/sbin/vsftpd from "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" access on the "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" test.txt.\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 虽然这个可信度很高，不过，因为会全部方向 FTP，所以不考虑")]),s._v("\n*****  Plugin catchall_boolean "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("57.6")]),s._v(" confidence"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" suggests   ******************\n\nIf you want to allow ftpd to full access\nThen you must tell SELinux about this by enabling the "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ftpd_full_access'")]),s._v(" boolean.\n\nDo\nsetsebool -P ftpd_full_access "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 因为是非正规目录的使用，所以这边加上预设 SELinux type 恐怕能解决")]),s._v("\n*****  Plugin catchall_labels "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("36.2")]),s._v(" confidence"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" suggests   *******************\n\nIf you want to allow vsftpd to have "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" access on the test.txt "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("\nThen you need to change the label on test.txt\nDo\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下面这一条数据")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# semanage fcontext -a -t FILE_TYPE 'test.txt'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(" 很多数据\nThen execute:\nrestorecon -v "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'test.txt'")]),s._v("\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 还有这一条数据，都是要参考的解决方案")]),s._v("\n\n*****  Plugin catchall "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7.64")]),s._v(" confidence"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" suggests   **************************\n\nIf you believe that vsftpd should be allowed "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" access on the test.txt "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" by default.\nThen you should report this as a bug.\nYou can generate a "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v(" policy module to allow this access.\nDo\nallow this access "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" now by executing:\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ausearch -c 'vsftpd' --raw | audit2allow -M my-vsftpd")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# semodule -i my-vsftpd.pp")]),s._v("\n\n\nAdditional Information:\nSource Context                system_u:system_r:ftpd_t:s0-s0:c0.c1023\nTarget Context                unconfined_u:object_r:var_t:s0\nTarget Objects                test.txt "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nSource                        vsftpd\nSource Path                   /usr/sbin/vsftpd\nPort                          "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Unknown"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nHost                          study.centos.mrcode\nSource RPM Packages           \nTarget RPM Packages           \nPolicy RPM                    selinux-policy-3.13.1-252.el7.noarch\nSelinux Enabled               True\nPolicy Type                   targeted\nEnforcing Mode                Enforcing\nHost Name                     study.centos.mrcode\nPlatform                      Linux study.centos.mrcode "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.10")]),s._v(".0-1062.el7.x86_64\n                              "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#1 SMP Wed Aug 7 18:08:02 UTC 2019 x86_64 x86_64")]),s._v("\nAlert Count                   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\nFirst Seen                    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-03-17 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":46:17 CST\nLast Seen                     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-03-17 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":46:32 CST\nLocal ID                      88f08c09-c510-4518-bbcc-58bcee06ffb0\n\nRaw Audit Messages\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("AVC "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("msg")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("audit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1584456392.386")]),s._v(":979"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": avc:  denied  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("pid")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10979")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("comm")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"vsftpd"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test.txt"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dev")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dm-0"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ino")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("35108539")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("scontext")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("system_u:system_r:ftpd_t:s0-s0:c0.c1023 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("tcontext")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("unconfined_u:object_r:var_t:s0 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("tclass")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("file "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("permissive")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\n\nHash: vsftpd,ftpd_t,var_t,file,read\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 3. 查看 /var/ftp 的 SELinux type")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  ll -Zd /var/ftp/")]),s._v("\ndrwxr-xr-x. root root system_u:object_r:public_content_t:s0 /var/ftp/\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  ll -Zd /srv/gogogo/")]),s._v("\ndrwxr-xr-x. root ftptest unconfined_u:object_r:var_t:s0   /srv/gogogo/\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 4. 以 sealert 建议的方法来处理好 SELinux type")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# semanage fcontext -a -t public_content_t '/srv/gogogo(/.*)?'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# restorecon -Rv /srv/gogogo")]),s._v("\nrestorecon reset /srv/gogogo context unconfined_u:object_r:var_t:s0-"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("unconfined_u:object_r:public_content_t:s0\nrestorecon reset /srv/gogogo/test.txt context unconfined_u:object_r:var_t:s0-"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("unconfined_u:object_r:public_content_t:s0\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 再次访问就可以了")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl ftp://ftptest:myftp123@localhost//srv/gogogo/test.txt")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br"),a("span",{staticClass:"line-number"},[s._v("77")]),a("br"),a("span",{staticClass:"line-number"},[s._v("78")]),a("br"),a("span",{staticClass:"line-number"},[s._v("79")]),a("br"),a("span",{staticClass:"line-number"},[s._v("80")]),a("br"),a("span",{staticClass:"line-number"},[s._v("81")]),a("br"),a("span",{staticClass:"line-number"},[s._v("82")]),a("br"),a("span",{staticClass:"line-number"},[s._v("83")]),a("br"),a("span",{staticClass:"line-number"},[s._v("84")]),a("br"),a("span",{staticClass:"line-number"},[s._v("85")]),a("br"),a("span",{staticClass:"line-number"},[s._v("86")]),a("br"),a("span",{staticClass:"line-number"},[s._v("87")]),a("br"),a("span",{staticClass:"line-number"},[s._v("88")]),a("br"),a("span",{staticClass:"line-number"},[s._v("89")]),a("br"),a("span",{staticClass:"line-number"},[s._v("90")]),a("br")])]),a("p",[s._v("在这个范例中，修改的是 type，前一个范例中修改的是 rule，不太一样的")]),s._v(" "),a("h3",{attrs:{id:"无法变更-ftp-联机端口问题分析解决"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#无法变更-ftp-联机端口问题分析解决"}},[s._v("#")]),s._v(" 无法变更 FTP 联机端口问题分析解决")]),s._v(" "),a("p",[s._v("比如你想要改变 FTP 默认的启动端口 21 改成 555，基本上，既然 SELinux 的主体进程大多是被受限的网络服务，很有可能连端口也限制了，下面尝试修改端口，来查看是怎么解决问题的")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1. 先处理 vsftpd 的配置文件，加入 port 的端口参数")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /etc/vsftpd/vsftpd.conf ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("listen_port")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("555")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2. 重启服务，并查看日志")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl restart vsftpd")]),s._v("\nJob "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" vsftpd.service failed because the control process exited with error code. See "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"systemctl status vsftpd.service"')]),s._v(" and "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"journalctl -xe"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" details.\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# grep sealert /var/log/messages")]),s._v("\nMar "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":03:23 study setroubleshoot: SELinux is preventing /usr/sbin/vsftpd from name_bind access on the tcp_socket port "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("555")]),s._v(". For complete SELinux messages run: sealert -l e3e3dee0-83eb-4cb8-b894-8be590fee082\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sealert -l e3e3dee0-83eb-4cb8-b894-8be590fee082")]),s._v("\nSELinux is preventing /usr/sbin/vsftpd from name_bind access on the tcp_socket port "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("555")]),s._v(".\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这个 92.2 的概率，基本上就是这个了")]),s._v("\n*****  Plugin bind_ports "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("92.2")]),s._v(" confidence"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" suggests   ************************\n\nIf you want to allow /usr/sbin/vsftpd to "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("bind")]),s._v(" to network port "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("555")]),s._v("\nThen you need to modify the port type.\nDo\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# semanage port -a -t PORT_TYPE -p tcp 555")]),s._v("\n    where PORT_TYPE is one of the following: certmaster_port_t, cluster_port_t, ephemeral_port_t, ftp_data_port_t, ftp_port_t, hadoop_datanode_port_t, hplip_port_t, isns_port_t, port_t, postgrey_port_t, unreserved_port_t.\n\n*****  Plugin catchall_boolean "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7.83")]),s._v(" confidence"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" suggests   ******************\n\nIf you want to allow nis to enabled\nThen you must tell SELinux about this by enabling the "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'nis_enabled'")]),s._v(" boolean.\n\nDo\nsetsebool -P nis_enabled "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n\n*****  Plugin catchall "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.41")]),s._v(" confidence"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" suggests   **************************\n\nIf you believe that vsftpd should be allowed name_bind access on the port "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("555")]),s._v(" tcp_socket by default.\nThen you should report this as a bug.\nYou can generate a "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v(" policy module to allow this access.\nDo\nallow this access "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" now by executing:\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ausearch -c 'vsftpd' --raw | audit2allow -M my-vsftpd")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# semodule -i my-vsftpd.pp")]),s._v("\n\n\nAdditional Information:\nSource Context                system_u:system_r:ftpd_t:s0-s0:c0.c1023\nTarget Context                system_u:object_r:hi_reserved_port_t:s0\nTarget Objects                port "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("555")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" tcp_socket "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nSource                        vsftpd\nSource Path                   /usr/sbin/vsftpd\nPort                          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("555")]),s._v("\nHost                          study.centos.mrcode\nSource RPM Packages           vsftpd-3.0.2-25.el7.x86_64\nTarget RPM Packages           \nPolicy RPM                    selinux-policy-3.13.1-252.el7.noarch\nSelinux Enabled               True\nPolicy Type                   targeted\nEnforcing Mode                Enforcing\nHost Name                     study.centos.mrcode\nPlatform                      Linux study.centos.mrcode "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.10")]),s._v(".0-1062.el7.x86_64\n                              "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#1 SMP Wed Aug 7 18:08:02 UTC 2019 x86_64 x86_64")]),s._v("\nAlert Count                   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nFirst Seen                    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-03-17 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":03:20 CST\nLast Seen                     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-03-17 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":03:20 CST\nLocal ID                      e3e3dee0-83eb-4cb8-b894-8be590fee082\n\nRaw Audit Messages\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("AVC "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("msg")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("audit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1584457400.225")]),s._v(":1008"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": avc:  denied  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" name_bind "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("pid")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11443")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("comm")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"vsftpd"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("src")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("555")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("scontext")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("system_u:system_r:ftpd_t:s0-s0:c0.c1023 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("tcontext")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("system_u:object_r:hi_reserved_port_t:s0 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("tclass")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tcp_socket "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("permissive")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("SYSCALL "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("msg")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("audit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1584457400.225")]),s._v(":1008"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("arch")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("x86_64 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("syscall")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("bind "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("success")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("no "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("exit")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("EACCES "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("a0")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("a1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("55e9e4d4e800 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("a2")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("1c "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("a3")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("items")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ppid")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11440")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("pid")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11443")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("auid")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4294967295")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("uid")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("gid")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("euid")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("suid")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("fsuid")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("egid")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("sgid")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("fsgid")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("tty")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ses")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4294967295")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("comm")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("vsftpd "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("exe")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/sbin/vsftpd "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("subj")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("system_u:system_r:ftpd_t:s0-s0:c0.c1023 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("key")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("null"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nHash: vsftpd,ftpd_t,hi_reserved_port_t,tcp_socket,name_bind\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 3. 根据建议解决执行指令, 92% 哪个指令下面 PORT_TYPE 下面又可选的 ftp_port_t")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 但是笔者还是懵逼的，不知道为什么那么多里面就选这个了")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# semanage port -a -t ftp_port_t -p tcp 555")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl restart vsftpd")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# netstat -tlnp")]),s._v("\nActive Internet connections "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("only servers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nProto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    \ntcp        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:631           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:*               LISTEN      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1374")]),s._v("/cupsd          \ntcp        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:25            "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:*               LISTEN      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1578")]),s._v("/master         \ntcp        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:6010          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:*               LISTEN      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2350")]),s._v("/sshd: mrcode@p \ntcp        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:6011          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:*               LISTEN      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10579")]),s._v("/sshd: root@pt \ntcp        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:111             "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:*               LISTEN      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/systemd           \ntcp        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".122.1:53        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:*               LISTEN      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1975")]),s._v("/dnsmasq        \ntcp        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:22              "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:*               LISTEN      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1378")]),s._v("/sshd           \ntcp6       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" ::1:631                 :::*                    LISTEN      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1374")]),s._v("/cupsd          \ntcp6       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" ::1:25                  :::*                    LISTEN      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1578")]),s._v("/master         \ntcp6       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" ::1:6010                :::*                    LISTEN      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2350")]),s._v("/sshd: mrcode@p \ntcp6       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" ::1:6011                :::*                    LISTEN      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10579")]),s._v("/sshd: root@pt \ntcp6       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" :::555                  :::*                    LISTEN      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11573")]),s._v("/vsftpd        \ntcp6       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" :::111                  :::*                    LISTEN      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/systemd           \ntcp6       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" :::22                   :::*                    LISTEN      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1378")]),s._v("/sshd     \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可以看到 vsftpd 的端口变成了 555 了")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 4. 实验看看该 port 是否可用")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl ftp://localhost:555")]),s._v("\ndrwxr-xr-x    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("              "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("42")]),s._v(" Mar "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" 09:03 pub\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br"),a("span",{staticClass:"line-number"},[s._v("77")]),a("br"),a("span",{staticClass:"line-number"},[s._v("78")]),a("br"),a("span",{staticClass:"line-number"},[s._v("79")]),a("br"),a("span",{staticClass:"line-number"},[s._v("80")]),a("br"),a("span",{staticClass:"line-number"},[s._v("81")]),a("br"),a("span",{staticClass:"line-number"},[s._v("82")]),a("br"),a("span",{staticClass:"line-number"},[s._v("83")]),a("br"),a("span",{staticClass:"line-number"},[s._v("84")]),a("br"),a("span",{staticClass:"line-number"},[s._v("85")]),a("br"),a("span",{staticClass:"line-number"},[s._v("86")]),a("br"),a("span",{staticClass:"line-number"},[s._v("87")]),a("br"),a("span",{staticClass:"line-number"},[s._v("88")]),a("br"),a("span",{staticClass:"line-number"},[s._v("89")]),a("br"),a("span",{staticClass:"line-number"},[s._v("90")]),a("br"),a("span",{staticClass:"line-number"},[s._v("91")]),a("br"),a("span",{staticClass:"line-number"},[s._v("92")]),a("br"),a("span",{staticClass:"line-number"},[s._v("93")]),a("br"),a("span",{staticClass:"line-number"},[s._v("94")]),a("br"),a("span",{staticClass:"line-number"},[s._v("95")]),a("br"),a("span",{staticClass:"line-number"},[s._v("96")]),a("br"),a("span",{staticClass:"line-number"},[s._v("97")]),a("br")])])])}),[],!1,null,null,null);t.default=e.exports}}]);